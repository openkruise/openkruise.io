<!doctype html>
<html lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.13">
<link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="OpenKruise RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="OpenKruise Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="OpenKruise" href="/zh/opensearch.xml"><title data-react-helmet="true">One post tagged with &quot;workload&quot; | OpenKruise</title><meta data-react-helmet="true" property="og:title" content="One post tagged with &quot;workload&quot; | OpenKruise"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://openkruise.io/zh/blog/tags/workload"><meta data-react-helmet="true" name="docsearch:language" content="zh"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-react-helmet="true" rel="icon" href="/zh/img/openkruise.ico"><link data-react-helmet="true" rel="canonical" href="https://openkruise.io/zh/blog/tags/workload"><link data-react-helmet="true" rel="alternate" href="https://openkruise.io/blog/tags/workload" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://openkruise.io/zh/blog/tags/workload" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://openkruise.io/blog/tags/workload" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/assets/css/styles.0170f992.css">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/assets/js/runtime~main.a9d38f62.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/assets/js/main.8c3fdc92.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" role="banner"><div class="announcementBarPlaceholder_2m9F"></div><div class="announcementBarContent_3EUC">â­ï¸ If you like OpenKruise, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/openkruise/kruise">GitHub</a>! â­ï¸</div><button type="button" class="clean-btn close announcementBarClose_38nx" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/img/openkruise.ico" alt="OpenKruise" class="themedImage_1VuW themedImage--light_3UqQ"><img src="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/img/openkruise.ico" alt="OpenKruise" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">OpenKruise</b></a><a class="navbar__item navbar__link" href="/zh/docs/">æ–‡æ¡£</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh/blog">åšå®¢</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/zh/docs/">v1.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/docs/next/">Next</a></li><li><a class="dropdown__link" href="/zh/docs/">v1.0</a></li><li><a class="dropdown__link" href="/zh/docs/v0.10/">v0.10</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_3vod"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>ç®€ä½“ä¸­æ–‡</span></span></a><ul class="dropdown__menu"><li><a href="/blog/tags/workload" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/zh/blog/tags/workload" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">ç®€ä½“ä¸­æ–‡</a></li></ul></div><a href="https://github.com/openkruise/kruise" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ğŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ğŸŒ</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Kl_"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">All posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/openkruise-1.0">OpenKruise v1.0ï¼šäº‘åŸç”Ÿåº”ç”¨è‡ªåŠ¨åŒ–è¾¾åˆ°æ–°çš„é«˜å³°</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/workloadspread">OpenKruise v0.10.0 æ–°ç‰¹æ€§WorkloadSpreadè§£è¯»</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/openkruise-0.10.0">OpenKruise 0.10.0ï¼šæ–°å¢åº”ç”¨å¼¹æ€§æ‹“æ‰‘ç®¡ç†ã€åº”ç”¨é˜²æŠ¤ç­‰èƒ½åŠ›</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/SidecarSet">OpenKruise 0.9.0, SidecarSet Helps Mesh Container Hot Upgrade</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/openkruise-0.9.0">OpenKruise 0.9.0ï¼šæ–°å¢Podå®¹å™¨é‡å¯ã€èµ„æºåˆ é™¤é˜²æŠ¤ç­‰åŠŸèƒ½</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/SidecarSet">OpenKruise 0.8.0, A Powerful Tool for Sidecar Container Management</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/uniteddeployment">UnitedDeploymemt - Supporting Multi-domain Workload Management</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/learning-concurrent-reconciling">Learning Concurrent Reconciling</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/workload-classification-guidance">Kruise Workload Classification Guidance</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>One post tagged with &quot;workload&quot;</h1><a href="/zh/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/zh/blog/workloadspread">OpenKruise v0.10.0 æ–°ç‰¹æ€§WorkloadSpreadè§£è¯»</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-09-22T00:00:00.000Z" itemprop="datePublished">2021å¹´9æœˆ22æ—¥</time> Â· <!-- -->é˜…è¯»éœ€è¦ 1 åˆ†é’Ÿ</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://github.com/BoltsLei" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://github.com/BoltsLei.png" alt="GuangLei Cao"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/BoltsLei" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">GuangLei Cao</span></a></div><small class="avatar__subtitle" itemprop="description">Contributor of OpenKruise</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_31ik" id="èƒŒæ™¯">èƒŒæ™¯<a aria-hidden="true" class="hash-link" href="#èƒŒæ™¯" title="Direct link to heading">â€‹</a></h2><p>Workloadåˆ†å¸ƒåœ¨ä¸åŒzoneï¼Œä¸åŒçš„ç¡¬ä»¶ç±»å‹ï¼Œç”šè‡³æ˜¯ä¸åŒçš„é›†ç¾¤å’Œäº‘å‚å•†å·²ç»æ˜¯ä¸€ä¸ªéå¸¸æ™®éçš„éœ€æ±‚ã€‚è¿‡å»ä¸€èˆ¬åªèƒ½å°†ä¸€ä¸ªåº”ç”¨æ‹†åˆ†ä¸ºå¤šä¸ª workloadï¼ˆæ¯”å¦‚ Deploymentï¼‰æ¥éƒ¨ç½²ï¼Œç”±SREå›¢é˜Ÿæ‰‹å·¥ç®¡ç†æˆ–è€…å¯¹PaaS å±‚æ·±åº¦å®šåˆ¶ï¼Œæ¥æ”¯æŒå¯¹ä¸€ä¸ªåº”ç”¨å¤šä¸ª workload çš„ç²¾ç»†åŒ–ç®¡ç†ã€‚</p><p>è¿›ä¸€æ­¥æ¥è¯´ï¼Œåœ¨åº”ç”¨éƒ¨ç½²çš„åœºæ™¯ä¸‹æœ‰ç€å¤šç§å¤šæ ·çš„æ‹“æ‰‘æ‰“æ•£ä»¥åŠå¼¹æ€§çš„è¯‰æ±‚ã€‚å…¶ä¸­æœ€å¸¸è§å°±æ˜¯æŒ‰æŸç§æˆ–å¤šç§æ‹“æ‰‘ç»´åº¦æ‰“æ•£ï¼Œæ¯”å¦‚ï¼š</p><ul><li>åº”ç”¨éƒ¨ç½²éœ€è¦æŒ‰ node ç»´åº¦æ‰“æ•£ï¼Œé¿å…å †å ï¼ˆæé«˜å®¹ç¾èƒ½åŠ›ï¼‰ã€‚</li><li>åº”ç”¨éƒ¨ç½²éœ€è¦æŒ‰ AZï¼ˆavailable zoneï¼‰ç»´åº¦æ‰“æ•£ï¼ˆæé«˜å®¹ç¾èƒ½åŠ›ï¼‰ã€‚</li><li>æŒ‰ zone æ‰“æ•£æ—¶ï¼Œéœ€è¦æŒ‡å®šåœ¨ä¸åŒ zone ä¸­éƒ¨ç½²çš„æ¯”ä¾‹æ•°ã€‚</li></ul><p>éšç€äº‘åŸç”Ÿåœ¨å›½å†…å¤–çš„è¿…é€Ÿæ™®åŠè½åœ°ï¼Œåº”ç”¨å¯¹äºå¼¹æ€§çš„éœ€æ±‚ä¹Ÿè¶Šæ¥è¶Šå¤šã€‚å„å…¬æœ‰äº‘å‚å•†é™†ç»­æ¨å‡ºäº†Serverlesså®¹å™¨æœåŠ¡æ¥æ”¯æ’‘å¼¹æ€§éƒ¨ç½²åœºæ™¯ï¼Œå¦‚é˜¿é‡Œäº‘çš„å¼¹æ€§å®¹å™¨æœåŠ¡ECIï¼ŒAWSçš„Fragateå®¹å™¨æœåŠ¡ç­‰ã€‚ä»¥ECIä¸ºä¾‹ï¼ŒECIå¯ä»¥é€šè¿‡Virtual Kubeletå¯¹æ¥Kubernetesç³»ç»Ÿï¼Œç»™äºˆPodä¸€å®šçš„é…ç½®å°±å¯ä»¥è°ƒåº¦åˆ°virtual-nodeèƒŒåçš„ECIé›†ç¾¤ã€‚æ€»ç»“ä¸€äº›å¸¸è§çš„å¼¹æ€§è¯‰æ±‚ï¼Œæ¯”å¦‚ï¼š</p><ul><li>åº”ç”¨ä¼˜å…ˆéƒ¨ç½²åˆ°è‡ªæœ‰é›†ç¾¤ï¼Œèµ„æºä¸è¶³æ—¶å†éƒ¨ç½²åˆ°å¼¹æ€§é›†ç¾¤ã€‚ç¼©å®¹æ—¶ï¼Œä¼˜å…ˆä»å¼¹æ€§èŠ‚ç‚¹ç¼©å®¹ä»¥èŠ‚çœæˆæœ¬ã€‚</li><li>ç”¨æˆ·è‡ªå·±è§„åˆ’åŸºç¡€èŠ‚ç‚¹æ± å’Œå¼¹æ€§èŠ‚ç‚¹æ± ã€‚åº”ç”¨éƒ¨ç½²æ—¶éœ€è¦å›ºå®šæ•°é‡æˆ–æ¯”ä¾‹çš„ Pod éƒ¨ç½²åœ¨åŸºç¡€èŠ‚ç‚¹æ± ï¼Œå…¶ä½™çš„éƒ½æ‰©åˆ°å¼¹æ€§èŠ‚ç‚¹æ± ã€‚</li></ul><p>é’ˆå¯¹è¿™äº›éœ€æ±‚ï¼ŒOpenKruiseåœ¨ v0.10.0 ç‰ˆæœ¬ä¸­æ–°å¢äº† WorkloadSpread ç‰¹æ€§ã€‚ç›®å‰å®ƒæ”¯æŒé…åˆ Deploymentã€ReplicaSetã€CloneSet è¿™äº› workload ï¼Œæ¥ç®¡ç†å®ƒä»¬ä¸‹å± Pod çš„åˆ†åŒºéƒ¨ç½²ä¸å¼¹æ€§ä¼¸ç¼©ã€‚ä¸‹æ–‡ä¼šæ·±å…¥ä»‹ç»WorkloadSpreadçš„åº”ç”¨åœºæ™¯å’Œå®ç°åŸç†ï¼Œå¸®åŠ©ç”¨æˆ·æ›´å¥½çš„äº†è§£è¯¥ç‰¹æ€§ã€‚</p><hr><h2 class="anchor anchorWithStickyNavbar_31ik" id="workloadspread-ä»‹ç»">WorkloadSpread ä»‹ç»<a aria-hidden="true" class="hash-link" href="#workloadspread-ä»‹ç»" title="Direct link to heading">â€‹</a></h2><p>è¯¦ç»†ç»†èŠ‚å¯ä»¥å‚è€ƒ<a href="https://openkruise.io/docs/user-manuals/workloadspread" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼ŒWorkloadSpreadèƒ½å¤Ÿå°†workloadæ‰€å±çš„PodæŒ‰ä¸€å®šè§„åˆ™åˆ†å¸ƒåˆ°ä¸åŒç±»å‹çš„NodeèŠ‚ç‚¹ä¸Šï¼Œèƒ½å¤ŸåŒæ—¶æ»¡è¶³ä¸Šè¿°çš„æ‰“æ•£ä¸å¼¹æ€§åœºæ™¯ã€‚</p><hr><h2 class="anchor anchorWithStickyNavbar_31ik" id="ç°æœ‰æ–¹æ¡ˆå¯¹æ¯”">ç°æœ‰æ–¹æ¡ˆå¯¹æ¯”<a aria-hidden="true" class="hash-link" href="#ç°æœ‰æ–¹æ¡ˆå¯¹æ¯”" title="Direct link to heading">â€‹</a></h2><p>ç®€å•å¯¹æ¯”ä¸€äº›ç¤¾åŒºå·²æœ‰çš„æ–¹æ¡ˆã€‚</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="pod-topology-spread-constrains">Pod Topology Spread Constrains<a aria-hidden="true" class="hash-link" href="#pod-topology-spread-constrains" title="Direct link to heading">â€‹</a></h3><p><a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-topology-spread-constraints/" target="_blank" rel="noopener noreferrer">Pod topology spread constraints</a> æ˜¯Kubernetesç¤¾åŒºæä¾›çš„æ–¹æ¡ˆï¼Œå¯ä»¥å®šä¹‰æŒ‰ topology key çš„æ°´å¹³æ‰“æ•£ã€‚ç”¨æˆ·åœ¨å®šä¹‰å®Œåï¼Œè°ƒåº¦å™¨ä¼šä¾æ®é…ç½®é€‰æ‹©ç¬¦åˆåˆ†å¸ƒæ¡ä»¶çš„nodeã€‚</p><p>ç”±äºPodTopologySpreadæ›´å¤šçš„æ˜¯å‡åŒ€æ‰“æ•£ï¼Œæ— æ³•æ”¯æŒè‡ªå®šä¹‰çš„åˆ†åŒºæ•°é‡ä»¥åŠæ¯”ä¾‹é…ç½®ï¼Œä¸”ç¼©å®¹æ—¶ä¼šç ´ååˆ†å¸ƒã€‚WorkloadSpreadå¯ä»¥è‡ªå®šä¹‰å„ä¸ªåˆ†åŒºçš„æ•°é‡ï¼Œå¹¶ä¸”ç®¡ç†ç€ç¼©å®¹çš„é¡ºåºã€‚å› æ­¤åœ¨ä¸€äº›åœºæ™¯ä¸‹å¯ä»¥é¿å…PodTopologySpreadçš„ä¸è¶³ã€‚</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="uniteddeployment">UnitedDeployment<a aria-hidden="true" class="hash-link" href="#uniteddeployment" title="Direct link to heading">â€‹</a></h4><p><a href="https://openkruise.io/docs/user-manuals/uniteddeployment" target="_blank" rel="noopener noreferrer">UnitedDeployment</a> æ˜¯Kruiseç¤¾åŒºæä¾›çš„æ–¹æ¡ˆï¼Œé€šè¿‡åˆ›å»ºå’Œç®¡ç†å¤šä¸ª workload ç®¡ç†å¤šä¸ªåŒºåŸŸä¸‹çš„ Podã€‚</p><p>UnitedDeploymentéå¸¸å¥½çš„æ”¯æŒäº†æ‰“æ•£ä¸å¼¹æ€§çš„éœ€æ±‚ï¼Œä¸è¿‡å®ƒæ˜¯ä¸€ä¸ªå…¨æ–°çš„workloadï¼Œç”¨æˆ·çš„ä½¿ç”¨å’Œè¿ç§»æˆæœ¬ä¼šæ¯”è¾ƒé«˜ã€‚è€ŒWorkloadSpreadæ˜¯ä¸€ç§è½»é‡åŒ–çš„æ–¹æ¡ˆï¼Œåªéœ€è¦ç®€å•çš„é…ç½®å¹¶å…³è”åˆ°workloadå³å¯ã€‚</p><hr><h2 class="anchor anchorWithStickyNavbar_31ik" id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯<a aria-hidden="true" class="hash-link" href="#åº”ç”¨åœºæ™¯" title="Direct link to heading">â€‹</a></h2><p>ä¸‹é¢æˆ‘ä¼šåˆ—ä¸¾ä¸€äº›WorkloadSpreadçš„åº”ç”¨åœºæ™¯ï¼Œç»™å‡ºå¯¹åº”çš„é…ç½®ï¼Œå¸®åŠ©å¤§å®¶å¿«é€Ÿäº†è§£WorkloadSpreadçš„èƒ½åŠ›ã€‚</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="1-åŸºç¡€èŠ‚ç‚¹æ± è‡³å¤šéƒ¨ç½²100ä¸ªå‰¯æœ¬å‰©ä½™çš„éƒ¨ç½²åˆ°å¼¹æ€§èŠ‚ç‚¹æ± ">1. åŸºç¡€èŠ‚ç‚¹æ± è‡³å¤šéƒ¨ç½²100ä¸ªå‰¯æœ¬ï¼Œå‰©ä½™çš„éƒ¨ç½²åˆ°å¼¹æ€§èŠ‚ç‚¹æ± ã€‚<a aria-hidden="true" class="hash-link" href="#1-åŸºç¡€èŠ‚ç‚¹æ± è‡³å¤šéƒ¨ç½²100ä¸ªå‰¯æœ¬å‰©ä½™çš„éƒ¨ç½²åˆ°å¼¹æ€§èŠ‚ç‚¹æ± " title="Direct link to heading">â€‹</a></h3><p><img alt="case-1" src="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/assets/images/case-1-8545e73ad27cbea3f342f0502db2d123.jpg"></p><div class="codeBlockContainer_K1bP language-yaml"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">subsets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> subset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">maxReplicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">requiredNodeSelectorTerm</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchExpressions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app.deploy/zone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> In</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">values</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> subset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">elastic </span><span class="token comment" style="color:#999988;font-style:italic">#å‰¯æœ¬æ•°é‡ä¸é™</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">requiredNodeSelectorTerm</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchExpressions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app.deploy/zone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> In</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">values</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> elastic</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>å½“workloadå°‘äº100å‰¯æœ¬æ—¶ï¼Œå…¨éƒ¨éƒ¨ç½²åˆ°normalèŠ‚ç‚¹æ± ï¼Œè¶…è¿‡100ä¸ªéƒ¨ç½²åˆ°elasticèŠ‚ç‚¹æ± ã€‚ç¼©å®¹æ—¶ä¼šä¼˜å…ˆåˆ é™¤elasticèŠ‚ç‚¹ä¸Šçš„Podã€‚</p><p>ç”±äºWorkloadSpreadä¸ä¾µå…¥workloadï¼Œåªæ˜¯é™åˆ¶ä½äº†workloadçš„åˆ†å¸ƒï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ç»“åˆHPAæ ¹æ®èµ„æºè´Ÿè½½åŠ¨æ€è°ƒæ•´å‰¯æœ¬æ•°ï¼Œè¿™æ ·å½“ä¸šåŠ¡é«˜å³°æ—¶ä¼šè‡ªåŠ¨è°ƒåº¦åˆ°elasticèŠ‚ç‚¹ä¸Šå»ï¼Œä¸šåŠ¡ä½å³°æ—¶ä¼šä¼˜å…ˆé‡Šæ”¾elasticèŠ‚ç‚¹æ± ä¸Šçš„èµ„æºã€‚</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="2-ä¼˜å…ˆéƒ¨ç½²åˆ°åŸºç¡€èŠ‚ç‚¹æ± èµ„æºä¸è¶³å†éƒ¨ç½²åˆ°å¼¹æ€§èµ„æºæ± ">2. ä¼˜å…ˆéƒ¨ç½²åˆ°åŸºç¡€èŠ‚ç‚¹æ± ï¼Œèµ„æºä¸è¶³å†éƒ¨ç½²åˆ°å¼¹æ€§èµ„æºæ± ã€‚<a aria-hidden="true" class="hash-link" href="#2-ä¼˜å…ˆéƒ¨ç½²åˆ°åŸºç¡€èŠ‚ç‚¹æ± èµ„æºä¸è¶³å†éƒ¨ç½²åˆ°å¼¹æ€§èµ„æºæ± " title="Direct link to heading">â€‹</a></h3><p><img alt="case-2" src="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/assets/images/case-2-4314e252508aedb388ff524d792b1bda.jpg"></p><div class="codeBlockContainer_K1bP language-yaml"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">scheduleStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Adaptive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">adaptive</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">rescheduleCriticalSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">disableSimulationSchedule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">subsets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> subset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">normal </span><span class="token comment" style="color:#999988;font-style:italic">#å‰¯æœ¬æ•°é‡ä¸é™</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">requiredNodeSelectorTerm</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchExpressions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app.deploy/zone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> In</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">values</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> normal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> subset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">elastic </span><span class="token comment" style="color:#999988;font-style:italic">#å‰¯æœ¬æ•°é‡ä¸é™</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">requiredNodeSelectorTerm</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchExpressions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app.deploy/zone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> In</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">values</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> elastic</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>ä¸¤ä¸ªsubsetéƒ½æ²¡æœ‰å‰¯æœ¬æ•°é‡é™åˆ¶ï¼Œä¸”å¯ç”¨Adptiveè°ƒåº¦ç­–ç•¥çš„æ¨¡æ‹Ÿè°ƒåº¦å’ŒRescheduleèƒ½åŠ›ã€‚éƒ¨ç½²æ•ˆæœæ˜¯ä¼˜å…ˆéƒ¨ç½²åˆ°normalèŠ‚ç‚¹æ± ï¼Œnormalèµ„æºä¸è¶³æ—¶ï¼Œwebhookä¼šé€šè¿‡æ¨¡æ‹Ÿè°ƒåº¦é€‰æ‹©elasticèŠ‚ç‚¹ã€‚å½“normalèŠ‚ç‚¹æ± ä¸­çš„Podå¤„äºpendingçŠ¶æ€è¶…è¿‡30sé˜ˆå€¼, WorkloadSpread controllerä¼šåˆ é™¤è¯¥Podä»¥è§¦å‘é‡å»ºï¼Œæ–°çš„Podä¼šè¢«è°ƒåº¦åˆ°elasticèŠ‚ç‚¹æ± ã€‚ç¼©å®¹æ—¶è¿˜æ˜¯ä¼˜å…ˆç¼©å®¹elasticèŠ‚ç‚¹ä¸Šçš„Podï¼Œä¸ºç”¨æˆ·èŠ‚çœæˆæœ¬ã€‚</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="3-æ‰“æ•£åˆ°3ä¸ªzoneæ¯”ä¾‹åˆ†åˆ«ä¸º113">3. æ‰“æ•£åˆ°3ä¸ªzoneï¼Œæ¯”ä¾‹åˆ†åˆ«ä¸º1:1:3<a aria-hidden="true" class="hash-link" href="#3-æ‰“æ•£åˆ°3ä¸ªzoneæ¯”ä¾‹åˆ†åˆ«ä¸º113" title="Direct link to heading">â€‹</a></h3><p><img alt="case-3" src="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/assets/images/case-3-2d2b48de4fda0972263202b26e504f2e.jpg"></p><div class="codeBlockContainer_K1bP language-yaml"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">subsets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> subset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">maxReplicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 20%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">requiredNodeSelectorTerm</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchExpressions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> topology.kubernetes.io/zone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> In</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">values</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> zone</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> subset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">maxReplicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 20%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">requiredNodeSelectorTerm</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchExpressions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> topology.kubernetes.io/zone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> In</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">values</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> zone</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> subset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">maxReplicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 60%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">requiredNodeSelectorTerm</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchExpressions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> topology.kubernetes.io/zone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> In</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">values</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> zone</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">c      </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>æŒ‰ç…§ä¸åŒzoneçš„å®é™…æƒ…å†µï¼Œå°†workloadæŒ‰ç…§1:1:3çš„æ¯”ä¾‹æ‰“æ•£ã€‚WorkloadSpreadä¼šç¡®ä¿workloadæ‰©ç¼©å®¹æ—¶æŒ‰ç…§å®šä¹‰çš„æ¯”ä¾‹åˆ†å¸ƒã€‚</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="4-workloadåœ¨ä¸åŒcpu-archä¸Šé…ç½®ä¸åŒçš„èµ„æºé…é¢">4. workloadåœ¨ä¸åŒCPU Archä¸Šé…ç½®ä¸åŒçš„èµ„æºé…é¢<a aria-hidden="true" class="hash-link" href="#4-workloadåœ¨ä¸åŒcpu-archä¸Šé…ç½®ä¸åŒçš„èµ„æºé…é¢" title="Direct link to heading">â€‹</a></h3><p>workloadåˆ†å¸ƒçš„Nodeå¯èƒ½æœ‰ä¸åŒçš„ç¡¬ä»¶é…ç½®ï¼ŒCPUæ¶æ„ç­‰ï¼Œè¿™å°±å¯èƒ½éœ€è¦ä¸ºä¸åŒçš„subsetåˆ†åˆ«åˆ¶å®šPodé…ç½®ã€‚è¿™äº›é…ç½®å¯ä»¥æ˜¯labelå’Œannotationç­‰å…ƒæ•°æ®ä¹Ÿå¯ä»¥æ˜¯Podå†…éƒ¨å®¹å™¨çš„èµ„æºé…é¢ï¼Œç¯å¢ƒå˜é‡ç­‰ã€‚</p><p><img alt="case-4" src="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/assets/images/case-4-b5a9c883d4656b9cb2928df4bd14fc33.jpg"></p><div class="codeBlockContainer_K1bP language-yaml"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">subsets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> subset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">x86</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">arch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># maxReplicas...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># requiredNodeSelectorTerm...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">patch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resource.cpu/arch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> x86</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;500m&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;800Mi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> subset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">arm</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">arch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># maxReplicas...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># requiredNodeSelectorTerm...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">patch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resource.cpu/arch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> arm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;300m&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;600Mi&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>ä»ä¸Šé¢çš„æ ·ä¾‹ä¸­æˆ‘ä»¬ä¸ºä¸¤ä¸ªsubsetçš„Podåˆ†åˆ«patchäº†ä¸åŒçš„label, container resourcesï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹Podåšæ›´ç²¾ç»†åŒ–çš„ç®¡ç†ã€‚å½“workloadçš„Podåˆ†å¸ƒåœ¨ä¸åŒçš„CPUæ¶æ„çš„èŠ‚ç‚¹ä¸Šï¼Œé…ç½®ä¸åŒçš„èµ„æºé…é¢ä»¥æ›´å¥½çš„åˆ©ç”¨ç¡¬ä»¶èµ„æºã€‚</p><hr><h2 class="anchor anchorWithStickyNavbar_31ik" id="å®ç°åŸç†">å®ç°åŸç†<a aria-hidden="true" class="hash-link" href="#å®ç°åŸç†" title="Direct link to heading">â€‹</a></h2><p>WorkloadSpreadæ˜¯ä¸€ä¸ªçº¯æ—è·¯çš„å¼¹æ€§/æ‹“æ‰‘ç®¡æ§æ–¹æ¡ˆã€‚ç”¨æˆ·åªéœ€è¦é’ˆå¯¹è‡ªå·±çš„ Deployment/CloneSet/Job å¯¹è±¡åˆ›å»ºå¯¹åº”çš„ WorkloadSpread å³å¯ï¼Œæ— éœ€å¯¹ workload åšæ”¹åŠ¨ï¼Œä¹Ÿä¸ä¼šå¯¹ç”¨æˆ·ä½¿ç”¨ workload é€ æˆé¢å¤–æˆæœ¬ã€‚</p><p><img alt="arch" src="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/assets/images/arch-71cac149618fd28aae6c14d5dee1555f.jpg"></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="1-subsetä¼˜å…ˆçº§ä¸å‰¯æœ¬æ•°é‡æ§åˆ¶">1. subsetä¼˜å…ˆçº§ä¸å‰¯æœ¬æ•°é‡æ§åˆ¶<a aria-hidden="true" class="hash-link" href="#1-subsetä¼˜å…ˆçº§ä¸å‰¯æœ¬æ•°é‡æ§åˆ¶" title="Direct link to heading">â€‹</a></h3><p>WorkloadSpread ä¸­å®šä¹‰äº†å¤šä¸ª subsetï¼Œæ¯ä¸ªsubsetä»£è¡¨ä¸€ä¸ªé€»è¾‘åŸŸã€‚ç”¨æˆ·å¯ä»¥è‡ªç”±çš„æ ¹æ®èŠ‚ç‚¹é…ç½®ï¼Œç¡¬ä»¶ç±»å‹ï¼Œzoneç­‰æ¥åˆ’åˆ†subsetã€‚ç‰¹åˆ«çš„ï¼Œæˆ‘ä»¬è§„å®šäº†subsetçš„ä¼˜å…ˆçº§ï¼š</p><ol><li>æŒ‰å®šä¹‰ä»å‰å¾€åçš„é¡ºåºï¼Œä¼˜å…ˆçº§ä»é«˜åˆ°ä½ã€‚</li><li>ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆæ‰©å®¹ï¼›ä¼˜å…ˆçº§è¶Šä½ï¼Œè¶Šå…ˆç¼©å®¹ã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_31ik" id="2-å¦‚ä½•æ§åˆ¶ç¼©å®¹ä¼˜å…ˆçº§">2. å¦‚ä½•æ§åˆ¶ç¼©å®¹ä¼˜å…ˆçº§ï¼Ÿ<a aria-hidden="true" class="hash-link" href="#2-å¦‚ä½•æ§åˆ¶ç¼©å®¹ä¼˜å…ˆçº§" title="Direct link to heading">â€‹</a></h3><p>ç†è®ºä¸Šï¼ŒWorkloadSpread è¿™ç§æ—è·¯æ–¹æ¡ˆæ˜¯æ— æ³•å¹²æ¶‰åˆ° workload æ§åˆ¶å™¨é‡Œçš„ç¼©å®¹é¡ºåºé€»è¾‘çš„ã€‚</p><p>ä¸è¿‡ï¼Œè¿™ä¸ªé—®é¢˜åœ¨è¿‘æœŸå¾—ä»¥è§£å†³â€”â€” ç»è¿‡ä¸€ä»£ä»£ç”¨æˆ·çš„ä¸æ‡ˆåŠªåŠ›ï¼ˆåé¦ˆï¼‰ï¼Œk8s ä» 1.21 ç‰ˆæœ¬å¼€å§‹ä¸º ReplicaSetï¼ˆDeploymentï¼‰æ”¯æŒäº†é€šè¿‡è®¾ç½® controller.kubernetes.io/pod-deletion-cost è¿™ä¸ª annotation æ¥æŒ‡å®š Pod çš„ â€œåˆ é™¤ä»£ä»·â€ï¼šdeletion-cost è¶Šé«˜çš„ Podï¼Œåˆ é™¤çš„ä¼˜å…ˆçº§è¶Šä½ã€‚</p><p>è€Œ Kruise ä» v0.9.0 ç‰ˆæœ¬å¼€å§‹ï¼Œå°±åœ¨ CloneSet ä¸­æ”¯æŒäº† deletion-cost ç‰¹æ€§ã€‚</p><p>å› æ­¤ï¼ŒWorkloadSpread controlleré€šè¿‡è°ƒæ•´å„ä¸ª subset ä¸‹å± Pod çš„ deletion-costï¼Œæ¥æ§åˆ¶workloadçš„ç¼©å®¹é¡ºåºã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šå¯¹äºä»¥ä¸‹ WorkloadSpreadï¼Œä»¥åŠå®ƒå…³è”çš„ CloneSet æœ‰ 10 ä¸ªå‰¯æœ¬ï¼š</p><div class="codeBlockContainer_K1bP language-yaml"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">subsets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> subset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxReplicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> subset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">b </span><span class="token comment" style="color:#999988;font-style:italic"># å‰¯æœ¬æ•°é‡ä¸é™</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>åˆ™ deletion-cost æ•°å€¼ä»¥åŠåˆ é™¤é¡ºåºä¸ºï¼š</p><ul><li>2 ä¸ªåœ¨ subset-bä¸Šçš„ Podï¼Œdeletion-cost ä¸º 100ï¼ˆä¼˜å…ˆç¼©å®¹ï¼‰ </li><li>8 ä¸ªåœ¨ subset-aä¸Šçš„ Podï¼Œdeletion-cost ä¸º 200ï¼ˆæœ€åç¼©å®¹ï¼‰ </li></ul><p>ç„¶åï¼Œå¦‚æœç”¨æˆ·ä¿®æ”¹äº† WorkloadSpread ä¸ºï¼š</p><div class="codeBlockContainer_K1bP language-yaml"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">subsets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> subset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxReplicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 8-3, </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> subset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">b</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>åˆ™ workloadspread controller ä¼šå°†å…¶ä¸­ 3 ä¸ªåœ¨ susbet-a ä¸Š Pod çš„ deletion-costå€¼ç”± 200 æ”¹ä¸º -100ï¼Œåˆ™:</p><ul><li>3 ä¸ªåœ¨ subset-a ä¸Šçš„ Podï¼Œdeletion-cost ä¸º -100ï¼ˆä¼˜å…ˆç¼©å®¹ï¼‰ </li><li>2 ä¸ªåœ¨ subset-b ä¸Šçš„ Podï¼Œdeletion-cost ä¸º 100ï¼ˆå…¶æ¬¡ç¼©å®¹ï¼‰ </li><li>5 ä¸ªåœ¨ subset-a ä¸Šçš„ Podï¼Œdeletion-cost ä¸º 200ï¼ˆæœ€åç¼©å®¹ï¼‰ </li></ul><p>è¿™æ ·å°±èƒ½å¤Ÿä¼˜å…ˆç¼©å®¹é‚£äº›è¶…è¿‡subsetå‰¯æœ¬é™åˆ¶çš„Podäº†ï¼Œå½“ç„¶æ€»ä½“è¿˜æ˜¯æŒ‰ç…§subsetå®šä¹‰çš„é¡ºåºä»åå‘å‰ç¼©å®¹ã€‚</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="3-æ•°é‡æ§åˆ¶">3. æ•°é‡æ§åˆ¶<a aria-hidden="true" class="hash-link" href="#3-æ•°é‡æ§åˆ¶" title="Direct link to heading">â€‹</a></h3><p>å¦‚ä½•ç¡®ä¿ webhook ä¸¥æ ¼æŒ‰ç…§ subset ä¼˜å…ˆçº§é¡ºåºã€maxReplicas æ•°é‡æ¥æ³¨å…¥Pod è§„åˆ™æ˜¯ WorkloadSpread å®ç°å±‚é¢çš„é‡ç‚¹éš¾é¢˜ã€‚</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="31-è§£å†³å¹¶å‘ä¸€è‡´æ€§é—®é¢˜">3.1 è§£å†³å¹¶å‘ä¸€è‡´æ€§é—®é¢˜<a aria-hidden="true" class="hash-link" href="#31-è§£å†³å¹¶å‘ä¸€è‡´æ€§é—®é¢˜" title="Direct link to heading">â€‹</a></h4><p>åœ¨ workloadspreadçš„status ä¸­æœ‰å¯¹åº”æ¯ä¸ª subset çš„ statusï¼Œå…¶ä¸­ missingReplicas å­—æ®µè¡¨ç¤ºäº†è¿™ä¸ª subset éœ€è¦çš„ Pod æ•°é‡ï¼Œ-1 è¡¨ç¤ºæ²¡æœ‰æ•°é‡é™åˆ¶ï¼ˆsubset æ²¡æœ‰é…ç½® maxReplicasï¼‰ã€‚</p><div class="codeBlockContainer_K1bP language-yaml"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">subsets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> subset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxReplicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> subset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">status</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">subsetStatuses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> subset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">missingReplicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> subset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">missingReplicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">-1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>å½“ webhook æ”¶åˆ° Pod createè¯·æ±‚æ—¶ï¼š</p><ol><li>æ ¹æ® subsetStatuses é¡ºåºä¾æ¬¡æ‰¾ missingReplicas å¤§äº 0 æˆ–ä¸º -1 çš„ suitable subsetã€‚</li><li>æ‰¾åˆ°suitable subsetåï¼Œå¦‚æœ missingReplicas å¤§äº 0ï¼Œåˆ™å…ˆå‡ 1 å¹¶å°è¯•æ›´æ–° workloadspread statusã€‚</li><li>å¦‚æœæ›´æ–°æˆåŠŸï¼Œåˆ™å°†è¯¥ subsetå®šä¹‰çš„è§„åˆ™æ³¨å…¥åˆ° pod ä¸­ã€‚</li><li>å¦‚æœæ›´æ–°å¤±è´¥ï¼Œåˆ™é‡æ–° get è¿™ä¸ª workloadspreadä»¥è·å–æœ€æ–°çš„statusï¼Œå¹¶å›åˆ°æ­¥éª¤ 1ï¼ˆæœ‰ä¸€å®šé‡è¯•æ¬¡æ•°é™åˆ¶ï¼‰ã€‚</li></ol><p>åŒæ ·ï¼Œå½“ webhook æ”¶åˆ° Pod delete/eviction è¯·æ±‚æ—¶ï¼Œåˆ™å°† missingReplicas åŠ  1 å¹¶æ›´æ–°ã€‚</p><p>æ¯«æ— ç–‘é—®ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ä¹è§‚é”æ¥è§£å†³æ›´æ–°å†²çªã€‚ä½†æ˜¯ä»…ä½¿ç”¨ä¹è§‚é”æ˜¯ä¸åˆé€‚çš„ï¼Œå› ä¸ºworkloadåœ¨åˆ›å»ºPodæ—¶ä¼šå¹¶è¡Œåˆ›å»ºå¤§é‡çš„Podï¼Œapiserverä¼šåœ¨ä¸€ç¬é—´å‘é€å¾ˆå¤šPod createè¯·æ±‚åˆ°webhookï¼Œå¹¶è¡Œå¤„ç†ä¼šäº§ç”Ÿéå¸¸å¤šçš„å†²çªã€‚å¤§å®¶éƒ½çŸ¥é“ï¼Œå†²çªå¤ªå¤šå°±ä¸é€‚åˆä½¿ç”¨ä¹è§‚é”äº†ï¼Œå› ä¸ºå®ƒè§£å†³å†²çªçš„é‡è¯•æˆæœ¬éå¸¸é«˜ã€‚ä¸ºæ­¤æˆ‘ä»¬è¿˜åŠ å…¥äº†workloadspreadçº§åˆ«çš„äº’æ–¥é”ï¼Œå°†å¹¶è¡Œå¤„ç†é™åˆ¶ä¸ºä¸²è¡Œå¤„ç†ã€‚åŠ å…¥äº’æ–¥é”è¿˜æœ‰æ–°çš„é—®é¢˜ï¼Œå³å½“å‰groutineè·å–é”åï¼Œææœ‰å¯èƒ½ä»infromerä¸­æ‹¿çš„workloadspreadä¸æ˜¯æœ€æ–°çš„ï¼Œè¿˜æ˜¯ä¼šå†²çªã€‚æ‰€ä»¥groutineåœ¨æ›´æ–°å®Œworkloadspreadä¹‹åï¼Œå…ˆå°†æœ€æ–°çš„workloadspreadå¯¹è±¡ç¼“å­˜èµ·æ¥å†é‡Šæ”¾é”ï¼Œè¿™æ ·æ–°çš„groutineè·å–é”åå°±å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­æ‹¿åˆ°æœ€æ–°çš„workloadspreadã€‚å½“ç„¶ï¼Œå¤šä¸ªwebhookçš„æƒ…å†µä¸‹è¿˜æ˜¯éœ€è¦ç»“åˆä¹è§‚é”æœºåˆ¶æ¥è§£å†³å†²çªã€‚</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="32-è§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜">3.2 è§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜<a aria-hidden="true" class="hash-link" href="#32-è§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜" title="Direct link to heading">â€‹</a></h4><p>é‚£ä¹ˆï¼ŒmissingReplicas æ•°å€¼æ˜¯å¦äº¤ç”± webhook æ§åˆ¶å³å¯å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸è¡Œï¼Œå› ä¸ºï¼š</p><ol><li>webhook æ”¶åˆ°çš„ Pod create è¯·æ±‚ï¼Œæœ€ç»ˆä¸ä¸€å®šçœŸçš„èƒ½æˆåŠŸï¼ˆæ¯”å¦‚ Pod ä¸åˆæ³•ï¼Œæˆ–åœ¨åç»­ quota ç­‰æ ¡éªŒç¯èŠ‚å¤±è´¥äº†ï¼‰ã€‚</li><li>webhook æ”¶åˆ°çš„ Pod delete/eviction è¯·æ±‚ï¼Œæœ€ç»ˆä¹Ÿä¸ä¸€å®šçœŸçš„èƒ½æˆåŠŸï¼ˆæ¯”å¦‚åç»­è¢« PDBã€PUB ç­‰æ‹¦æˆªäº†ï¼‰ã€‚</li><li>K8s é‡Œæ€»æœ‰ç§ç§çš„å¯èƒ½æ€§ï¼Œå¯¼è‡´ Pod æ²¡æœ‰ç»è¿‡ webhook å°±ç»“æŸæˆ–æ²¡äº†ï¼ˆæ¯”å¦‚ phase è¿›å…¥ Succeeded/Failedï¼Œæˆ–æ˜¯ etcd æ•°æ®ä¸¢äº†ç­‰ç­‰ï¼‰ã€‚</li><li>åŒæ—¶ï¼Œè¿™ä¹Ÿä¸ç¬¦åˆé¢å‘ç»ˆæ€çš„è®¾è®¡ç†å¿µã€‚</li></ol><p>å› æ­¤ï¼Œworkloadspread status æ˜¯ç”± webhook ä¸ controller åä½œæ¥æ§åˆ¶çš„ï¼š</p><ul><li>webhook åœ¨ Pod create/delete/eviction è¯·æ±‚é“¾è·¯æ‹¦æˆªï¼Œä¿®æ”¹ missingReplicas æ•°å€¼ã€‚</li><li>åŒæ—¶ controller çš„ reconcile ä¸­ä¹Ÿä¼šæ‹¿åˆ°å½“å‰ workload ä¸‹çš„æ‰€æœ‰ Podï¼Œæ ¹æ® subset åˆ†ç±»ï¼Œå¹¶å°† missingReplicas æ›´æ–°ä¸ºå½“å‰å®é™…ç¼ºå°‘çš„æ•°é‡ã€‚</li><li>ä»ä¸Šé¢çš„åˆ†æä¸­ï¼Œcontrollerä»informerä¸­è·å–Podå¾ˆå¯èƒ½å­˜åœ¨å»¶æ—¶ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜åœ¨statusä¸­å¢åŠ äº†creatingPods map, webookæ³¨å…¥çš„æ—¶å€™ä¼šè®°å½•keyä¸ºpod.name, valueä¸ºæ—¶é—´æˆ³çš„ä¸€æ¡entryåˆ°mapï¼Œcontrollerå†ç»“åˆmapç»´æŠ¤çœŸå®çš„missingReplicasã€‚åŒç†è¿˜æœ‰ä¸€ä¸ªdeletingPods mapæ¥è®°å½•Podçš„delete/evictionäº‹ä»¶ã€‚</li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="4-è‡ªé€‚åº”è°ƒåº¦èƒ½åŠ›">4. è‡ªé€‚åº”è°ƒåº¦èƒ½åŠ›<a aria-hidden="true" class="hash-link" href="#4-è‡ªé€‚åº”è°ƒåº¦èƒ½åŠ›" title="Direct link to heading">â€‹</a></h3><p>åœ¨ WorkloadSpread ä¸­æ”¯æŒé…ç½® scheduleStrategyã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œtype ä¸º Fixedï¼Œå³å›ºå®šæŒ‰ç…§å„ä¸ª subset çš„å‰åé¡ºåºã€maxReplicas é™åˆ¶æ¥å°† Pod è°ƒåº¦åˆ°å¯¹åº”çš„ subset ä¸­ã€‚
ä½†çœŸå®çš„åœºæ™¯ä¸‹ï¼Œå¾ˆå¤šæ—¶å€™ subset åˆ†åŒºæˆ–æ‹“æ‰‘çš„èµ„æºï¼Œä¸ä¸€å®šèƒ½å®Œå…¨æ»¡è¶³ maxReplicas æ•°é‡ã€‚ç”¨æˆ·éœ€è¦æŒ‰ç…§å®é™…çš„èµ„æºæƒ…å†µï¼Œæ¥ä¸º Pod é€‰æ‹©æœ‰èµ„æºçš„åˆ†åŒºæ‰©å®¹ã€‚è¿™å°±éœ€è¦ç”¨ Adaptive è¿™ç§è‡ªé€‚åº”çš„è°ƒåº¦åˆ†é…ã€‚</p><p>WorkloadSpread æä¾›çš„ Adaptive èƒ½åŠ›ï¼Œé€»è¾‘ä¸Šåˆ†ä¸ºä¸¤ç§ï¼š</p><ol><li>SimulationScheduleï¼šåœ¨ Kruise webhook ä¸­æ ¹æ® informer é‡Œå·²æœ‰çš„ nodes/pods æ•°æ®ï¼Œç»„è£…å‡ºè°ƒåº¦è´¦æœ¬ï¼Œå¯¹ Pod è¿›è¡Œæ¨¡æ‹Ÿè°ƒåº¦ã€‚å³é€šè¿‡ nodeSelector/affinityã€tolerationsã€ä»¥åŠåŸºæœ¬çš„ resources èµ„æºï¼Œåšä¸€æ¬¡ç®€å•çš„è¿‡æ»¤ã€‚ï¼ˆå¯¹äº vk è¿™ç§èŠ‚ç‚¹ä¸å¤ªé€‚ç”¨ï¼‰</li><li>Rescheduleï¼šåœ¨å°† Pod è°ƒåº¦åˆ°ä¸€ä¸ª subset åï¼Œå¦‚æœè°ƒåº¦å¤±è´¥è¶…è¿‡ rescheduleCriticalSeconds æ—¶é—´ï¼Œåˆ™å°†è¯¥ subset æš‚æ—¶æ ‡è®°ä¸º unschedulableï¼Œå¹¶åˆ é™¤ Pod è§¦å‘é‡å»ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œunschedulable ä¼šä¿ç•™ 5minï¼Œå³åœ¨ 5min å†…çš„ Pod åˆ›å»ºä¼šè·³è¿‡è¿™ä¸ª subsetã€‚</li></ol><hr><h2 class="anchor anchorWithStickyNavbar_31ik" id="å°ç»“">å°ç»“<a aria-hidden="true" class="hash-link" href="#å°ç»“" title="Direct link to heading">â€‹</a></h2><p>WorkloadSpreadé€šè¿‡ç»“åˆä¸€äº›kubernetesç°æœ‰çš„ç‰¹æ€§ä»¥ä¸€ç§æ—è·¯çš„å½¢å¼èµ‹äºˆworkloadå¼¹æ€§éƒ¨ç½²ä¸å¤šåŸŸéƒ¨ç½²çš„èƒ½åŠ›ã€‚æˆ‘ä»¬å¸Œæœ›ç”¨æˆ·é€šè¿‡ä½¿ç”¨WorkloadSpreadé™ä½workloadéƒ¨ç½²å¤æ‚åº¦ï¼Œåˆ©ç”¨å…¶å¼¹æ€§ä¼¸ç¼©èƒ½åŠ›åˆ‡å®é™ä½æˆæœ¬ã€‚
ç›®å‰é˜¿é‡Œäº‘å†…éƒ¨æ­£åœ¨ç§¯æçš„è½åœ°ï¼Œè½åœ°è¿‡ç¨‹ä¸­çš„è°ƒæ•´ä¼šåŠæ—¶åé¦ˆç¤¾åŒºã€‚æœªæ¥WorkloadSpreadè¿˜æœ‰ä¸€äº›æ–°èƒ½åŠ›è®¡åˆ’ï¼Œæ¯”å¦‚è®©WorkloadSpreadæ”¯æŒworkloadçš„å­˜é‡Podæ¥ç®¡ï¼Œæ”¯æŒæ‰¹é‡çš„workloadçº¦æŸï¼Œç”šè‡³æ˜¯è·¨è¿‡workloadå±‚çº§ä½¿ç”¨labelæ¥åŒ¹é…Podã€‚å…¶ä¸­ä¸€äº›èƒ½åŠ›éœ€è¦å®é™…è€ƒé‡ç¤¾åŒºç”¨æˆ·çš„éœ€æ±‚åœºæ™¯ã€‚å¸Œæœ›å¤§å®¶å¤šå¤šå‚ä¸åˆ°Kruiseç¤¾åŒºï¼Œå¤šæissueå’Œprï¼Œå¸®åŠ©ç”¨æˆ·è§£å†³æ›´å¤šäº‘åŸç”Ÿéƒ¨ç½²æ–¹é¢çš„éš¾é¢˜ï¼Œæ„å»ºä¸€ä¸ªæ›´å¥½çš„ç¤¾åŒºã€‚</p><hr><h2 class="anchor anchorWithStickyNavbar_31ik" id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®<a aria-hidden="true" class="hash-link" href="#å‚è€ƒæ–‡çŒ®" title="Direct link to heading">â€‹</a></h2><ul><li>WorkloadSpread: <a href="https://openkruise.io/docs/user-manuals/workloadspread" target="_blank" rel="noopener noreferrer">https://openkruise.io/docs/user-manuals/workloadspread</a></li><li>Pod Topology Spread Constrains: <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-topology-spread-constraints/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/concepts/workloads/pods/pod-topology-spread-constraints/</a></li><li>UnitedDeployment: https:/</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/zh/blog/tags/workload">workload</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/zh/blog/tags/workloadspread">workloadspread</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/zh/blog/tags/multi-domain">multi-domain</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about OpenKruise v0.10.0 æ–°ç‰¹æ€§WorkloadSpreadè§£è¯»" href="/zh/blog/workloadspread"><b>æ›´å¤š</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/zh/blog/SidecarSet">OpenKruise 0.8.0, A Powerful Tool for Sidecar Container Management</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-03-15T00:00:00.000Z" itemprop="datePublished">2021å¹´3æœˆ15æ—¥</time> Â· <!-- -->é˜…è¯»éœ€è¦ 1 åˆ†é’Ÿ</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://github.com/zmberg" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://github.com/zmberg.png" alt="Mingshan Zhao"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/zmberg" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Mingshan Zhao</span></a></div><small class="avatar__subtitle" itemprop="description">Member of OpenKruise</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>OpenKruise æ˜¯é˜¿é‡Œäº‘å¼€æºçš„äº‘åŸç”Ÿåº”ç”¨è‡ªåŠ¨åŒ–ç®¡ç†å¥—ä»¶ï¼Œä¹Ÿæ˜¯å½“å‰æ‰˜ç®¡åœ¨ Cloud Native Computing Foundation (CNCF) ä¸‹çš„Sandboxé¡¹ç›®ã€‚å®ƒæ¥è‡ªé˜¿é‡Œå·´å·´å¤šå¹´æ¥å®¹å™¨åŒ–ã€äº‘åŸç”Ÿçš„æŠ€æœ¯æ²‰æ·€ï¼Œæ˜¯é˜¿é‡Œå†…éƒ¨ç”Ÿäº§ç¯å¢ƒå¤§è§„æ¨¡åº”ç”¨çš„åŸºäºKubernetesä¹‹ä¸Šçš„æ ‡å‡†æ‰©å±•ç»„ä»¶ï¼Œä¹Ÿæ˜¯ç´§è´´ä¸Šæ¸¸ç¤¾åŒºæ ‡å‡†ã€é€‚åº”äº’è”ç½‘è§„æ¨¡åŒ–åœºæ™¯çš„æŠ€æœ¯ç†å¿µä¸æœ€ä½³å®è·µã€‚</p><p>OpenKruiseåœ¨2021.3.4å‘å¸ƒäº†æœ€æ–°çš„v0.8.0ç‰ˆæœ¬ï¼Œå…¶ä¸­å¢å¼ºäº†SidecarSetçš„èƒ½åŠ›ï¼Œç‰¹åˆ«æ˜¯å¯¹æ—¥å¿—ç®¡ç†ç±»Sidecaræœ‰äº†æ›´åŠ å®Œå–„çš„æ”¯æŒã€‚</p><header><h1>èƒŒæ™¯</h1></header><p>Sidecaræ˜¯äº‘åŸç”Ÿä¸­ä¸€ç§éå¸¸é‡è¦çš„å®¹å™¨è®¾è®¡æ¨¡å¼ï¼Œå®ƒå°†è¾…åŠ©èƒ½åŠ›ä»ä¸»å®¹å™¨ä¸­å‰¥ç¦»å‡ºæ¥æˆä¸ºå•ç‹¬çš„sidecarå®¹å™¨ã€‚åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œé€šå¸¸ä¹Ÿä½¿ç”¨sidecaræ¨¡å¼å°†å¾®æœåŠ¡ä¸­çš„é…ç½®ç®¡ç†ã€æœåŠ¡å‘ç°ã€è·¯ç”±ã€ç†”æ–­ç­‰é€šç”¨èƒ½åŠ›ä»ä¸»ç¨‹åºä¸­å‰¥ç¦»å‡ºæ¥ï¼Œä»è€Œæå¤§é™ä½äº†å¾®æœåŠ¡æ¶æ„ä¸­çš„å¤æ‚æ€§ã€‚éšç€Service Meshçš„é€æ­¥é£é¡ï¼Œsidecaræ¨¡å¼ä¹Ÿæ—¥ç›Šæ·±å…¥äººå¿ƒï¼Œåœ¨é˜¿é‡Œå·´å·´é›†å›¢å†…éƒ¨ä¹Ÿå¤§é‡ä½¿ç”¨sidecaræ¨¡å¼æ¥ç®¡ç†è¯¸å¦‚è¿ç»´ã€å®‰å…¨ã€æ¶ˆæ¯ä¸­é—´ä»¶ç­‰é€šç”¨ç»„ä»¶ã€‚</p><p>åœ¨Kubernetesé›†ç¾¤ä¸­ï¼ŒPodä¸ä»…å¯ä»¥å®ç°ä¸»å®¹å™¨ä¸sidecarå®¹å™¨çš„æ„å»ºï¼ŒåŒæ—¶æä¾›äº†è®¸å¤šåŠŸèƒ½å¼ºå¤§çš„workloadï¼ˆä¾‹å¦‚ï¼šdeploymentã€statefulsetï¼‰æ¥å¯¹Podè¿›è¡Œç®¡ç†ã€å‡çº§ã€‚ä½†æ˜¯éšç€kubernetesé›†ç¾¤ä¸Šçš„ä¸šåŠ¡æ—¥ç›Šå¢å¤šï¼Œsidecarå®¹å™¨çš„ç§ç±»ä¸è§„æ¨¡ä¹Ÿéšä¹‹æ—¥ç›Šåºå¤§ï¼Œå¯¹çº¿ä¸Šsidecarå®¹å™¨çš„ç®¡ç†å’Œå‡çº§æˆä¸ºäº†æ„ˆå‘ç¹æ‚çš„å·¥ä½œï¼š</p><ol><li>ä¸šåŠ¡Podé‡Œé¢åŒ…å«äº†è¿ç»´ã€å®‰å…¨ã€ä»£ç†ç­‰å¤šä¸ªsidecarå®¹å™¨ï¼Œä¸šåŠ¡çº¿åŒå­¦ä¸ä»…è¦å®Œæˆè‡ªèº«ä¸»å®¹å™¨çš„é…ç½®ï¼Œè€Œä¸”è¿˜éœ€è¦ç†Ÿæ‚‰è¿™äº›sidecarå®¹å™¨çš„é…ç½®ï¼Œè¿™ä¸ä»…å¢åŠ äº†ä¸šåŠ¡åŒå­¦çš„å·¥ä½œé‡ï¼ŒåŒæ—¶ä¹Ÿæ— å½¢å¢åŠ äº†sidecarå®¹å™¨é…ç½®çš„é£é™©ã€‚</li><li>sidecarå®¹å™¨çš„å‡çº§éœ€è¦è¿åŒä¸šåŠ¡ä¸»å®¹å™¨ä¸€èµ·é‡å¯ï¼ˆdeploymentã€statefulsetç­‰workloadåŸºäºPodé”€æ¯ã€é‡å»ºçš„æ¨¡å¼ï¼Œæ¥å®ç°Podçš„æ»šåŠ¨å‡çº§ï¼‰ï¼Œæ¨åŠ¨å’Œå‡çº§æ”¯æ’‘ç€çº¿ä¸Šæ•°ç™¾æ¬¾ä¸šåŠ¡çš„sidecarå®¹å™¨ï¼Œå¿…ç„¶å­˜åœ¨ç€æå¤§çš„ä¸šåŠ¡é˜»åŠ›ã€‚</li><li>ä½œä¸ºsidecarå®¹å™¨çš„æä¾›è€…å¯¹çº¿ä¸Šè¯¸å¤šå„ç§é…ç½®ä»¥åŠç‰ˆæœ¬çš„sidecarå®¹å™¨æ²¡æœ‰ç›´æ¥æœ‰æ•ˆçš„å‡çº§æ‰‹æ®µï¼Œè¿™å¯¹sidecarå®¹å™¨çš„ç®¡ç†æ„å‘³ç€æå¤§çš„æ½œåœ¨é£é™©ã€‚</li></ol><p>é˜¿é‡Œå·´å·´é›†å›¢å†…éƒ¨æ‹¥æœ‰ç€ç™¾ä¸‡çº§çš„å®¹å™¨æ•°é‡è¿åŒä¸Šé¢æ‰¿è½½çš„ä¸Šåƒä¸ªä¸šåŠ¡ï¼Œå› æ­¤ï¼Œsidecarå®¹å™¨çš„ç®¡ç†ä¸å‡çº§ä¹Ÿå°±æˆä¸ºäº†äºŸå¾…å®Œå–„çš„ä¸»é¢˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ€»ç»“äº†å†…éƒ¨è®¸å¤šsidecarå®¹å™¨çš„é€šç”¨åŒ–éœ€æ±‚ï¼Œå¹¶å°†å…¶æ²‰æ·€åˆ°OpenKruiseä¸Šé¢ï¼Œæœ€ç»ˆæŠ½è±¡ä¸ºSidecarSetä½œä¸ºç®¡ç†å’Œå‡çº§ç§ç±»ç¹å¤šsidecarå®¹å™¨çš„åˆ©å™¨ã€‚</p><header><h1>OpenKruise SidecarSet</h1></header><p>SidecarSetæ˜¯OpenKruiseä¸­é’ˆå¯¹sidecaræŠ½è±¡å‡ºæ¥çš„æ¦‚å¿µï¼Œè´Ÿè´£æ³¨å…¥å’Œå‡çº§kubernetesé›†ç¾¤ä¸­çš„sidecarå®¹å™¨ï¼Œæ˜¯OpenKruiseçš„æ ¸å¿ƒworkloadä¹‹ä¸€ã€‚å®ƒæä¾›äº†éå¸¸ä¸°å¯Œçš„åŠŸèƒ½ï¼Œç”¨æˆ·ä½¿ç”¨SidecarSetå¯ä»¥éå¸¸æ–¹ä¾¿å®ç°sidecarå®¹å™¨çš„ç®¡ç†ã€‚ä¸»è¦ç‰¹æ€§å¦‚ä¸‹ï¼š</p><ol><li>é…ç½®å•ç‹¬ç®¡ç†ï¼šä¸ºæ¯ä¸€ä¸ªsidecarå®¹å™¨é…ç½®å•ç‹¬çš„SidecarSeté…ç½®ï¼Œæ–¹ä¾¿ç®¡ç†</li><li>è‡ªåŠ¨æ³¨å…¥ï¼šåœ¨æ–°å»ºã€æ‰©å®¹ã€é‡å»ºpodçš„åœºæ™¯ä¸­ï¼Œå®ç°sidecarå®¹å™¨çš„è‡ªåŠ¨æ³¨å…¥</li><li>åŸåœ°å‡çº§ï¼šæ”¯æŒä¸é‡å»ºpodçš„æ–¹å¼å®Œæˆsidecarå®¹å™¨çš„åŸåœ°å‡çº§ï¼Œä¸å½±å“ä¸šåŠ¡ä¸»å®¹å™¨ï¼Œå¹¶åŒ…å«ä¸°å¯Œçš„ç°åº¦å‘å¸ƒç­–ç•¥</li></ol><p>æ³¨æ„ï¼šé’ˆå¯¹Podä¸­åŒ…å«å¤šä¸ªå®¹å™¨çš„æ¨¡å¼ï¼Œå…¶ä¸­å¯¹å¤–æä¾›ä¸»è¦ä¸šåŠ¡é€»è¾‘èƒ½åŠ›çš„å®¹å™¨ç§°ä¹‹ä¸º ä¸»å®¹å™¨ï¼Œå…¶å®ƒä¸€äº›å¦‚æ—¥å¿—é‡‡é›†ã€å®‰å…¨ã€ä»£ç†ç­‰è¾…åŠ©èƒ½åŠ›çš„å®¹å™¨ç§°ä¹‹ä¸º Sidecarå®¹å™¨ã€‚ä¾‹å¦‚ï¼šä¸€ä¸ªå¯¹å¤–æä¾›webèƒ½åŠ›çš„podï¼Œnginxå®¹å™¨æä¾›ä¸»è¦çš„web serverèƒ½åŠ›å³ä¸º ä¸»å®¹å™¨ï¼Œlogtailå®¹å™¨è´Ÿè´£é‡‡é›†ã€ä¸ŠæŠ¥nginxæ—¥å¿—å³ä¸º Sidecarå®¹å™¨ã€‚æœ¬æ–‡ä¸­çš„SidecarSetèµ„æºæŠ½è±¡ä¹Ÿæ˜¯ä¸ºè§£å†³ Sidecarå®¹å™¨ çš„ä¸€äº›é—®é¢˜ã€‚</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="sidecar-logging-architectures">Sidecar logging architectures<a aria-hidden="true" class="hash-link" href="#sidecar-logging-architectures" title="Direct link to heading">â€‹</a></h2><p>åº”ç”¨æ—¥å¿—å¯ä»¥è®©ä½ äº†è§£åº”ç”¨å†…éƒ¨çš„è¿è¡ŒçŠ¶å†µï¼Œæ—¥å¿—å¯¹è°ƒè¯•é—®é¢˜å’Œç›‘æ§é›†ç¾¤æ´»åŠ¨éå¸¸æœ‰ç”¨ã€‚åº”ç”¨å®¹å™¨åŒ–åï¼Œæœ€ç®€å•ä¸”æœ€å¹¿æ³›é‡‡ç”¨çš„æ—¥å¿—è®°å½•æ–¹å¼å°±æ˜¯å†™å…¥æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨å½“å‰åˆ†å¸ƒå¼ç³»ç»Ÿã€å¤§è§„æ¨¡é›†ç¾¤çš„æ—¶ä»£ä¸‹ï¼Œä¸Šè¿°æ–¹æ¡ˆè¿˜ä¸è¶³ä»¥è¾¾åˆ°ç”Ÿäº§ç¯å¢ƒçš„æ ‡å‡†ã€‚é¦–å…ˆï¼Œå¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿè€Œè¨€ï¼Œæ—¥å¿—éƒ½æ˜¯åˆ†æ•£åœ¨å•ä¸ªå®¹å™¨é‡Œé¢ï¼Œæ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€æ±‡æ€»çš„åœ°æ–¹ã€‚å…¶æ¬¡ï¼Œå¦‚æœå‘ç”Ÿå®¹å™¨å´©æºƒã€Podè¢«é©±é€ç­‰åœºæ™¯ï¼Œä¼šå‡ºç°æ—¥å¿—ä¸¢å¤±çš„æƒ…å†µã€‚å› æ­¤ï¼Œéœ€è¦ä¸€ç§æ›´åŠ å¯é ï¼Œç‹¬ç«‹äºå®¹å™¨ç”Ÿå‘½å‘¨æœŸçš„æ—¥å¿—è§£å†³æ–¹æ¡ˆã€‚</p><p>Sidecar logging architectures æ˜¯å°†logging agentæ”¾åˆ°ä¸€ä¸ªç‹¬ç«‹çš„sidecarå®¹å™¨ä¸­ï¼Œé€šè¿‡å…±äº«æ—¥å¿—ç›®å½•çš„æ–¹å¼ï¼Œå®ç°å®¹å™¨æ—¥å¿—çš„é‡‡é›†ï¼Œç„¶åå­˜å‚¨åˆ°æ—¥å¿—å¹³å°çš„åç«¯å­˜å‚¨ã€‚</p><p><img alt="logsidecar" src="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/assets/images/logsidecar-e3784d7378b906f91df3393e6d716490.png"></p><p>é˜¿é‡Œå·´å·´ä»¥åŠèš‚èšé›†å›¢å†…éƒ¨åŒæ ·ä¹Ÿæ˜¯åŸºäºè¿™ç§æ¶æ„å®ç°äº†å®¹å™¨çš„æ—¥å¿—é‡‡é›†ï¼Œä¸‹é¢æˆ‘å°†ä»‹ç»OpenKruise SidecarSetå¦‚ä½•åŠ©åŠ› Sidecaræ—¥å¿—æ¶æ„åœ¨kubernetesé›†ç¾¤ä¸­çš„å¤§è§„æ¨¡è½åœ°å®è·µã€‚</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="è‡ªåŠ¨æ³¨å…¥">è‡ªåŠ¨æ³¨å…¥<a aria-hidden="true" class="hash-link" href="#è‡ªåŠ¨æ³¨å…¥" title="Direct link to heading">â€‹</a></h2><p>OpenKruise SidecarSetåŸºäºkubernetes AdmissionWebhookæœºåˆ¶å®ç°äº†sidecarå®¹å™¨çš„è‡ªåŠ¨æ³¨å…¥ï¼Œå› æ­¤åªè¦å°†sidecaré…ç½®åˆ°SidecarSetä¸­ï¼Œä¸ç®¡ç”¨æˆ·ç”¨ CloneSetã€Deploymentã€StatefulSet ç­‰ä»»ä½•æ–¹å¼éƒ¨ç½²ï¼Œæ‰©å‡ºæ¥çš„ Pod ä¸­éƒ½ä¼šæ³¨å…¥å®šä¹‰å¥½çš„ sidecar å®¹å™¨ã€‚</p><p><img alt="inject sidecar" src="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/assets/images/inject_sidecar-d17db953d6c3b59583124c7c272549b0.png"></p><p>Sidecarå®¹å™¨çš„æ‰€æœ‰è€…åªéœ€è¦é…ç½®è‡ªèº«çš„SidecarSetï¼Œå°±å¯ä»¥åœ¨ä¸šåŠ¡æ— æ„ŸçŸ¥çš„æƒ…å†µä¸‹å®Œæˆsidecarå®¹å™¨çš„æ³¨å…¥ï¼Œè¿™ç§æ–¹å¼æå¤§çš„é™ä½äº†sidecarå®¹å™¨ä½¿ç”¨çš„é—¨æ§›ï¼Œä¹Ÿæ–¹ä¾¿äº†sidecaræ‰€æœ‰è€…çš„ç®¡ç†å·¥ä½œã€‚ä¸ºäº†æ»¡è¶³sidecaræ³¨å…¥çš„å¤šç§åœºæ™¯ï¼ŒSidecarSeté™¤containersä¹‹å¤–è¿˜æ‰©å±•äº†å¦‚ä¸‹å­—æ®µï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"># sidecarset.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: SidecarSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: test-sidecarset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # é€šè¿‡selectoré€‰æ‹©pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      app: web-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # æŒ‡å®š namespace ç”Ÿæ•ˆ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: ns-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # container definition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: logtail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image: logtail:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # å…±äº«æŒ‡å®šå·</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: web-log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      mountPath: /var/log/web</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # å…±äº«æ‰€æœ‰å·</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    shareVolumePolicy: disabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ç¯å¢ƒå˜é‡å…±äº«</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    transferEnv:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - sourceContainerName: web-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # TZä»£è¡¨æ—¶åŒºï¼Œä¾‹å¦‚ï¼šweb-serverå®¹å™¨ä¸­å­˜åœ¨ç¯å¢ƒå˜é‡ TZ=Asia/Shanghai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    envName: TZ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: web-log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      emptyDir: {}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Podé€‰æ‹©å™¨<ul><li>æ”¯æŒselectoræ¥é€‰æ‹©è¦æ³¨å…¥çš„Podï¼Œå¦‚ç¤ºä¾‹ä¸­å°†é€‰æ‹©labels<!-- -->[app]<!-- --> = web-serverçš„podï¼Œå°†logtailå®¹å™¨æ³¨å…¥è¿›å»ï¼Œä¹Ÿå¯ä»¥åœ¨æ‰€æœ‰çš„podä¸­æ·»åŠ ä¸€ä¸ªlabels<!-- -->[inject/logtail]<!-- --> = trueçš„æ–¹å¼ï¼Œæ¥å®ç°å…¨å±€æ€§çš„sidecaræ³¨å…¥ã€‚</li><li>namespaceï¼šsidecarSeté»˜è®¤æ˜¯å…¨å±€ç”Ÿæ•ˆçš„ï¼Œå¦‚æœåªæƒ³å¯¹æŸä¸€ä¸ªnamespaceç”Ÿæ•ˆï¼Œåˆ™é…ç½®è¯¥å‚æ•°</li></ul></li><li>æ•°æ®å·å…±äº«ï¼š<ul><li>å…±äº«æŒ‡å®šå·ï¼šé€šè¿‡volumeMountså’Œvolumeså¯ä»¥å®Œæˆä¸ä¸»å®¹å™¨çš„ç‰¹å®šå·çš„å…±äº«ï¼Œå¦‚ç¤ºä¾‹ä¸­é€šè¿‡å…±äº«web-log volumeæ¥è¾¾åˆ°æ—¥å¿—é‡‡é›†çš„æ•ˆæœ</li><li>å…±äº«æ‰€æœ‰å·ï¼šé€šè¿‡ shareVolumePolicy = enabled | disabled æ¥æ§åˆ¶æ˜¯å¦æŒ‚è½½podä¸»å®¹å™¨çš„æ‰€æœ‰å·å·ï¼Œå¸¸ç”¨äºæ—¥å¿—æ”¶é›†ç­‰ sidecarï¼Œé…ç½®ä¸º enabled åä¼šæŠŠåº”ç”¨å®¹å™¨ä¸­æ‰€æœ‰æŒ‚è½½ç‚¹æ³¨å…¥ sidecar åŒä¸€è·¯ç»ä¸‹(sidecarä¸­æœ¬èº«å°±æœ‰å£°æ˜çš„æ•°æ®å·å’ŒæŒ‚è½½ç‚¹é™¤å¤–ï¼‰</li></ul></li><li>ç¯å¢ƒå˜é‡å…±äº« å¯ä»¥é€šè¿‡ transferEnv ä»å…¶å®ƒå®¹å™¨ä¸­è·å–ç¯å¢ƒå˜é‡ï¼Œä¼šæŠŠåä¸º sourceContainerName å®¹å™¨ä¸­åä¸º envName çš„ç¯å¢ƒå˜é‡æ‹·è´åˆ°æœ¬sidecarå®¹å™¨ï¼Œå¦‚ç¤ºä¾‹ä¸­ æ—¥å¿—sidecarå®¹å™¨å…±äº«äº†ä¸»å®¹å™¨çš„æ—¶åŒºTZï¼Œè¿™åœ¨æµ·å¤–ç¯å¢ƒä¸­å°¤å…¶å¸¸è§</li></ul><p>æ³¨æ„ï¼škubernetesç¤¾åŒºå¯¹äºå·²ç»åˆ›å»ºçš„Podä¸å…è®¸ä¿®æ”¹containeræ•°é‡ï¼Œæ‰€ä»¥ä¸Šè¿°æ³¨å…¥èƒ½åŠ›åªèƒ½å‘ç”Ÿåœ¨Podåˆ›å»ºé˜¶æ®µï¼Œå¯¹äºå·²ç»åˆ›å»ºçš„Podéœ€è¦é€šè¿‡é‡å»ºçš„æ–¹å¼æ¥æ³¨å…¥ã€‚</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="åŸåœ°å‡çº§">åŸåœ°å‡çº§<a aria-hidden="true" class="hash-link" href="#åŸåœ°å‡çº§" title="Direct link to heading">â€‹</a></h2><p>SidecarSetä¸ä»…å®ç°sidecarå®¹å™¨çš„æ³¨å…¥ï¼Œè€Œä¸”å¤ç”¨äº†OpenKruiseä¸­åŸåœ°å‡çº§çš„ç‰¹æ€§ï¼Œå®ç°äº†åœ¨ä¸é‡å¯Podå’Œä¸»å®¹å™¨çš„å‰æä¸‹å•ç‹¬å‡çº§sidecarå®¹å™¨çš„èƒ½åŠ›ã€‚ç”±äºè¿™ç§å‡çº§æ–¹å¼åŸºæœ¬ä¸Šèƒ½åšåˆ°ä¸šåŠ¡æ–¹æ— æ„ŸçŸ¥çš„ç¨‹åº¦ï¼Œæ‰€ä»¥sidecarå®¹å™¨çš„å‡çº§å·²ä¸å†æ˜¯ä¸Šä¸‹äº¤å›°çš„éš¾é¢˜ï¼Œä»è€Œæå¤§è§£æ”¾äº†sidecarçš„æ‰€æœ‰è€…ï¼Œæå‡äº†sidecarç‰ˆæœ¬è¿­ä»£çš„é€Ÿåº¦ã€‚</p><p><img alt="inplace sidecar" src="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/assets/images/inplace_sidecar-f00ef87888dab2a820b7401f01ced12c.png"></p><p>æ³¨æ„ï¼škubernetesç¤¾åŒºå¯¹äºå·²ç»åˆ›å»ºçš„Podåªå…è®¸ä¿®æ”¹ container.image å­—æ®µï¼Œå› æ­¤å¯¹äºsidecarå®¹å™¨çš„ä¿®æ”¹åŒ…å«é™¤ container.image çš„å…¶å®ƒå­—æ®µï¼Œåˆ™éœ€è¦é€šè¿‡Podé‡å»ºçš„æ–¹å¼ï¼Œä¸èƒ½ç›´æ¥åŸåœ°å‡çº§ã€‚</p><p>ä¸ºäº†æ»¡è¶³ä¸€äº›å¤æ‚çš„sidecarå‡çº§åœºæ™¯ï¼ŒSidecarSeté™¤äº†åŸåœ°å‡çº§ä»¥å¤–ï¼Œè¿˜æä¾›äº†éå¸¸ä¸°å¯Œçš„ç°åº¦å‘å¸ƒç­–ç•¥ã€‚</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="ç°åº¦å‘å¸ƒ">ç°åº¦å‘å¸ƒ<a aria-hidden="true" class="hash-link" href="#ç°åº¦å‘å¸ƒ" title="Direct link to heading">â€‹</a></h2><p>ç°åº¦å‘å¸ƒåº”è¯¥ç®—æ˜¯æ—¥å¸¸å‘å¸ƒä¸­æœ€å¸¸è§çš„ä¸€ç§æ‰‹æ®µï¼Œå®ƒèƒ½å¤Ÿæ¯”è¾ƒå¹³æ»‘çš„å®Œæˆsidecarå®¹å™¨çš„å‘å¸ƒï¼Œå°¤å…¶æ˜¯åœ¨å¤§è§„æ¨¡é›†ç¾¤çš„åœºæ™¯ä¸‹ï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚ä¸‹é¢æ˜¯ é¦–æ‰¹æš‚åœï¼Œåç»­åŸºäº æœ€å¤§ä¸å¯ç”¨ æ»šåŠ¨å‘å¸ƒ çš„ä¾‹å­ï¼Œå‡è®¾ä¸€ä¸ªæœ‰1000ä¸ªpodéœ€è¦å‘å¸ƒï¼š</p><div class="codeBlockContainer_K1bP language-yaml"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SidecarSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecarset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RollingUpdate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">partition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">980</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxUnavailable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10%</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>ä¸Šè¿°é…ç½®é¦–å…ˆå‘å¸ƒï¼ˆ1000 - 980ï¼‰= 20 ä¸ªpodä¹‹åå°±ä¼šæš‚åœå‘å¸ƒï¼Œä¸šåŠ¡å¯ä»¥è§‚å¯Ÿä¸€æ®µæ—¶é—´å‘ç° sidecar å®¹å™¨æ­£å¸¸åï¼Œè°ƒæ•´é‡æ–° update SidecarSet é…ç½®ï¼š</p><div class="codeBlockContainer_K1bP language-yaml"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SidecarSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecarset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RollingUpdate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxUnavailable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10%</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>è¿™æ ·è°ƒæ•´åï¼Œå¯¹äºä½™ä¸‹çš„ 980 ä¸ªpodï¼Œå°†ä¼šæŒ‰ç…§æœ€å¤§ä¸å¯ç”¨çš„æ•°é‡ï¼ˆ10% * 1000 = 100ï¼‰çš„é¡ºåºè¿›è¡Œå‘å¸ƒï¼Œç›´åˆ°æ‰€æœ‰çš„podéƒ½å‘å¸ƒå®Œæˆã€‚</p><p>Partition çš„è¯­ä¹‰æ˜¯ ä¿ç•™æ—§ç‰ˆæœ¬ Pod çš„æ•°é‡æˆ–ç™¾åˆ†æ¯”ï¼Œé»˜è®¤ä¸º 0ã€‚è¿™é‡Œçš„ partition ä¸è¡¨ç¤ºä»»ä½• order åºå·ã€‚å¦‚æœåœ¨å‘å¸ƒè¿‡ç¨‹ä¸­è®¾ç½®äº† partition:</p><ul><li>å¦‚æœæ˜¯æ•°å­—ï¼Œæ§åˆ¶å™¨ä¼šå°† (replicas - partition) æ•°é‡çš„ Pod æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚</li><li>å¦‚æœæ˜¯ç™¾åˆ†æ¯”ï¼Œæ§åˆ¶å™¨ä¼šå°† (replicas * (100% - partition)) æ•°é‡çš„ Pod æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚</li></ul><p>MaxUnavailable æ˜¯å‘å¸ƒè¿‡ç¨‹ä¸­ä¿è¯çš„ï¼ŒåŒä¸€æ—¶é—´ä¸‹æœ€å¤§ä¸å¯ç”¨çš„ Pod æ•°é‡ï¼Œé»˜è®¤å€¼ä¸º 1ã€‚ç”¨æˆ·å¯ä»¥å°†å…¶è®¾ç½®ä¸ºç»å¯¹å€¼æˆ–ç™¾åˆ†æ¯”ï¼ˆç™¾åˆ†æ¯”ä¼šè¢«æ§åˆ¶å™¨æŒ‰ç…§selected podåšåŸºæ•°æ¥è®¡ç®—å‡ºä¸€ä¸ªèƒŒåçš„ç»å¯¹å€¼ï¼‰ã€‚</p><p>æ³¨æ„ï¼šmaxUnavailable å’Œ partition ä¸¤ä¸ªå€¼æ˜¯æ²¡æœ‰å¿…ç„¶å…³è”ã€‚ä¸¾ä¾‹ï¼š</p><ul><li>å½“ {matched pod}=100,partition=50,maxUnavailable=10ï¼Œæ§åˆ¶å™¨ä¼šå‘å¸ƒ 50 ä¸ª Pod åˆ°æ–°ç‰ˆæœ¬ï¼Œä½†æ˜¯å‘å¸ƒçª—å£ä¸º 10ï¼Œå³åŒä¸€æ—¶é—´åªä¼šå‘å¸ƒ 10 ä¸ª Podï¼Œæ¯å‘å¸ƒå¥½ä¸€ä¸ª Pod æ‰ä¼šå†æ‰¾ä¸€ä¸ªå‘å¸ƒï¼Œç›´åˆ° 50 ä¸ªå‘å¸ƒå®Œæˆã€‚</li><li>å½“ {matched pod}=100,partition=80,maxUnavailable=30ï¼Œæ§åˆ¶å™¨ä¼šå‘å¸ƒ 20 ä¸ª Pod åˆ°æ–°ç‰ˆæœ¬ï¼Œå› ä¸ºæ»¡è¶³ maxUnavailable æ•°é‡ï¼Œæ‰€ä»¥è¿™ 20 ä¸ª Pod ä¼šåŒæ—¶å‘å¸ƒã€‚</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="é‡‘ä¸é›€å‘å¸ƒ">é‡‘ä¸é›€å‘å¸ƒ<a aria-hidden="true" class="hash-link" href="#é‡‘ä¸é›€å‘å¸ƒ" title="Direct link to heading">â€‹</a></h2><p>å¯¹äºæœ‰é‡‘ä¸é›€å‘å¸ƒéœ€æ±‚çš„ä¸šåŠ¡ï¼Œå¯ä»¥é€šè¿‡strategy.selectoræ¥å®ç°ã€‚æ–¹å¼ï¼šå¯¹äºéœ€è¦ç‡å…ˆé‡‘ä¸é›€ç°åº¦çš„podæ‰“ä¸Šå›ºå®šçš„labels<!-- -->[canary.release]<!-- --> = trueï¼Œå†é€šè¿‡strategy.selector.matchLabelsæ¥é€‰ä¸­è¯¥pod</p><div class="codeBlockContainer_K1bP language-yaml"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SidecarSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecarset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RollingUpdate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">canary.release</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxUnavailable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10%</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>ä¸Šè¿°é…ç½®åªä¼šå‘å¸ƒæ‰“ä¸Šé‡‘ä¸é›€labelsçš„å®¹å™¨ï¼Œåœ¨å®Œæˆé‡‘ä¸é›€éªŒè¯ä¹‹åï¼Œé€šè¿‡å°† updateStrategy.selector é…ç½®å»æ‰ï¼Œå°±ä¼šç»§ç»­é€šè¿‡ æœ€å¤§ä¸å¯ç”¨ æ¥æ»šåŠ¨å‘å¸ƒã€‚</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="æ‰“æ•£å‘å¸ƒ">æ‰“æ•£å‘å¸ƒ<a aria-hidden="true" class="hash-link" href="#æ‰“æ•£å‘å¸ƒ" title="Direct link to heading">â€‹</a></h2><p>SidecarSetå¯¹äºpodçš„å‡çº§é¡ºåºï¼Œé»˜è®¤æŒ‰ç…§å¦‚ä¸‹è§„åˆ™ï¼š</p><ul><li>å¯¹å‡çº§çš„podé›†åˆï¼Œä¿è¯å¤šæ¬¡å‡çº§çš„é¡ºåºä¸€è‡´</li><li>é€‰æ‹©ä¼˜å…ˆé¡ºåºæ˜¯ï¼ˆè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰ï¼š unscheduled &lt; scheduled, pending &lt; unknown &lt; running, not-ready &lt; ready, newer pods &lt; older pods</li></ul><p>é™¤äº†ä¸Šè¿°é»˜è®¤å‘å¸ƒé¡ºåºä¹‹å¤–ï¼Œscatteræ‰“æ•£ç­–ç•¥å…è®¸ç”¨æˆ· è‡ªå®šä¹‰å°†ç¬¦åˆæŸäº›æ ‡ç­¾çš„ Pod æ‰“æ•£ åˆ°æ•´ä¸ªå‘å¸ƒè¿‡ç¨‹ä¸­ã€‚æ¯”å¦‚ï¼Œå¯¹äºåƒ logtail è¿™ç§å…¨å±€æ€§çš„ sidecar containerï¼Œä¸€ä¸ªé›†ç¾¤å½“ä¸­å¾ˆå¯èƒ½æ³¨å…¥äº†å‡ åä¸ªä¸šåŠ¡podï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨åŸºäº åº”ç”¨å çš„æ–¹å¼æ¥æ‰“æ•£logtailçš„æ–¹å¼è¿›è¡Œå‘å¸ƒï¼Œå®ç° ä¸åŒåº”ç”¨é—´æ‰“æ•£ç°åº¦å‘å¸ƒ çš„æ•ˆæœï¼Œå¹¶ä¸”è¿™ç§æ–¹å¼å¯ä»¥åŒ æœ€å¤§ä¸å¯ç”¨ ä¸€èµ·ä½¿ç”¨ã€‚</p><div class="codeBlockContainer_K1bP language-yaml"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SidecarSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecarset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RollingUpdate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># é…ç½®pod labelsï¼Œå‡è®¾æ‰€æœ‰çš„podéƒ½åŒ…å«labels[app_name]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">scatterStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> api</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxUnavailable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10%</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>æ³¨æ„ï¼šå½“å‰ç‰ˆæœ¬å¿…é¡»è¦åˆ—ä¸¾æ‰€æœ‰çš„åº”ç”¨åç§°ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸ªç‰ˆæœ¬æ”¯æŒ åªé…ç½®label key çš„æ™ºèƒ½æ‰“æ•£æ–¹å¼ã€‚</p><header><h1>æ€»ç»“</h1></header><p>æœ¬æ¬¡ OpenKruise v0.8.0 ç‰ˆæœ¬çš„å‡çº§ï¼ŒSidecarSetç‰¹æ€§ä¸»è¦æ˜¯å®Œå–„äº† æ—¥å¿—ç®¡ç†ç±»Sidecar åœºæ™¯çš„èƒ½åŠ›ï¼Œåç»­æˆ‘ä»¬åœ¨æŒç»­æ·±è€•SidecarSetç¨³å®šæ€§ã€æ€§èƒ½çš„åŒæ—¶ï¼Œä¹Ÿå°†è¦†ç›–æ›´å¤šçš„åœºæ™¯ï¼Œæ¯”å¦‚ä¸‹ä¸€ä¸ªç‰ˆæœ¬å°†ä¼šå¢åŠ é’ˆå¯¹ Service Meshåœºæ™¯ çš„æ”¯æŒã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿæ¬¢è¿æ›´å¤šçš„åŒå­¦å‚ä¸åˆ° OpenKruise ç¤¾åŒºæ¥ï¼Œå…±åŒå»ºè®¾ä¸€ä¸ªåœºæ™¯æ›´åŠ ä¸°å¯Œã€å®Œå–„çš„ K8s åº”ç”¨ç®¡ç†ã€äº¤ä»˜æ‰©å±•èƒ½åŠ›ï¼Œèƒ½å¤Ÿé¢å‘æ›´åŠ è§„æ¨¡åŒ–ã€å¤æ‚åŒ–ã€æè‡´æ€§èƒ½çš„åœºæ™¯ã€‚</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/zh/blog/tags/workload">workload</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/zh/blog/tags/sidecar">sidecar</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about OpenKruise 0.8.0, A Powerful Tool for Sidecar Container Management" href="/zh/blog/SidecarSet"><b>æ›´å¤š</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/zh/blog/SidecarSet">OpenKruise 0.8.0, A Powerful Tool for Sidecar Container Management</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-03-15T00:00:00.000Z" itemprop="datePublished">2021å¹´3æœˆ15æ—¥</time> Â· <!-- -->é˜…è¯»éœ€è¦ 1 åˆ†é’Ÿ</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://github.com/zmberg" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://github.com/zmberg.png" alt="Mingshan Zhao"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/zmberg" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Mingshan Zhao</span></a></div><small class="avatar__subtitle" itemprop="description">Member of OpenKruise</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>OpenKruise æ˜¯é˜¿é‡Œäº‘å¼€æºçš„äº‘åŸç”Ÿåº”ç”¨è‡ªåŠ¨åŒ–ç®¡ç†å¥—ä»¶ï¼Œä¹Ÿæ˜¯å½“å‰æ‰˜ç®¡åœ¨ Cloud Native Computing Foundation (CNCF) ä¸‹çš„Sandboxé¡¹ç›®ã€‚å®ƒæ¥è‡ªé˜¿é‡Œå·´å·´å¤šå¹´æ¥å®¹å™¨åŒ–ã€äº‘åŸç”Ÿçš„æŠ€æœ¯æ²‰æ·€ï¼Œæ˜¯é˜¿é‡Œå†…éƒ¨ç”Ÿäº§ç¯å¢ƒå¤§è§„æ¨¡åº”ç”¨çš„åŸºäºKubernetesä¹‹ä¸Šçš„æ ‡å‡†æ‰©å±•ç»„ä»¶ï¼Œä¹Ÿæ˜¯ç´§è´´ä¸Šæ¸¸ç¤¾åŒºæ ‡å‡†ã€é€‚åº”äº’è”ç½‘è§„æ¨¡åŒ–åœºæ™¯çš„æŠ€æœ¯ç†å¿µä¸æœ€ä½³å®è·µã€‚</p><p>OpenKruiseåœ¨2021.3.4å‘å¸ƒäº†æœ€æ–°çš„v0.8.0ç‰ˆæœ¬ï¼Œå…¶ä¸­å¢å¼ºäº†SidecarSetçš„èƒ½åŠ›ï¼Œç‰¹åˆ«æ˜¯å¯¹æ—¥å¿—ç®¡ç†ç±»Sidecaræœ‰äº†æ›´åŠ å®Œå–„çš„æ”¯æŒã€‚</p><header><h1>èƒŒæ™¯</h1></header><p>Sidecaræ˜¯äº‘åŸç”Ÿä¸­ä¸€ç§éå¸¸é‡è¦çš„å®¹å™¨è®¾è®¡æ¨¡å¼ï¼Œå®ƒå°†è¾…åŠ©èƒ½åŠ›ä»ä¸»å®¹å™¨ä¸­å‰¥ç¦»å‡ºæ¥æˆä¸ºå•ç‹¬çš„sidecarå®¹å™¨ã€‚åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œé€šå¸¸ä¹Ÿä½¿ç”¨sidecaræ¨¡å¼å°†å¾®æœåŠ¡ä¸­çš„é…ç½®ç®¡ç†ã€æœåŠ¡å‘ç°ã€è·¯ç”±ã€ç†”æ–­ç­‰é€šç”¨èƒ½åŠ›ä»ä¸»ç¨‹åºä¸­å‰¥ç¦»å‡ºæ¥ï¼Œä»è€Œæå¤§é™ä½äº†å¾®æœåŠ¡æ¶æ„ä¸­çš„å¤æ‚æ€§ã€‚éšç€Service Meshçš„é€æ­¥é£é¡ï¼Œsidecaræ¨¡å¼ä¹Ÿæ—¥ç›Šæ·±å…¥äººå¿ƒï¼Œåœ¨é˜¿é‡Œå·´å·´é›†å›¢å†…éƒ¨ä¹Ÿå¤§é‡ä½¿ç”¨sidecaræ¨¡å¼æ¥ç®¡ç†è¯¸å¦‚è¿ç»´ã€å®‰å…¨ã€æ¶ˆæ¯ä¸­é—´ä»¶ç­‰é€šç”¨ç»„ä»¶ã€‚</p><p>åœ¨Kubernetesé›†ç¾¤ä¸­ï¼ŒPodä¸ä»…å¯ä»¥å®ç°ä¸»å®¹å™¨ä¸sidecarå®¹å™¨çš„æ„å»ºï¼ŒåŒæ—¶æä¾›äº†è®¸å¤šåŠŸèƒ½å¼ºå¤§çš„workloadï¼ˆä¾‹å¦‚ï¼šdeploymentã€statefulsetï¼‰æ¥å¯¹Podè¿›è¡Œç®¡ç†ã€å‡çº§ã€‚ä½†æ˜¯éšç€kubernetesé›†ç¾¤ä¸Šçš„ä¸šåŠ¡æ—¥ç›Šå¢å¤šï¼Œsidecarå®¹å™¨çš„ç§ç±»ä¸è§„æ¨¡ä¹Ÿéšä¹‹æ—¥ç›Šåºå¤§ï¼Œå¯¹çº¿ä¸Šsidecarå®¹å™¨çš„ç®¡ç†å’Œå‡çº§æˆä¸ºäº†æ„ˆå‘ç¹æ‚çš„å·¥ä½œï¼š</p><ol><li>ä¸šåŠ¡Podé‡Œé¢åŒ…å«äº†è¿ç»´ã€å®‰å…¨ã€ä»£ç†ç­‰å¤šä¸ªsidecarå®¹å™¨ï¼Œä¸šåŠ¡çº¿åŒå­¦ä¸ä»…è¦å®Œæˆè‡ªèº«ä¸»å®¹å™¨çš„é…ç½®ï¼Œè€Œä¸”è¿˜éœ€è¦ç†Ÿæ‚‰è¿™äº›sidecarå®¹å™¨çš„é…ç½®ï¼Œè¿™ä¸ä»…å¢åŠ äº†ä¸šåŠ¡åŒå­¦çš„å·¥ä½œé‡ï¼ŒåŒæ—¶ä¹Ÿæ— å½¢å¢åŠ äº†sidecarå®¹å™¨é…ç½®çš„é£é™©ã€‚</li><li>sidecarå®¹å™¨çš„å‡çº§éœ€è¦è¿åŒä¸šåŠ¡ä¸»å®¹å™¨ä¸€èµ·é‡å¯ï¼ˆdeploymentã€statefulsetç­‰workloadåŸºäºPodé”€æ¯ã€é‡å»ºçš„æ¨¡å¼ï¼Œæ¥å®ç°Podçš„æ»šåŠ¨å‡çº§ï¼‰ï¼Œæ¨åŠ¨å’Œå‡çº§æ”¯æ’‘ç€çº¿ä¸Šæ•°ç™¾æ¬¾ä¸šåŠ¡çš„sidecarå®¹å™¨ï¼Œå¿…ç„¶å­˜åœ¨ç€æå¤§çš„ä¸šåŠ¡é˜»åŠ›ã€‚</li><li>ä½œä¸ºsidecarå®¹å™¨çš„æä¾›è€…å¯¹çº¿ä¸Šè¯¸å¤šå„ç§é…ç½®ä»¥åŠç‰ˆæœ¬çš„sidecarå®¹å™¨æ²¡æœ‰ç›´æ¥æœ‰æ•ˆçš„å‡çº§æ‰‹æ®µï¼Œè¿™å¯¹sidecarå®¹å™¨çš„ç®¡ç†æ„å‘³ç€æå¤§çš„æ½œåœ¨é£é™©ã€‚</li></ol><p>é˜¿é‡Œå·´å·´é›†å›¢å†…éƒ¨æ‹¥æœ‰ç€ç™¾ä¸‡çº§çš„å®¹å™¨æ•°é‡è¿åŒä¸Šé¢æ‰¿è½½çš„ä¸Šåƒä¸ªä¸šåŠ¡ï¼Œå› æ­¤ï¼Œsidecarå®¹å™¨çš„ç®¡ç†ä¸å‡çº§ä¹Ÿå°±æˆä¸ºäº†äºŸå¾…å®Œå–„çš„ä¸»é¢˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ€»ç»“äº†å†…éƒ¨è®¸å¤šsidecarå®¹å™¨çš„é€šç”¨åŒ–éœ€æ±‚ï¼Œå¹¶å°†å…¶æ²‰æ·€åˆ°OpenKruiseä¸Šé¢ï¼Œæœ€ç»ˆæŠ½è±¡ä¸ºSidecarSetä½œä¸ºç®¡ç†å’Œå‡çº§ç§ç±»ç¹å¤šsidecarå®¹å™¨çš„åˆ©å™¨ã€‚</p><header><h1>OpenKruise SidecarSet</h1></header><p>SidecarSetæ˜¯OpenKruiseä¸­é’ˆå¯¹sidecaræŠ½è±¡å‡ºæ¥çš„æ¦‚å¿µï¼Œè´Ÿè´£æ³¨å…¥å’Œå‡çº§kubernetesé›†ç¾¤ä¸­çš„sidecarå®¹å™¨ï¼Œæ˜¯OpenKruiseçš„æ ¸å¿ƒworkloadä¹‹ä¸€ã€‚å®ƒæä¾›äº†éå¸¸ä¸°å¯Œçš„åŠŸèƒ½ï¼Œç”¨æˆ·ä½¿ç”¨SidecarSetå¯ä»¥éå¸¸æ–¹ä¾¿å®ç°sidecarå®¹å™¨çš„ç®¡ç†ã€‚ä¸»è¦ç‰¹æ€§å¦‚ä¸‹ï¼š</p><ol><li>é…ç½®å•ç‹¬ç®¡ç†ï¼šä¸ºæ¯ä¸€ä¸ªsidecarå®¹å™¨é…ç½®å•ç‹¬çš„SidecarSeté…ç½®ï¼Œæ–¹ä¾¿ç®¡ç†</li><li>è‡ªåŠ¨æ³¨å…¥ï¼šåœ¨æ–°å»ºã€æ‰©å®¹ã€é‡å»ºpodçš„åœºæ™¯ä¸­ï¼Œå®ç°sidecarå®¹å™¨çš„è‡ªåŠ¨æ³¨å…¥</li><li>åŸåœ°å‡çº§ï¼šæ”¯æŒä¸é‡å»ºpodçš„æ–¹å¼å®Œæˆsidecarå®¹å™¨çš„åŸåœ°å‡çº§ï¼Œä¸å½±å“ä¸šåŠ¡ä¸»å®¹å™¨ï¼Œå¹¶åŒ…å«ä¸°å¯Œçš„ç°åº¦å‘å¸ƒç­–ç•¥</li></ol><p>æ³¨æ„ï¼šé’ˆå¯¹Podä¸­åŒ…å«å¤šä¸ªå®¹å™¨çš„æ¨¡å¼ï¼Œå…¶ä¸­å¯¹å¤–æä¾›ä¸»è¦ä¸šåŠ¡é€»è¾‘èƒ½åŠ›çš„å®¹å™¨ç§°ä¹‹ä¸º ä¸»å®¹å™¨ï¼Œå…¶å®ƒä¸€äº›å¦‚æ—¥å¿—é‡‡é›†ã€å®‰å…¨ã€ä»£ç†ç­‰è¾…åŠ©èƒ½åŠ›çš„å®¹å™¨ç§°ä¹‹ä¸º Sidecarå®¹å™¨ã€‚ä¾‹å¦‚ï¼šä¸€ä¸ªå¯¹å¤–æä¾›webèƒ½åŠ›çš„podï¼Œnginxå®¹å™¨æä¾›ä¸»è¦çš„web serverèƒ½åŠ›å³ä¸º ä¸»å®¹å™¨ï¼Œlogtailå®¹å™¨è´Ÿè´£é‡‡é›†ã€ä¸ŠæŠ¥nginxæ—¥å¿—å³ä¸º Sidecarå®¹å™¨ã€‚æœ¬æ–‡ä¸­çš„SidecarSetèµ„æºæŠ½è±¡ä¹Ÿæ˜¯ä¸ºè§£å†³ Sidecarå®¹å™¨ çš„ä¸€äº›é—®é¢˜ã€‚</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="sidecar-logging-architectures">Sidecar logging architectures<a aria-hidden="true" class="hash-link" href="#sidecar-logging-architectures" title="Direct link to heading">â€‹</a></h2><p>åº”ç”¨æ—¥å¿—å¯ä»¥è®©ä½ äº†è§£åº”ç”¨å†…éƒ¨çš„è¿è¡ŒçŠ¶å†µï¼Œæ—¥å¿—å¯¹è°ƒè¯•é—®é¢˜å’Œç›‘æ§é›†ç¾¤æ´»åŠ¨éå¸¸æœ‰ç”¨ã€‚åº”ç”¨å®¹å™¨åŒ–åï¼Œæœ€ç®€å•ä¸”æœ€å¹¿æ³›é‡‡ç”¨çš„æ—¥å¿—è®°å½•æ–¹å¼å°±æ˜¯å†™å…¥æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨å½“å‰åˆ†å¸ƒå¼ç³»ç»Ÿã€å¤§è§„æ¨¡é›†ç¾¤çš„æ—¶ä»£ä¸‹ï¼Œä¸Šè¿°æ–¹æ¡ˆè¿˜ä¸è¶³ä»¥è¾¾åˆ°ç”Ÿäº§ç¯å¢ƒçš„æ ‡å‡†ã€‚é¦–å…ˆï¼Œå¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿè€Œè¨€ï¼Œæ—¥å¿—éƒ½æ˜¯åˆ†æ•£åœ¨å•ä¸ªå®¹å™¨é‡Œé¢ï¼Œæ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€æ±‡æ€»çš„åœ°æ–¹ã€‚å…¶æ¬¡ï¼Œå¦‚æœå‘ç”Ÿå®¹å™¨å´©æºƒã€Podè¢«é©±é€ç­‰åœºæ™¯ï¼Œä¼šå‡ºç°æ—¥å¿—ä¸¢å¤±çš„æƒ…å†µã€‚å› æ­¤ï¼Œéœ€è¦ä¸€ç§æ›´åŠ å¯é ï¼Œç‹¬ç«‹äºå®¹å™¨ç”Ÿå‘½å‘¨æœŸçš„æ—¥å¿—è§£å†³æ–¹æ¡ˆã€‚</p><p>Sidecar logging architectures æ˜¯å°†logging agentæ”¾åˆ°ä¸€ä¸ªç‹¬ç«‹çš„sidecarå®¹å™¨ä¸­ï¼Œé€šè¿‡å…±äº«æ—¥å¿—ç›®å½•çš„æ–¹å¼ï¼Œå®ç°å®¹å™¨æ—¥å¿—çš„é‡‡é›†ï¼Œç„¶åå­˜å‚¨åˆ°æ—¥å¿—å¹³å°çš„åç«¯å­˜å‚¨ã€‚</p><p><img alt="logsidecar" src="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/assets/images/logsidecar-e3784d7378b906f91df3393e6d716490.png"></p><p>é˜¿é‡Œå·´å·´ä»¥åŠèš‚èšé›†å›¢å†…éƒ¨åŒæ ·ä¹Ÿæ˜¯åŸºäºè¿™ç§æ¶æ„å®ç°äº†å®¹å™¨çš„æ—¥å¿—é‡‡é›†ï¼Œä¸‹é¢æˆ‘å°†ä»‹ç»OpenKruise SidecarSetå¦‚ä½•åŠ©åŠ› Sidecaræ—¥å¿—æ¶æ„åœ¨kubernetesé›†ç¾¤ä¸­çš„å¤§è§„æ¨¡è½åœ°å®è·µã€‚</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="è‡ªåŠ¨æ³¨å…¥">è‡ªåŠ¨æ³¨å…¥<a aria-hidden="true" class="hash-link" href="#è‡ªåŠ¨æ³¨å…¥" title="Direct link to heading">â€‹</a></h2><p>OpenKruise SidecarSetåŸºäºkubernetes AdmissionWebhookæœºåˆ¶å®ç°äº†sidecarå®¹å™¨çš„è‡ªåŠ¨æ³¨å…¥ï¼Œå› æ­¤åªè¦å°†sidecaré…ç½®åˆ°SidecarSetä¸­ï¼Œä¸ç®¡ç”¨æˆ·ç”¨ CloneSetã€Deploymentã€StatefulSet ç­‰ä»»ä½•æ–¹å¼éƒ¨ç½²ï¼Œæ‰©å‡ºæ¥çš„ Pod ä¸­éƒ½ä¼šæ³¨å…¥å®šä¹‰å¥½çš„ sidecar å®¹å™¨ã€‚</p><p><img alt="inject sidecar" src="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/assets/images/inject_sidecar-d17db953d6c3b59583124c7c272549b0.png"></p><p>Sidecarå®¹å™¨çš„æ‰€æœ‰è€…åªéœ€è¦é…ç½®è‡ªèº«çš„SidecarSetï¼Œå°±å¯ä»¥åœ¨ä¸šåŠ¡æ— æ„ŸçŸ¥çš„æƒ…å†µä¸‹å®Œæˆsidecarå®¹å™¨çš„æ³¨å…¥ï¼Œè¿™ç§æ–¹å¼æå¤§çš„é™ä½äº†sidecarå®¹å™¨ä½¿ç”¨çš„é—¨æ§›ï¼Œä¹Ÿæ–¹ä¾¿äº†sidecaræ‰€æœ‰è€…çš„ç®¡ç†å·¥ä½œã€‚ä¸ºäº†æ»¡è¶³sidecaræ³¨å…¥çš„å¤šç§åœºæ™¯ï¼ŒSidecarSeté™¤containersä¹‹å¤–è¿˜æ‰©å±•äº†å¦‚ä¸‹å­—æ®µï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"># sidecarset.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: SidecarSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: test-sidecarset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # é€šè¿‡selectoré€‰æ‹©pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      app: web-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # æŒ‡å®š namespace ç”Ÿæ•ˆ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: ns-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # container definition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: logtail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image: logtail:1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # å…±äº«æŒ‡å®šå·</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: web-log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      mountPath: /var/log/web</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # å…±äº«æ‰€æœ‰å·</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    shareVolumePolicy: disabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ç¯å¢ƒå˜é‡å…±äº«</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    transferEnv:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - sourceContainerName: web-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # TZä»£è¡¨æ—¶åŒºï¼Œä¾‹å¦‚ï¼šweb-serverå®¹å™¨ä¸­å­˜åœ¨ç¯å¢ƒå˜é‡ TZ=Asia/Shanghai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    envName: TZ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: web-log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      emptyDir: {}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Podé€‰æ‹©å™¨<ul><li>æ”¯æŒselectoræ¥é€‰æ‹©è¦æ³¨å…¥çš„Podï¼Œå¦‚ç¤ºä¾‹ä¸­å°†é€‰æ‹©labels<!-- -->[app]<!-- --> = web-serverçš„podï¼Œå°†logtailå®¹å™¨æ³¨å…¥è¿›å»ï¼Œä¹Ÿå¯ä»¥åœ¨æ‰€æœ‰çš„podä¸­æ·»åŠ ä¸€ä¸ªlabels<!-- -->[inject/logtail]<!-- --> = trueçš„æ–¹å¼ï¼Œæ¥å®ç°å…¨å±€æ€§çš„sidecaræ³¨å…¥ã€‚</li><li>namespaceï¼šsidecarSeté»˜è®¤æ˜¯å…¨å±€ç”Ÿæ•ˆçš„ï¼Œå¦‚æœåªæƒ³å¯¹æŸä¸€ä¸ªnamespaceç”Ÿæ•ˆï¼Œåˆ™é…ç½®è¯¥å‚æ•°</li></ul></li><li>æ•°æ®å·å…±äº«ï¼š<ul><li>å…±äº«æŒ‡å®šå·ï¼šé€šè¿‡volumeMountså’Œvolumeså¯ä»¥å®Œæˆä¸ä¸»å®¹å™¨çš„ç‰¹å®šå·çš„å…±äº«ï¼Œå¦‚ç¤ºä¾‹ä¸­é€šè¿‡å…±äº«web-log volumeæ¥è¾¾åˆ°æ—¥å¿—é‡‡é›†çš„æ•ˆæœ</li><li>å…±äº«æ‰€æœ‰å·ï¼šé€šè¿‡ shareVolumePolicy = enabled | disabled æ¥æ§åˆ¶æ˜¯å¦æŒ‚è½½podä¸»å®¹å™¨çš„æ‰€æœ‰å·å·ï¼Œå¸¸ç”¨äºæ—¥å¿—æ”¶é›†ç­‰ sidecarï¼Œé…ç½®ä¸º enabled åä¼šæŠŠåº”ç”¨å®¹å™¨ä¸­æ‰€æœ‰æŒ‚è½½ç‚¹æ³¨å…¥ sidecar åŒä¸€è·¯ç»ä¸‹(sidecarä¸­æœ¬èº«å°±æœ‰å£°æ˜çš„æ•°æ®å·å’ŒæŒ‚è½½ç‚¹é™¤å¤–ï¼‰</li></ul></li><li>ç¯å¢ƒå˜é‡å…±äº« å¯ä»¥é€šè¿‡ transferEnv ä»å…¶å®ƒå®¹å™¨ä¸­è·å–ç¯å¢ƒå˜é‡ï¼Œä¼šæŠŠåä¸º sourceContainerName å®¹å™¨ä¸­åä¸º envName çš„ç¯å¢ƒå˜é‡æ‹·è´åˆ°æœ¬sidecarå®¹å™¨ï¼Œå¦‚ç¤ºä¾‹ä¸­ æ—¥å¿—sidecarå®¹å™¨å…±äº«äº†ä¸»å®¹å™¨çš„æ—¶åŒºTZï¼Œè¿™åœ¨æµ·å¤–ç¯å¢ƒä¸­å°¤å…¶å¸¸è§</li></ul><p>æ³¨æ„ï¼škubernetesç¤¾åŒºå¯¹äºå·²ç»åˆ›å»ºçš„Podä¸å…è®¸ä¿®æ”¹containeræ•°é‡ï¼Œæ‰€ä»¥ä¸Šè¿°æ³¨å…¥èƒ½åŠ›åªèƒ½å‘ç”Ÿåœ¨Podåˆ›å»ºé˜¶æ®µï¼Œå¯¹äºå·²ç»åˆ›å»ºçš„Podéœ€è¦é€šè¿‡é‡å»ºçš„æ–¹å¼æ¥æ³¨å…¥ã€‚</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="åŸåœ°å‡çº§">åŸåœ°å‡çº§<a aria-hidden="true" class="hash-link" href="#åŸåœ°å‡çº§" title="Direct link to heading">â€‹</a></h2><p>SidecarSetä¸ä»…å®ç°sidecarå®¹å™¨çš„æ³¨å…¥ï¼Œè€Œä¸”å¤ç”¨äº†OpenKruiseä¸­åŸåœ°å‡çº§çš„ç‰¹æ€§ï¼Œå®ç°äº†åœ¨ä¸é‡å¯Podå’Œä¸»å®¹å™¨çš„å‰æä¸‹å•ç‹¬å‡çº§sidecarå®¹å™¨çš„èƒ½åŠ›ã€‚ç”±äºè¿™ç§å‡çº§æ–¹å¼åŸºæœ¬ä¸Šèƒ½åšåˆ°ä¸šåŠ¡æ–¹æ— æ„ŸçŸ¥çš„ç¨‹åº¦ï¼Œæ‰€ä»¥sidecarå®¹å™¨çš„å‡çº§å·²ä¸å†æ˜¯ä¸Šä¸‹äº¤å›°çš„éš¾é¢˜ï¼Œä»è€Œæå¤§è§£æ”¾äº†sidecarçš„æ‰€æœ‰è€…ï¼Œæå‡äº†sidecarç‰ˆæœ¬è¿­ä»£çš„é€Ÿåº¦ã€‚</p><p><img alt="inplace sidecar" src="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/assets/images/inplace_sidecar-f00ef87888dab2a820b7401f01ced12c.png"></p><p>æ³¨æ„ï¼škubernetesç¤¾åŒºå¯¹äºå·²ç»åˆ›å»ºçš„Podåªå…è®¸ä¿®æ”¹ container.image å­—æ®µï¼Œå› æ­¤å¯¹äºsidecarå®¹å™¨çš„ä¿®æ”¹åŒ…å«é™¤ container.image çš„å…¶å®ƒå­—æ®µï¼Œåˆ™éœ€è¦é€šè¿‡Podé‡å»ºçš„æ–¹å¼ï¼Œä¸èƒ½ç›´æ¥åŸåœ°å‡çº§ã€‚</p><p>ä¸ºäº†æ»¡è¶³ä¸€äº›å¤æ‚çš„sidecarå‡çº§åœºæ™¯ï¼ŒSidecarSeté™¤äº†åŸåœ°å‡çº§ä»¥å¤–ï¼Œè¿˜æä¾›äº†éå¸¸ä¸°å¯Œçš„ç°åº¦å‘å¸ƒç­–ç•¥ã€‚</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="ç°åº¦å‘å¸ƒ">ç°åº¦å‘å¸ƒ<a aria-hidden="true" class="hash-link" href="#ç°åº¦å‘å¸ƒ" title="Direct link to heading">â€‹</a></h2><p>ç°åº¦å‘å¸ƒåº”è¯¥ç®—æ˜¯æ—¥å¸¸å‘å¸ƒä¸­æœ€å¸¸è§çš„ä¸€ç§æ‰‹æ®µï¼Œå®ƒèƒ½å¤Ÿæ¯”è¾ƒå¹³æ»‘çš„å®Œæˆsidecarå®¹å™¨çš„å‘å¸ƒï¼Œå°¤å…¶æ˜¯åœ¨å¤§è§„æ¨¡é›†ç¾¤çš„åœºæ™¯ä¸‹ï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚ä¸‹é¢æ˜¯ é¦–æ‰¹æš‚åœï¼Œåç»­åŸºäº æœ€å¤§ä¸å¯ç”¨ æ»šåŠ¨å‘å¸ƒ çš„ä¾‹å­ï¼Œå‡è®¾ä¸€ä¸ªæœ‰1000ä¸ªpodéœ€è¦å‘å¸ƒï¼š</p><div class="codeBlockContainer_K1bP language-yaml"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SidecarSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecarset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RollingUpdate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">partition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">980</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxUnavailable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10%</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>ä¸Šè¿°é…ç½®é¦–å…ˆå‘å¸ƒï¼ˆ1000 - 980ï¼‰= 20 ä¸ªpodä¹‹åå°±ä¼šæš‚åœå‘å¸ƒï¼Œä¸šåŠ¡å¯ä»¥è§‚å¯Ÿä¸€æ®µæ—¶é—´å‘ç° sidecar å®¹å™¨æ­£å¸¸åï¼Œè°ƒæ•´é‡æ–° update SidecarSet é…ç½®ï¼š</p><div class="codeBlockContainer_K1bP language-yaml"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SidecarSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecarset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RollingUpdate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxUnavailable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10%</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>è¿™æ ·è°ƒæ•´åï¼Œå¯¹äºä½™ä¸‹çš„ 980 ä¸ªpodï¼Œå°†ä¼šæŒ‰ç…§æœ€å¤§ä¸å¯ç”¨çš„æ•°é‡ï¼ˆ10% * 1000 = 100ï¼‰çš„é¡ºåºè¿›è¡Œå‘å¸ƒï¼Œç›´åˆ°æ‰€æœ‰çš„podéƒ½å‘å¸ƒå®Œæˆã€‚</p><p>Partition çš„è¯­ä¹‰æ˜¯ ä¿ç•™æ—§ç‰ˆæœ¬ Pod çš„æ•°é‡æˆ–ç™¾åˆ†æ¯”ï¼Œé»˜è®¤ä¸º 0ã€‚è¿™é‡Œçš„ partition ä¸è¡¨ç¤ºä»»ä½• order åºå·ã€‚å¦‚æœåœ¨å‘å¸ƒè¿‡ç¨‹ä¸­è®¾ç½®äº† partition:</p><ul><li>å¦‚æœæ˜¯æ•°å­—ï¼Œæ§åˆ¶å™¨ä¼šå°† (replicas - partition) æ•°é‡çš„ Pod æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚</li><li>å¦‚æœæ˜¯ç™¾åˆ†æ¯”ï¼Œæ§åˆ¶å™¨ä¼šå°† (replicas * (100% - partition)) æ•°é‡çš„ Pod æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚</li></ul><p>MaxUnavailable æ˜¯å‘å¸ƒè¿‡ç¨‹ä¸­ä¿è¯çš„ï¼ŒåŒä¸€æ—¶é—´ä¸‹æœ€å¤§ä¸å¯ç”¨çš„ Pod æ•°é‡ï¼Œé»˜è®¤å€¼ä¸º 1ã€‚ç”¨æˆ·å¯ä»¥å°†å…¶è®¾ç½®ä¸ºç»å¯¹å€¼æˆ–ç™¾åˆ†æ¯”ï¼ˆç™¾åˆ†æ¯”ä¼šè¢«æ§åˆ¶å™¨æŒ‰ç…§selected podåšåŸºæ•°æ¥è®¡ç®—å‡ºä¸€ä¸ªèƒŒåçš„ç»å¯¹å€¼ï¼‰ã€‚</p><p>æ³¨æ„ï¼šmaxUnavailable å’Œ partition ä¸¤ä¸ªå€¼æ˜¯æ²¡æœ‰å¿…ç„¶å…³è”ã€‚ä¸¾ä¾‹ï¼š</p><ul><li>å½“ {matched pod}=100,partition=50,maxUnavailable=10ï¼Œæ§åˆ¶å™¨ä¼šå‘å¸ƒ 50 ä¸ª Pod åˆ°æ–°ç‰ˆæœ¬ï¼Œä½†æ˜¯å‘å¸ƒçª—å£ä¸º 10ï¼Œå³åŒä¸€æ—¶é—´åªä¼šå‘å¸ƒ 10 ä¸ª Podï¼Œæ¯å‘å¸ƒå¥½ä¸€ä¸ª Pod æ‰ä¼šå†æ‰¾ä¸€ä¸ªå‘å¸ƒï¼Œç›´åˆ° 50 ä¸ªå‘å¸ƒå®Œæˆã€‚</li><li>å½“ {matched pod}=100,partition=80,maxUnavailable=30ï¼Œæ§åˆ¶å™¨ä¼šå‘å¸ƒ 20 ä¸ª Pod åˆ°æ–°ç‰ˆæœ¬ï¼Œå› ä¸ºæ»¡è¶³ maxUnavailable æ•°é‡ï¼Œæ‰€ä»¥è¿™ 20 ä¸ª Pod ä¼šåŒæ—¶å‘å¸ƒã€‚</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="é‡‘ä¸é›€å‘å¸ƒ">é‡‘ä¸é›€å‘å¸ƒ<a aria-hidden="true" class="hash-link" href="#é‡‘ä¸é›€å‘å¸ƒ" title="Direct link to heading">â€‹</a></h2><p>å¯¹äºæœ‰é‡‘ä¸é›€å‘å¸ƒéœ€æ±‚çš„ä¸šåŠ¡ï¼Œå¯ä»¥é€šè¿‡strategy.selectoræ¥å®ç°ã€‚æ–¹å¼ï¼šå¯¹äºéœ€è¦ç‡å…ˆé‡‘ä¸é›€ç°åº¦çš„podæ‰“ä¸Šå›ºå®šçš„labels<!-- -->[canary.release]<!-- --> = trueï¼Œå†é€šè¿‡strategy.selector.matchLabelsæ¥é€‰ä¸­è¯¥pod</p><div class="codeBlockContainer_K1bP language-yaml"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SidecarSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecarset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RollingUpdate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">canary.release</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxUnavailable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10%</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>ä¸Šè¿°é…ç½®åªä¼šå‘å¸ƒæ‰“ä¸Šé‡‘ä¸é›€labelsçš„å®¹å™¨ï¼Œåœ¨å®Œæˆé‡‘ä¸é›€éªŒè¯ä¹‹åï¼Œé€šè¿‡å°† updateStrategy.selector é…ç½®å»æ‰ï¼Œå°±ä¼šç»§ç»­é€šè¿‡ æœ€å¤§ä¸å¯ç”¨ æ¥æ»šåŠ¨å‘å¸ƒã€‚</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="æ‰“æ•£å‘å¸ƒ">æ‰“æ•£å‘å¸ƒ<a aria-hidden="true" class="hash-link" href="#æ‰“æ•£å‘å¸ƒ" title="Direct link to heading">â€‹</a></h2><p>SidecarSetå¯¹äºpodçš„å‡çº§é¡ºåºï¼Œé»˜è®¤æŒ‰ç…§å¦‚ä¸‹è§„åˆ™ï¼š</p><ul><li>å¯¹å‡çº§çš„podé›†åˆï¼Œä¿è¯å¤šæ¬¡å‡çº§çš„é¡ºåºä¸€è‡´</li><li>é€‰æ‹©ä¼˜å…ˆé¡ºåºæ˜¯ï¼ˆè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰ï¼š unscheduled &lt; scheduled, pending &lt; unknown &lt; running, not-ready &lt; ready, newer pods &lt; older pods</li></ul><p>é™¤äº†ä¸Šè¿°é»˜è®¤å‘å¸ƒé¡ºåºä¹‹å¤–ï¼Œscatteræ‰“æ•£ç­–ç•¥å…è®¸ç”¨æˆ· è‡ªå®šä¹‰å°†ç¬¦åˆæŸäº›æ ‡ç­¾çš„ Pod æ‰“æ•£ åˆ°æ•´ä¸ªå‘å¸ƒè¿‡ç¨‹ä¸­ã€‚æ¯”å¦‚ï¼Œå¯¹äºåƒ logtail è¿™ç§å…¨å±€æ€§çš„ sidecar containerï¼Œä¸€ä¸ªé›†ç¾¤å½“ä¸­å¾ˆå¯èƒ½æ³¨å…¥äº†å‡ åä¸ªä¸šåŠ¡podï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨åŸºäº åº”ç”¨å çš„æ–¹å¼æ¥æ‰“æ•£logtailçš„æ–¹å¼è¿›è¡Œå‘å¸ƒï¼Œå®ç° ä¸åŒåº”ç”¨é—´æ‰“æ•£ç°åº¦å‘å¸ƒ çš„æ•ˆæœï¼Œå¹¶ä¸”è¿™ç§æ–¹å¼å¯ä»¥åŒ æœ€å¤§ä¸å¯ç”¨ ä¸€èµ·ä½¿ç”¨ã€‚</p><div class="codeBlockContainer_K1bP language-yaml"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SidecarSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecarset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RollingUpdate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># é…ç½®pod labelsï¼Œå‡è®¾æ‰€æœ‰çš„podéƒ½åŒ…å«labels[app_name]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">scatterStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> api</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxUnavailable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10%</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>æ³¨æ„ï¼šå½“å‰ç‰ˆæœ¬å¿…é¡»è¦åˆ—ä¸¾æ‰€æœ‰çš„åº”ç”¨åç§°ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸ªç‰ˆæœ¬æ”¯æŒ åªé…ç½®label key çš„æ™ºèƒ½æ‰“æ•£æ–¹å¼ã€‚</p><header><h1>æ€»ç»“</h1></header><p>æœ¬æ¬¡ OpenKruise v0.8.0 ç‰ˆæœ¬çš„å‡çº§ï¼ŒSidecarSetç‰¹æ€§ä¸»è¦æ˜¯å®Œå–„äº† æ—¥å¿—ç®¡ç†ç±»Sidecar åœºæ™¯çš„èƒ½åŠ›ï¼Œåç»­æˆ‘ä»¬åœ¨æŒç»­æ·±è€•SidecarSetç¨³å®šæ€§ã€æ€§èƒ½çš„åŒæ—¶ï¼Œä¹Ÿå°†è¦†ç›–æ›´å¤šçš„åœºæ™¯ï¼Œæ¯”å¦‚ä¸‹ä¸€ä¸ªç‰ˆæœ¬å°†ä¼šå¢åŠ é’ˆå¯¹ Service Meshåœºæ™¯ çš„æ”¯æŒã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿæ¬¢è¿æ›´å¤šçš„åŒå­¦å‚ä¸åˆ° OpenKruise ç¤¾åŒºæ¥ï¼Œå…±åŒå»ºè®¾ä¸€ä¸ªåœºæ™¯æ›´åŠ ä¸°å¯Œã€å®Œå–„çš„ K8s åº”ç”¨ç®¡ç†ã€äº¤ä»˜æ‰©å±•èƒ½åŠ›ï¼Œèƒ½å¤Ÿé¢å‘æ›´åŠ è§„æ¨¡åŒ–ã€å¤æ‚åŒ–ã€æè‡´æ€§èƒ½çš„åœºæ™¯ã€‚</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/zh/blog/tags/workload">workload</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/zh/blog/tags/sidecar">sidecar</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about OpenKruise 0.8.0, A Powerful Tool for Sidecar Container Management" href="/zh/blog/SidecarSet"><b>æ›´å¤š</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/zh/blog/uniteddeployment">UnitedDeploymemt - Supporting Multi-domain Workload Management</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2019-11-20T00:00:00.000Z" itemprop="datePublished">2019å¹´11æœˆ20æ—¥</time> Â· <!-- -->é˜…è¯»éœ€è¦ 1 åˆ†é’Ÿ</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://github.com/Fei-Guo" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://github.com/Fei-Guo.png" alt="Fei Guo"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Fei-Guo" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Fei Guo</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of OpenKruise</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Ironically, probably every cloud user knew (or should realized that) failures in Cloud resources
are inevitable. Hence, high availability is probably one of the most desirable features that
Cloud Provider offers for cloud users. For example, in AWS, each geographic region has
multiple isolated locations known as Availability Zones (AZs).
AWS provides various AZ-aware solutions to allow the compute or storage resources of the user
applications to be distributed across multiple AZs in order to tolerate AZ failure, which indeed
happened in the past. </p><p>In Kubernetes, the concept of AZ is not realized by an API object. Instead,
an AZ is usually represented by a group of hosts that have the same location label.
Although hosts within the same AZ can be identified by labels, the capability of distributing Pods across
AZs was missing in Kubernetes default scheduler. Hence it was difficult to use single
<code>StatefulSet</code> or <code>Deployment</code> to perform  AZ-aware Pods deployment. Fortunately,
in Kubernetes 1.16, a new feature called <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-topology-spread-constraints/" target="_blank" rel="noopener noreferrer">&quot;Pod Topology Spread Constraints&quot;</a>
was introduced. Users now can add new constraints in the Pod Spec, and scheduler
will enforce the constraints so that Pods can be distributed across failure
domains such as AZs, regions or nodes, in a uniform fashion.</p><p>In Kruise, <strong>UnitedDeploymemt</strong> provides an alternative to achieve high availability in
a cluster that consists of multiple fault domains - that is, managing multiple homogeneous
workloads, and each workload is dedicated to a single <code>Subset</code>. Pod distribution across AZs is
determined by the replica number of each workload.
Since each <code>Subset</code> is associated with a workload, UnitedDeployment can support
finer-grained rollout and deployment strategies.
In addition, UnitedDeploymemt can be further extended to support
multiple clusters! Let us reveal how UnitedDeployment is designed.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="using-subsets-to-describe-domain-topology">Using <code>Subsets</code> to describe domain topology<a aria-hidden="true" class="hash-link" href="#using-subsets-to-describe-domain-topology" title="Direct link to heading">â€‹</a></h2><p>UnitedDeploymemt uses <code>Subset</code> to represent a failure domain. <code>Subset</code> API
primarily specifies the nodes that forms the domain and the number of replicas, or
the percentage of total replicas, run in this domain. UnitedDeployment manages
subset workloads against a specific domain topology, described by a <code>Subset</code> array.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">type Topology struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Contains the details of each subset.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Subsets []Subset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type Subset struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Indicates the name of this subset, which will be used to generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // subset workload name prefix in the format &#x27;&lt;deployment-name&gt;-&lt;subset-name&gt;-&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Name string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Indicates the node select strategy to form the subset.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    NodeSelector corev1.NodeSelector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Indicates the number of the subset replicas or percentage of it on the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // UnitedDeployment replicas.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Replicas *intstr.IntOrString</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The specification of the subset workload is saved in <code>Spec.Template</code>. UnitedDeployment
only supports <code>StatefulSet</code> subset workload as of now. An interesting part of <code>Subset</code>
design is that now user can specify <strong>customized Pod distribution</strong> across AZs, which is not
necessarily a uniform distribution in some cases. For example, if the AZ
utilization or capacity are not homogeneous, evenly distributing Pods may lead to Pod deployment
failure due to lack of resources. If users have prior knowledge about AZ resource capacity/usage,
UnitedDeployment can help to apply an optimal Pod distribution to ensure overall
cluster utilization remains balanced. Of course, if not specified, a uniform Pod distribution
will be applied to maximize availability.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="customized-subset-rollout-partitions">Customized subset rollout <code>Partitions</code><a aria-hidden="true" class="hash-link" href="#customized-subset-rollout-partitions" title="Direct link to heading">â€‹</a></h2><p>User can update all the UnitedDeployment subset workloads by providing a
new version of subset workload template.
Note that UnitedDeployment does not control
the entire rollout process of all subset workloads, which is typically done by another rollout
controller built on top of it. Since the replica number in each <code>Subset</code> can be different,
it will be much more convenient to allow user to specify the individual rollout <code>Partition</code> of each
subset workload instead of using one <code>Partition</code> to rule all, so that they can be upgraded in the same pace.
UnitedDeployment provides <code>ManualUpdate</code> strategy to customize per subset rollout <code>Partition</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">type UnitedDeploymentUpdateStrategy struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Type of UnitedDeployment update.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type UpdateStrategyType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Indicates the partition of each subset.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ManualUpdate *ManualUpdate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type ManualUpdate struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Indicates number of subset partition.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Partitions map[string]int32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><img alt="multi-cluster controller" src="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/assets/images/uniteddeployment-1-55a005182c47c03e50d0607235d9403e.png"></p><p>This makes it fairly easy to coordinate multiple subsets rollout. For example,
as illustrated in Figure 1, assuming UnitedDeployment manages three subsets and
their replica numbers are 4, 2, 2 respectively, a rollout
controller can realize a canary release plan of upgrading 50% of Pods in each
subset at a time by setting subset partitions to 2, 1, 1 respectively.
The same cannot be easily achieved by using a single workload controller like <code>StatefulSet</code>
or <code>Deployment</code>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="multi-cluster-application-management-in-future">Multi-Cluster application management (In future)<a aria-hidden="true" class="hash-link" href="#multi-cluster-application-management-in-future" title="Direct link to heading">â€‹</a></h2><p>UnitedDeployment can be extended to support multi-cluster workload
management. The idea is that <code>Subsets</code> may not only
reside in one cluster, but also spread over multiple clusters.
More specifically, domain topology specification will associate
a <code>ClusterRegistryQuerySpec</code>, which describes the clusters that UnitedDeployment
may distribute Pods to. Each cluster is represented by a custom resource managed by a
ClusterRegistry controller using Kubernetes <a href="https://github.com/kubernetes/cluster-registry" target="_blank" rel="noopener noreferrer">cluster registry APIs</a>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">type Topology struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ClusterRegistryQuerySpec is used to find the all the clusters that</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // the workload may be deployed to. </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ClusterRegistry *ClusterRegistryQuerySpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Contains the details of each subset including the target cluster name and</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // the node selector in target cluster.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Subsets []Subset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type ClusterRegistryQuerySpec struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Namespaces that the cluster objects reside.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // If not specified, default namespace is used.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Namespaces []string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Selector is the label matcher to find all qualified clusters.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Selector   map[string]string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Describe the kind and APIversion of the cluster object.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ClusterType metav1.TypeMeta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type Subset struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Name string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The name of target cluster. The controller will validate that</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // the TargetCluster exits based on Topology.ClusterRegistry.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TargetCluster *TargetCluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Indicate the node select strategy in the Subset.TargetCluster.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // If Subset.TargetCluster is not set, node selector strategy refers to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // current cluster.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NodeSelector corev1.NodeSelector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Replicas *intstr.IntOrString </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type TargetCluster struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Namespace of the target cluster CRD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Namespace string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Target cluster name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Name string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>A new <code>TargetCluster</code> field is added to the <code>Subset</code> API. If it presents, the
<code>NodeSelector</code> indicates the node selection logic in the target cluster. Now
UnitedDeployment controller can distribute application Pods to multiple clusters by
instantiating a <code>StatefulSet</code> workload in each target cluster with a specific
replica number (or a percentage of total replica), as illustrated in Figure 2.</p><p><img alt="multi-cluster	controller" src="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/assets/images/uniteddeployment-2-0d3d6b19dee0e0cd3fe5bf6f121db109.png"></p><p>At a first glance, UnitedDeployment looks more like a federation
controller following the design pattern of <a href="https://github.com/kubernetes-sigs/kubefed" target="_blank" rel="noopener noreferrer">Kubefed</a>,
but it isn&#x27;t. The fundamental difference is that Kubefed focuses on propagating arbitrary
object types to remote clusters instead of managing an application across clusters.
In this example, had a Kubefed style controller been used, each <code>StatefulSet</code> workload in
individual cluster would have a replica of 100. UnitedDeployment focuses more on
providing the ability of managing multiple workloads in multiple clusters on behalf
of one application, which is absent in Kubernetes community to the best of our
knowledge.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="summary">Summary<a aria-hidden="true" class="hash-link" href="#summary" title="Direct link to heading">â€‹</a></h2><p>This blog post introduces UnitedDeployment, a new controller which helps managing
application spread over multiple domains (in arbitrary clusters).
It not only allows evenly distributing Pods over AZs,
which arguably can be more efficiently done using the new Pod Topology Spread
Constraint APIs though, but also enables flexible workload deployment/rollout and
supports multi-cluster use cases in the future.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/zh/blog/tags/workload">workload</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/zh/blog/tags/uniteddeployment">uniteddeployment</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about UnitedDeploymemt - Supporting Multi-domain Workload Management" href="/zh/blog/uniteddeployment"><b>æ›´å¤š</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/zh/blog/learning-concurrent-reconciling">Learning Concurrent Reconciling</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2019-11-10T00:00:00.000Z" itemprop="datePublished">2019å¹´11æœˆ10æ—¥</time> Â· <!-- -->é˜…è¯»éœ€è¦ 1 åˆ†é’Ÿ</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://github.com/Fei-Guo" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://github.com/Fei-Guo.png" alt="Fei Guo"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Fei-Guo" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Fei Guo</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of OpenKruise</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>The concept of controller in Kubernete is one of the most important reasons that make it successful.
Controller is the core mechanism that supports Kubernetes APIs to ensure the system reaches
the desired state. By leveraging CRDs/controllers and operators, it is fairly easy for
other systems to integrate with Kubernetes. </p><p>Controller runtime library and the corresponding controller tool <a href="https://book.kubebuilder.io/introduction.html" target="_blank" rel="noopener noreferrer">KubeBuilder</a>
are widely used by many developers to build their customized Kubernetes controllers. In Kruise project,
we also use Kubebuilder to generate scaffolding codes that implement the &quot;reconciling&quot; logic.
In this blog post, I will share some learnings from
Kruise controller development, particularly, about concurrent reconciling. </p><p>Some people may already notice that controller runtime supports concurrent reconciling.
Check for the options (<a href="https://github.com/kubernetes-sigs/controller-runtime/blob/81842d0e78f7111f0566156189806e2801e3adf1/pkg/controller/controller.go#L32" target="_blank" rel="noopener noreferrer">source</a>)
used to create new controller:  </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">type Options struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // MaxConcurrentReconciles is the maximum number of concurrent Reconciles which can be run. Defaults to 1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MaxConcurrentReconciles int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Reconciler reconciles an object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Reconciler reconcile.Reconciler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Concurrent reconciling is quite useful when the states of the controller&#x27;s watched objects change so
frequently that a large amount of reconcile requests are sent to and queued in the reconcile queue.
Multiple reconcile loops do help drain the reconcile queue much more quickly compared to the default single
reconcile loop case. Although this is a great feature for performance, without digging into the code,
an immediate concern that a developer may raise is that will this introduce consistency issue?
i.e., is it possible that two reconcile loops handle the same object at the same time?</p><p>The answer is NO, as you may expect. The &quot;magic&quot; is enforced by the workqueue
implementation in Kubernetes <code>client-go</code>, which is used by controller runtime reconcile queue.
The workqueue algorithm (<a href="https://github.com/kubernetes/client-go/blob/a57d0056dbf1d48baaf3cee876c123bea745591f/util/workqueue/queue.go#L65" target="_blank" rel="noopener noreferrer">source</a>)
is demonstrated in Figure 1.</p><p><img alt="workqueue" src="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/assets/images/workqueue-e607402bb269a71112baa4c9870fb109.png"></p><p>Basically, the workqueue uses a <code>queue</code> and two <code>sets</code> to coordinate the process of handling multiple reconciling
requests against the same object. Figure 1(a) presents the initial state of handling four reconcile requests,
two of which target the same object A. When a request arrives, the target object is first added to the <code>dirty set</code>
or dropped if it presents in <code>dirty set</code>,  and then pushed to the <code>queue</code> only if it is not presented in
<code>processing set</code>. Figure 1(b) shows the case of adding three requests consecutively.
When a reconciling loop is ready to serve a request, it gets the target object from the <code>front</code> of the queue. The
object is also added to the <code>processing set</code> and removed from the <code>dirty set</code> (Figure 1(c)).
Now if a request of the processing object arrives, the object is only added to the <code>dirty set</code>, not
to the <code>queue</code> (Figure 1(d)). This guarantees that an object is only handled by one reconciling
loop. When reconciling is done, the object is removed from the <code>processing set</code>. If the object is also
shown in the <code>dirty set</code>, it is added back to the <code>back</code> of the <code>queue</code> (Figure 1(e)).</p><p>The above algorithm has following implications:</p><ul><li>It avoids concurrent reconciling for the same object.</li><li>The object processing order can be different from arriving order even if there is only one reconciling thread.
This usually would not be a problem since the controller still reconciles to the final cluster state. However,
the out of order reconciling may cause a significant delay for a request.
<img alt="workqueue-starve" src="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/assets/images/workqueue-starve-9821348cf485c42d23682a8a14fdbcb1.png">.... For example, as illustrated in
Figure 2, assuming there is only one reconciling thread and two requests targeting the same object A arrive, one of
them will be processed and object A will be added to the <code>dirty set</code> (Figure 2(b)).
If the reconciling takes a long time and during which a large number of new reconciling requests arrive,
the queue will be filled up by the new requests (Figure 2(c)). When reconciling is done, object A will be
added to the <code>back</code> of the <code>queue</code> (Figure 2(d)). It would not be handled until all the requests coming after had been
handled, which can cause a noticeable long delay. The workaround is actually simple - <strong>USE CONCURRENT RECONCILES</strong>.
Since the cost of an idle go routine is fairly small, the overhead of having multiple reconcile threads is
low even if the controller is idle. It seems that the <code>MaxConcurrentReconciles</code> value should
be overwritten to a value larger than the default 1 (CloneSet uses 10 for example).</li><li>Last but not the least, reconcile requests can be dropped (if the target exists in <code>dirty set</code>). This means
that we cannot assume that the controller can track all the object state change events. Recalling a presentation
given by <a href="https://speakerdeck.com/thockin/edge-vs-level-triggered-logic" target="_blank" rel="noopener noreferrer">Tim Hockin</a>, Kubernetes controller
is level triggered, not edge triggered. It reconciles for state, not for events. </li></ul><p>Thanks for reading the post, hope it helps.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/zh/blog/tags/workload">workload</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/zh/blog/tags/reconcile">reconcile</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/zh/blog/tags/controller">controller</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Learning Concurrent Reconciling" href="/zh/blog/learning-concurrent-reconciling"><b>æ›´å¤š</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/zh/blog/workload-classification-guidance">Kruise Workload Classification Guidance</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2019-10-10T00:00:00.000Z" itemprop="datePublished">2019å¹´10æœˆ10æ—¥</time> Â· <!-- -->é˜…è¯»éœ€è¦ 1 åˆ†é’Ÿ</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://github.com/Fei-Guo" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://github.com/Fei-Guo.png" alt="Fei Guo"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Fei-Guo" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Fei Guo</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of OpenKruise</small></div></div></div><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://github.com/FillZpp" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://github.com/FillZpp.png" alt="Siyu Wang"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FillZpp" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Siyu Wang</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of OpenKruise</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Kubernetes ç›®å‰å¹¶æ²¡æœ‰ä¸ºä¸€ä¸ªåº”ç”¨åº”è¯¥ä½¿ç”¨å“ªä¸ªæ§åˆ¶å™¨æä¾›æ˜ç¡®çš„æŒ‡å¼•ï¼Œè¿™å°¤å…¶ä¸åˆ©äºç”¨æˆ·ç†è§£åº”ç”¨å’Œ workload çš„å…³ç³»ã€‚
æ¯”å¦‚è¯´ï¼Œç”¨æˆ·é€šå¸¸çŸ¥é“ä»€ä¹ˆæ—¶å€™åº”è¯¥ç”¨ <code>Job/CronJob</code> æˆ–è€… <code>DaemonSet</code>ï¼Œè¿™äº› workload çš„æ¦‚å¿µæ˜¯éå¸¸æ˜ç¡®çš„ -- å‰è€…æ˜¯ä¸ºäº†ä»»åŠ¡ç±»å‹çš„åº”ç”¨éƒ¨ç½²ã€åè€…åˆ™æ˜¯é¢å‘éœ€è¦åˆ†å‘åˆ°æ¯ä¸ª node ä¸Šçš„é•¿æœŸè¿è¡Œ Podã€‚</p><p>ä½†æ˜¯å¦ä¸€äº› workload æ¯”å¦‚ <code>Deployment</code> å’Œ <code>StatefulSet</code> ä¹‹é—´çš„ç•Œé™æ˜¯æ¯”è¾ƒæ¨¡ç³Šçš„ã€‚ä¸€ä¸ªé€šè¿‡ <code>Deployment</code> éƒ¨ç½²çš„åº”ç”¨ä¹Ÿå¯ä»¥é€šè¿‡ <code>StatefulSet</code> éƒ¨ç½²ï¼Œ<code>StatefulSet</code> å¯¹ Pod çš„ <code>OrderedReady</code> ç­–ç•¥å¹¶éæ˜¯å¼ºåˆ¶çš„ã€‚è€Œä¸”ï¼Œéšç€ Kubernetes ç¤¾åŒºä¸­è¶Šæ¥è¶Šå¤šçš„è‡ªå®šä¹‰ controllers/operators å˜çš„æˆç†Ÿï¼Œç”¨æˆ·å°±è¶Šéš¾ä»¥ä¸ºè‡ªå·±çš„åº”ç”¨æ‰¾åˆ°ä¸€ä¸ªæœ€åˆé€‚çš„ workload æ¥ç®¡ç†ï¼Œå°¤å…¶æ˜¯ä¸€äº›æ§åˆ¶å™¨çš„åŠŸèƒ½ä¸Šéƒ½å­˜åœ¨é‡åˆéƒ¨åˆ†ã€‚</p><p>Kruise å°è¯•åœ¨ä¸¤ä¸ªæ–¹é¢æ¥ç¼“è§£è¿™ä¸ªé—®é¢˜ï¼š</p><ul><li>åœ¨ Kruise ä¸­è°¨æ…è®¾è®¡æ–°çš„æ§åˆ¶å™¨ï¼Œé¿å…ä¸å¿…è¦çš„åŠŸèƒ½é‡å¤ç»™ç”¨æˆ·æ¥å¸¦å›°æ‰°</li><li>ä¸ºæ‰€æœ‰æä¾›å‡ºæ¥çš„ workload æ§åˆ¶å™¨åˆ›å»ºä¸€ä¸ªåˆ†ç±»æœºåˆ¶ï¼Œæ–¹ä¾¿ç”¨æˆ·æ›´å®¹æ˜“ç†è§£å®ƒä»¬çš„ä½¿ç”¨åœºæ™¯ã€‚æˆ‘ä»¬ä¸‹é¢ä¼šè¯¦ç»†æè¿°ä¸€ä¸‹ï¼Œé¦–å…ˆæ˜¯ controller å‘½åä¸Šçš„è§„èŒƒï¼š</li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="controller-å‘½åæƒ¯ä¾‹">Controller å‘½åæƒ¯ä¾‹<a aria-hidden="true" class="hash-link" href="#controller-å‘½åæƒ¯ä¾‹" title="Direct link to heading">â€‹</a></h3><p>ä¸€ä¸ªæ˜“äºç†è§£çš„ controller åå­—å¯¹äºç”¨æˆ·é€‰ç”¨æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚ç»è¿‡å¯¹å†…å¤–éƒ¨ä¸å°‘ Kubernetes ç”¨æˆ·çš„å’¨è¯¢ï¼Œæˆ‘ä»¬å†³å®šåœ¨ Kruise ä¸­å®è¡Œä»¥ä¸‹çš„å‘½åæƒ¯ä¾‹ï¼ˆè¿™äº›æƒ¯ä¾‹ä¸ç›®å‰ä¸Šæ¸¸çš„ controller å‘½åå¹¶ä¸å†²çªï¼‰ï¼š</p><ul><li><strong>Set</strong> åç¼€ï¼šè¿™ç±» controller ä¼šç›´æ¥æ“ä½œå’Œç®¡ç† Podï¼Œæ¯”å¦‚ <code>CloneSet</code>, <code>ReplicaSet</code>, <code>SidecarSet</code> ç­‰ã€‚å®ƒä»¬æä¾›äº† Pod ç»´åº¦çš„å¤šç§éƒ¨ç½²ã€å‘å¸ƒç­–ç•¥ã€‚</li><li><strong>Deployment</strong> åç¼€ï¼šè¿™ç±» controller ä¸ä¼šç›´æ¥åœ°æ“ä½œ Podï¼Œå®ƒä»¬é€šè¿‡æ“ä½œä¸€ä¸ªæˆ–å¤šä¸ª <strong>Set</strong> ç±»å‹çš„ workload æ¥é—´æ¥ç®¡ç† Podï¼Œæ¯”å¦‚ <code>Deployment</code> ç®¡ç† <code>ReplicaSet</code> æ¥æä¾›ä¸€äº›é¢å¤–çš„æ»šåŠ¨ç­–ç•¥ï¼Œä»¥åŠ <code>UnitedDeployment</code> æ”¯æŒç®¡ç†å¤šä¸ª <code>StatefulSet</code>/<code>AdvancedStatefulSet</code> æ¥å°†åº”ç”¨éƒ¨ç½²åˆ°ä¸åŒçš„å¯ç”¨åŒºã€‚</li><li><strong>Job</strong> åç¼€ï¼šè¿™ç±» controller ä¸»è¦ç®¡ç†çŸ­æœŸæ‰§è¡Œçš„ä»»åŠ¡ï¼Œæ¯”å¦‚ <code>BroadcastJob</code> æ”¯æŒå°†ä»»åŠ¡ç±»å‹çš„ Pod åˆ†å‘åˆ°é›†ç¾¤ä¸­æ‰€æœ‰ Node ä¸Šã€‚</li></ul><p><strong>Set</strong>, <strong>Deployment</strong> å’Œ <strong>Job</strong> éƒ½æ˜¯è¢« Kubernetes ç¤¾åŒºå¹¿æ³›æ¥å—çš„æ¦‚å¿µï¼Œåœ¨ Kruise ä¸­ç»™ä»–ä»¬å®šä¹‰äº†æ˜ç¡®çš„æ‰©å±•è§„èŒƒã€‚</p><p>æˆ‘ä»¬èƒ½å¦å¯¹æœ‰ç›¸åŒåç¼€çš„ controller åšè¿›ä¸€æ­¥åŒºåˆ†å‘¢ï¼Ÿé€šå¸¸æ¥è¯´å‰ç¼€å‰é¢çš„åå­—åº”è¯¥æ˜¯è®©äººèƒ½ä¸€ç›®äº†ç„¶çš„ï¼Œä¸è¿‡ä¹Ÿæœ‰ä¸€äº›æƒ…å†µä¸‹å¾ˆéš¾ä¸€è¯­æè¿° controller è‡ªèº«çš„è¡Œä¸ºã€‚å¯ä»¥çœ‹ä¸€ä¸‹ <code>StatefulSet</code> æ¥æºçš„è¿™ä¸ª <a href="https://github.com/kubernetes/kubernetes/issues/27430" target="_blank" rel="noopener noreferrer">issue</a>ï¼Œç¤¾åŒºç”¨äº†å››ä¸ªæœˆçš„æ—¶é—´æ‰å†³å®šç”¨ <code>StatefulSet</code> è¿™ä¸ªåå­—ä»£æ›¿è¿‡å»çš„ <code>PetSet</code>ï¼Œå°½ç®¡æ–°åå­—ä¹Ÿè®©äººçœ‹èµ·æ¥æ¯”è¾ƒå›°æƒ‘ã€‚</p><p>è¿™ä¸ªä¾‹å­è¯´æ˜äº†æœ‰æ—¶å€™ä¸€ä¸ªç²¾å¿ƒè®¡åˆ’çš„åå­—ä¹Ÿä¸ä¸€å®šæœ‰åŠ©äºæ ‡è¯†è¿™ä¸ª controllerã€‚å› æ­¤ï¼ŒKruise å¹¶ä¸æ‰“ç®—è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè€Œæ˜¯é€šè¿‡ä»¥ä¸‹çš„æ ‡å‡†æ¥å¸®åŠ©å¯¹ <strong>Set</strong> ç±»å‹çš„ controller åˆ†ç±»ã€‚</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="å›ºå®š-pod-åå­—">å›ºå®š Pod åå­—<a aria-hidden="true" class="hash-link" href="#å›ºå®š-pod-åå­—" title="Direct link to heading">â€‹</a></h3><p><code>StatefulSet</code> çš„ä¸€ä¸ªç‹¬æœ‰çš„ç‰¹æ€§æ˜¯æ”¯æŒä¸€è‡´çš„ Pod ç½‘ç»œå’Œå­˜å‚¨æ ‡è¯†ï¼Œè¿™åœ¨æœ¬è´¨ä¸Šæ˜¯é€šè¿‡å›ºå®š Pod åå­—æ¥å®ç°çš„ã€‚Pod åå­—å¯ä»¥ç”¨äºæ ‡è¯†ç½‘ç»œå’Œå­˜å‚¨ï¼Œå› ä¸ºå®ƒæ˜¯ DNS record çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”å¯ä»¥ä½œä¸º PVC çš„åå­—ã€‚æ—¢ç„¶ <code>StatefulSet</code> ä¸‹çš„ Pod éƒ½æ˜¯é€šè¿‡åŒä¸€ä¸ªæ¨¡æ¿åˆ›å»ºå‡ºæ¥çš„ï¼Œä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªç‰¹æ€§å‘¢ï¼Ÿä¸€ä¸ªå¸¸è§çš„ä¾‹å­å°±æ˜¯ç”¨äºç®¡ç†åˆ†å¸ƒå¼ä¸€è‡´æ€§æœåŠ¡ï¼Œæ¯”å¦‚ etcd æˆ– Zookeeperã€‚è¿™ç±»åº”ç”¨éœ€è¦çŸ¥é“é›†ç¾¤æ„æˆçš„æ‰€æœ‰æˆå‘˜ï¼Œå¹¶ä¸”åœ¨é‡å»ºã€å‘å¸ƒåéƒ½éœ€è¦ä¿æŒåŸæœ‰çš„ç½‘ç»œæ ‡è¯†å’Œç£ç›˜æ•°æ®ã€‚è€Œåƒ <code>ReplicaSet</code>, <code>DaemonSet</code> è¿™ç±»çš„æ§åˆ¶å™¨æ˜¯é¢å‘æ— çŠ¶æ€çš„ï¼Œå®ƒä»¬å¹¶ä¸ä¼šæ–°å»º Pod æ—¶å¹¶ä¸ä¼šå¤ç”¨è¿‡å»çš„ Pod åå­—ã€‚</p><p>ä¸ºäº†æ”¯æŒæœ‰çŠ¶æ€ï¼Œæ§åˆ¶å™¨çš„å®ç°ä¸Šä¼šæ¯”è¾ƒå›ºå®šã€‚<code>StatefulSet</code> ä¾èµ–äºç»™æ¯ä¸ª Pod åå­—ä¸­åŠ å…¥ä¸€ä¸ªåºå·ï¼Œåœ¨æ‰©ç¼©å®¹å’Œæ»šåŠ¨å‡çº§çš„æ—¶å€™éƒ½éœ€è¦æŒ‰ç…§è¿™ä¸ªåºå·çš„é¡ºåºæ¥æ‰§è¡Œã€‚ä½†è¿™æ ·ä¸€æ¥ï¼Œ<code>StatefulSet</code> ä¹Ÿå°±æ— æ³•åšåˆ°å¦ä¸€äº›å¢å¼ºåŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š</p><ul><li>å½“ç¼©å° replicas æ—¶é€‰æ‹©ç‰¹å®šçš„ Pod æ¥åˆ é™¤ï¼Œè¿™ä¸ªåŠŸèƒ½åœ¨è·¨å¤šä¸ªå¯ç”¨åŒºéƒ¨ç½²çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚</li><li>æŠŠä¸€ä¸ªå­˜é‡çš„ Pod æ¥ç®¡åˆ°å¦ä¸€ä¸ª workload ä¸‹é¢ï¼ˆæ¯”å¦‚ <code>StatefulSet</code>ï¼‰</li></ul><p>æˆ‘ä»¬å‘ç°å¾ˆå¤šäº‘åŸç”Ÿåº”ç”¨å¹¶ä¸éœ€è¦è¿™ä¸ªæœ‰çŠ¶æ€çš„ç‰¹æ€§æ¥å›ºå®š Pod åå­—ï¼Œè€Œ <code>StatefulSet</code> åˆå¾ˆéš¾åœ¨å…¶ä»–æ–¹é¢åšæ‰©å±•ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒKruise å‘å¸ƒäº†ä¸€ä¸ªæ–°çš„æ§åˆ¶å™¨ <code>CloneSet</code> æ¥ç®¡ç†æ— çŠ¶æ€åº”ç”¨ï¼Œ<code>CloneSet</code> æä¾›äº†å¯¹ PVC æ¨¡æ¿çš„æ”¯æŒï¼Œå¹¶ä¸”ä¸ºåº”ç”¨éƒ¨ç½²æä¾›äº†ä¸°å¯Œçš„å¯é€‰ç­–ç•¥ã€‚ä»¥ä¸‹è¡¨ä¸­æ¯”è¾ƒäº† Advanced StatefulSet å’Œ CloneSet ä¸€äº›æ–¹é¢çš„èƒ½åŠ›ï¼š</p><table><thead><tr><th>Features</th><th align="center">Advanced StatefulSet</th><th align="center">CloneSet</th></tr></thead><tbody><tr><td>PVC</td><td align="center">Yes</td><td align="center">Yes</td></tr><tr><td>Pod name</td><td align="center">Ordered</td><td align="center">Random</td></tr><tr><td>Inplace upgrade</td><td align="center">Yes</td><td align="center">Yes</td></tr><tr><td>Max unavailable</td><td align="center">Yes</td><td align="center">Yes</td></tr><tr><td>Selective deletion</td><td align="center">No</td><td align="center">Yes</td></tr><tr><td>Selective upgrade</td><td align="center">No</td><td align="center">Yes</td></tr><tr><td>Change Pod ownership</td><td align="center">No</td><td align="center">Yes</td></tr></tbody></table><p>ç›®å‰å¯¹äº Kruise ç”¨æˆ·çš„å»ºè®®æ˜¯ï¼Œå¦‚æœä½ çš„åº”ç”¨éœ€è¦å›ºå®šçš„ Pod åå­—ï¼ˆç½‘ç»œå’Œå­˜å‚¨æ ‡è¯†ï¼‰ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>Advanced StatefulSet</code>ï¼Œå¦åˆ™ <code>CloneSet</code> åº”è¯¥æ˜¯ <strong>Set</strong> ç±»å‹æ§åˆ¶å™¨çš„é¦–é€‰ã€‚</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="æ€»ç»“">æ€»ç»“<a aria-hidden="true" class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h3><p>Kruise ä¼šä¸ºå„ç§ workload é€‰æ‹©æ˜ç¡®çš„åå­—ï¼Œæœ¬æ–‡ç›®æ ‡æ˜¯èƒ½ä¸º Kruise ç”¨æˆ·æä¾›é€‰æ‹©æ­£ç¡® controller éƒ¨ç½²åº”ç”¨çš„æŒ‡å¼•ã€‚
å¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©ï¼</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/zh/blog/tags/workload">workload</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Kruise Workload Classification Guidance" href="/zh/blog/workload-classification-guidance"><b>æ›´å¤š</b></a></div></footer></article></main></div></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh/docs/installation">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://kubernetes.slack.com/channels/openkruise" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Kubernetes Slack ( #openkruise channel )<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/zh/blog/tags/">DingTalk (GroupID: 23330762 )</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/blog/tags/">WeChat (User: openkruise )</a></li><li class="footer__item"><a href="https://shimo.im/docs/gXqmeQOYBehZ4vqo" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Bi-week Meeting (APAC, Chinese)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/openkruise/kruise" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/openkruise/community/blob/master/community-membership.md" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Community Membership<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <br>
        <strong>Â© 2021 The OpenKruise Authors. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/"> Trademark Usage</a> page.</strong></div></div></div></footer></div>
<script src="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/assets/js/runtime~main.a9d38f62.js"></script>
<script src="https://cdn.jsdelivr.net/gh/openkruise/openkruise.io@gh-pages/zh/assets/js/main.8c3fdc92.js"></script>
</body>
</html>