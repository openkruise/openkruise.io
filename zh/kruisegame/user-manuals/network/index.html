<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-kruisegame docs-doc-id-user-manuals/network">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="OpenKruise RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="OpenKruise Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="OpenKruise" href="/zh/opensearch.xml"><title data-rh="true">网络模型 | OpenKruise</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://openkruise.io/zh/kruisegame/user-manuals/network"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-kruisegame-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-kruisegame-current"><meta data-rh="true" property="og:title" content="网络模型 | OpenKruise"><meta data-rh="true" name="description" content="功能概述"><meta data-rh="true" property="og:description" content="功能概述"><link data-rh="true" rel="icon" href="/zh/img/openkruise.ico"><link data-rh="true" rel="canonical" href="https://openkruise.io/zh/kruisegame/user-manuals/network"><link data-rh="true" rel="alternate" href="https://openkruise.io/kruisegame/user-manuals/network" hreflang="en"><link data-rh="true" rel="alternate" href="https://openkruise.io/zh/kruisegame/user-manuals/network" hreflang="zh"><link data-rh="true" rel="alternate" href="https://openkruise.io/kruisegame/user-manuals/network" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://FKASWWQYOP-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/zh/assets/css/styles.1bcad3e5.css">
<link rel="preload" href="/zh/assets/js/runtime~main.3d7ecf66.js" as="script">
<link rel="preload" href="/zh/assets/js/main.81bdb029.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="announcementBarContent_xLdY">⭐️ If you like OpenKruise, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/openkruise/kruise">GitHub</a>! ⭐️</div><button type="button" class="clean-btn close announcementBarClose_gvF7" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/openkruise.ico" alt="OpenKruise" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh/img/openkruise.ico" alt="OpenKruise" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">OpenKruise</b></a><a class="navbar__item navbar__link" href="/zh/docs/">Kruise</a><a class="navbar__item navbar__link" href="/zh/rollouts/introduction">Rollouts</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh/kruisegame/introduction">Kruise-Game</a><a class="navbar__item navbar__link" href="/zh/blog">博客</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/zh/docs/">v1.7</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/docs/next/">v1.8</a></li><li><a class="dropdown__link" href="/zh/docs/">v1.7</a></li><li><a class="dropdown__link" href="/zh/docs/v1.6/">v1.6</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/kruisegame/user-manuals/network" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/zh/kruisegame/user-manuals/network" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">简体中文</a></li></ul></div><a href="https://github.com/openkruise/kruise" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/zh/kruisegame/introduction">快速开始</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/introduction">OpenKruiseGame简介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/installation">安装</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/design-concept">设计理念</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/zh/kruisegame/user-manuals/deploy-gameservers">用户手册</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/user-manuals/deploy-gameservers">部署游戏服</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/user-manuals/hot-update">游戏服热更新</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/user-manuals/update-strategy">游戏服更新策略</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/user-manuals/gameservers-scale">游戏服伸缩</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/user-manuals/container-startup-sequence-control">容器启动顺序控制</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/user-manuals/service-qualities">自定义服务质量</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/kruisegame/user-manuals/network">网络模型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/user-manuals/lifecycle">自定义生命周期管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/user-manuals/gameserver-monitor">游戏服监控</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/user-manuals/game-matchmaking">游戏匹配</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/user-manuals/game-dashboard">游戏服运维控制台</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/user-manuals/crd-field-description">CRD字段说明</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/zh/kruisegame/best-practices/session-based-game">最佳实践</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/best-practices/session-based-game">会话类游戏（PvP开房间）最佳实践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/best-practices/pve-game">传统区服类游戏（PvE）最佳实践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/best-practices/shared-mem">游戏服共享内存最佳实践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/best-practices/gameserver-delivery-management">游戏服敏捷交付与运维管理最佳实践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/best-practices/workflow">游戏运维工作流最佳实践</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/zh/kruisegame/developer-manuals/contribution">开发者手册</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/developer-manuals/contribution">项目贡献</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/developer-manuals/faq">FAQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/developer-manuals/go-client">Golang Client</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/zh/kruisegame/blog-video/kubecon-shangyou-20230926">博客与视频</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/blog-video/kubecon-shangyou-20230926">尚游网络基于OpenKruiseGame游戏云原生化实践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/blog-video/meetup-guangzhou-20231125">OpenKruiseGame 助力游戏运维管理提效</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/blog-video/guanying-20231129">冠赢互娱基于OpenKrusieGame实现游戏云原生架构升级</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/blog-video/higress">Higress × OpenKruiseGame 游戏网关最佳实践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/blog-video/cloud-forward-okg">Cloud Forward | 云原生游戏系列视频</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/blog-video/ack-one-okg">ACK One x OpenKruiseGame 全球游戏服多地域一致性交付最佳实践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/blog-video/okg-911">久幺幺科技《百变大侦探》游戏云原生架构落地实践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/kruisegame/blog-video/okg-gsshosting">GssHosting 游戏服托管平台实现多地域高效管理</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">用户手册</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">网络模型</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>网络模型</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="功能概述">功能概述<a class="hash-link" href="#功能概述" title="Direct link to heading">​</a></h2><p>如<a href="/zh/kruisegame/design-concept">OKG设计理念</a>中提到的，游戏服接入层网络是游戏开发者非常关注的问题。
非网关架构下，游戏开发者需要考虑如何暴露游戏服的外部IP端口，供玩家连接访问。
在不同场景下，往往需要不同的网络产品，而有时网络产品由云厂商提供。OKG 的 Cloud Provider &amp; Network Plugin 源于此而诞生。
OKG 会集成不同云提供商的不同网络插件，用户可通过GameServerSet设置游戏服的网络参数，并在生成的GameServer中查看网络状态信息，极大降低了游戏服接入网络的复杂度。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="网络插件附录">网络插件附录<a class="hash-link" href="#网络插件附录" title="Direct link to heading">​</a></h2><p>当前支持的网络插件：</p><ul><li>Kubernetes-HostPort</li><li>Kubernetes-NodePort</li><li>Kubernetes-Ingress</li><li>AlibabaCloud-NATGW</li><li>AlibabaCloud-SLB</li><li>AlibabaCloud-NLB</li><li>AlibabaCloud-EIP</li><li>AlibabaCloud-SLB-SharedPort</li><li>AlibabaCloud-NLB-SharedPort</li><li>Volcengine-CLB</li><li>AmazonWebServices-NLB</li></ul><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kubernetes-hostport">Kubernetes-HostPort<a class="hash-link" href="#kubernetes-hostport" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件名称">插件名称<a class="hash-link" href="#插件名称" title="Direct link to heading">​</a></h4><p><code>Kubernetes-HostPort</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cloud-provider">Cloud Provider<a class="hash-link" href="#cloud-provider" title="Direct link to heading">​</a></h4><p>Kubernetes</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件说明">插件说明<a class="hash-link" href="#插件说明" title="Direct link to heading">​</a></h4><ul><li><p>Kubernetes-HostPort利用宿主机网络，通过主机上的端口转发实现游戏服对外暴露服务。宿主机需要配置公网IP，有被公网访问的能力。</p></li><li><p>用户在配置文件中可自定义宿主机开放的端口段（默认为8000-9000），该网络插件可以帮助用户分配管理宿主机端口，尽量避免端口冲突。</p></li><li><p>该插件不支持网络隔离。</p></li><li><p>Kubernetes-HostPort 依赖Kubernetes提供的hostPort模式。需要注意存在一些CNI插件不支持hostPort，如Terway等。</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="网络参数">网络参数<a class="hash-link" href="#网络参数" title="Direct link to heading">​</a></h4><p>ContainerPorts</p><ul><li>含义：填写提供服务的容器名以及对应暴露的端口和协议</li><li>填写格式：containerName:port1/protocol1,port2/protocol2,...（协议需大写） 比如：<code>game-server:25565/TCP</code></li><li>是否支持变更：不支持，在创建时即永久生效，随pod生命周期结束而结束</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件配置">插件配置<a class="hash-link" href="#插件配置" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[kubernetes]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enable = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[kubernetes.hostPort]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#填写宿主机可使用的空闲端口段，用于为pod分配宿主机转发端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_port = 9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">min_port = 8000 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="示例说明">示例说明<a class="hash-link" href="#示例说明" title="Direct link to heading">​</a></h4><p>OKG支持在原生Kubernetes集群使用HostPort游戏服网络，使用游戏服所在宿主机暴露外部IP及端口，转发至游戏服内部端口中。使用方式如下。</p><p>部署一个带有network的GameServerSet：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF | kubectl apply -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: game.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: GameServerSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: gs-hostport</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  updateStrategy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rollingUpdate:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      podUpdatePolicy: InPlaceIfPossible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    networkType: Kubernetes-HostPort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    networkConf:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #网络配置以k-v键值对的形式传入，由网络插件指定。不同网络插件有着不同的网络配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: ContainerPorts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      #ContainerPorts对应的值格式如下{containerName}:{port1}/{protocol1},{port2}/{protocol2},...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      value: &quot;gameserver:80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  gameServerTemplate:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - image: registry.cn-hangzhou.aliyuncs.com/gs-demo/gameserver:network</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name: gameserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>生成的GameServer中通过networkStatus字段查看游戏服网络信息：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  networkStatus:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    createTime: </span><span class="token string" style="color:#e3116c">&quot;2022-11-23T10:57:01Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    currentNetworkState: Ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    desiredNetworkState: Ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    externalAddresses:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ip: </span><span class="token number" style="color:#36acaa">48.98</span><span class="token plain">.98.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: gameserver-80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: </span><span class="token number" style="color:#36acaa">8211</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    internalAddresses:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ip: </span><span class="token number" style="color:#36acaa">172.16</span><span class="token plain">.0.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: gameserver-80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastTransitionTime: </span><span class="token string" style="color:#e3116c">&quot;2022-11-23T10:57:01Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    networkType: Kubernetes-HostPort</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>访问 48.98.98.8:8211 即可</p><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kubernetes-nodeport">Kubernetes-NodePort<a class="hash-link" href="#kubernetes-nodeport" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件名称-1">插件名称<a class="hash-link" href="#插件名称-1" title="Direct link to heading">​</a></h4><p><code>Kubernetes-NodePort</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cloud-provider-1">Cloud Provider<a class="hash-link" href="#cloud-provider-1" title="Direct link to heading">​</a></h4><p>Kubernetes</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件说明-1">插件说明<a class="hash-link" href="#插件说明-1" title="Direct link to heading">​</a></h4><ul><li><p>Kubernetes-NodePort 利用Kubernetes NodePort 类型Service 实现游戏服对外暴露服务。宿主机需要配置公网IP，有被公网访问的能力。</p></li><li><p>该插件依赖节点NodePort数量限制，默认开放端口为30000-32767。若希望开放更多端口，请更改APIServer service-node-port-range 参数。</p></li><li><p>该插件不支持网络隔离。</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="网络参数-1">网络参数<a class="hash-link" href="#网络参数-1" title="Direct link to heading">​</a></h4><p>PortProtocols</p><ul><li>含义：pod暴露的端口及协议，支持填写多个端口/协议</li><li>格式：port1/protocol1,port2/protocol2,...（协议需大写）</li><li>是否支持变更：支持</li></ul><p>Fixed</p><ul><li>含义：是否固定访问IP/端口。若是，即使pod删除重建，网络内外映射关系不会改变</li><li>填写格式：false / true</li><li>是否支持变更：支持</li></ul><p>AllowNotReadyContainers</p><ul><li>含义：在容器原地升级时允许不断流的对应容器名称，可填写多个</li><li>格式：{containerName_0},{containerName_1},... 例如：sidecar</li><li>是否支持变更：在原地升级过程中不可变更。</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件配置-1">插件配置<a class="hash-link" href="#插件配置-1" title="Direct link to heading">​</a></h4><p>无</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="示例说明-1">示例说明<a class="hash-link" href="#示例说明-1" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF | kubectl apply -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: game.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: GameServerSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: gs-nodeport</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  updateStrategy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rollingUpdate:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      podUpdatePolicy: InPlaceIfPossible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    networkType: Kubernetes-NodePort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    networkConf:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #网络配置以k-v键值对的形式传入，由网络插件指定。不同网络插件有着不同的网络配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: PortProtocols</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      value: &quot;80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: Fixed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      value: &quot;false&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  gameServerTemplate:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - image: registry.cn-hangzhou.aliyuncs.com/gs-demo/gameserver:network</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name: gameserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>生成的GameServer中通过networkStatus字段查看游戏服网络信息：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  networkStatus:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    createTime: </span><span class="token string" style="color:#e3116c">&quot;2024-04-28T12:28:27Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    currentNetworkState: Ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    desiredNetworkState: Ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    externalAddresses:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ip: </span><span class="token number" style="color:#36acaa">120.78</span><span class="token plain">.78.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: </span><span class="token string" style="color:#e3116c">&quot;80&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: </span><span class="token number" style="color:#36acaa">31480</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    internalAddresses:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ip: </span><span class="token number" style="color:#36acaa">172.16</span><span class="token plain">.0.82</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: </span><span class="token string" style="color:#e3116c">&quot;80&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastTransitionTime: </span><span class="token string" style="color:#e3116c">&quot;2024-04-28T12:28:27Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    networkType: Kubernetes-NodePort</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>访问 120.78.78.8:31480 即可</p><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kubernetes-ingress">Kubernetes-Ingress<a class="hash-link" href="#kubernetes-ingress" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件名称-2">插件名称<a class="hash-link" href="#插件名称-2" title="Direct link to heading">​</a></h4><p><code>Kubernetes-Ingress</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cloud-provider-2">Cloud Provider<a class="hash-link" href="#cloud-provider-2" title="Direct link to heading">​</a></h4><p>Kubernetes</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件说明-2">插件说明<a class="hash-link" href="#插件说明-2" title="Direct link to heading">​</a></h4><ul><li>针对页游等需要七层网络模型的游戏场景，OKG提供了Ingress网络模型。该插件将会自动地为每个游戏服设置对应的访问路径，该路径与游戏服ID相关，每个游戏服各不相同。</li><li>是否支持网络隔离：否</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="网络参数-2">网络参数<a class="hash-link" href="#网络参数-2" title="Direct link to heading">​</a></h4><p>Path</p><ul><li>含义：访问路径。每个游戏服依据ID拥有各自的访问路径。</li><li>填写格式：将&lt;id<!-- -->&gt;<!-- -->添加到原始路径(与HTTPIngressPath中Path一致)的任意位置，该插件将会生成游戏服ID对应的路径。例如，当设置路径为 /game&lt;id<!-- -->&gt;<!-- -->，游戏服0对应路径为/game0，游戏服1对应路径为/game1，以此类推。</li><li>是否支持变更：支持</li></ul><p>PathType</p><ul><li>含义：路径类型。与HTTPIngressPath的PathType字段一致。</li><li>填写格式：与HTTPIngressPath的PathType字段一致。</li><li>是否支持变更：支持</li></ul><p>Port</p><ul><li>含义：游戏服暴露的端口值。</li><li>填写格式：端口数字</li><li>是否支持变更：支持</li></ul><p>IngressClassName</p><ul><li>含义：指定IngressClass的名称。与IngressSpec的IngressClassName字段一致。</li><li>填写格式：与IngressSpec的IngressClassName字段一致。</li><li>是否支持变更：支持</li></ul><p>Host</p><ul><li>含义：域名。每个游戏服依据ID拥有各自的访问域名。</li><li>填写格式：将&lt;id<!-- -->&gt;<!-- -->添加域名的任意位置，该插件将会生成游戏服ID对应的域名。例如，当设置域名为 test.game&lt;id<!-- -->&gt;<!-- -->.cn-hangzhou.ali.com，游戏服0对应域名为test.game0.cn-hangzhou.ali.com，游戏服1对应域名为test.game1.cn-hangzhou.ali.com，以此类推。</li><li>是否支持变更：支持</li></ul><p>TlsHosts</p><ul><li>含义：包含TLS证书的host列表。含义与IngressTLS的Hosts字段类似。</li><li>填写格式：host1,host2,... 例如，xxx.xx1.com,xxx.xx2.com</li><li>是否支持变更：支持</li></ul><p>TlsSecretName</p><ul><li>含义：与IngressTLS的SecretName字段一致。</li><li>填写格式：与IngressTLS的SecretName字段一致。</li><li>是否支持变更：支持</li></ul><p>Annotation</p><ul><li>含义：作为ingress对象的annotation</li><li>格式：key: value（注意:后有空格），例如：nginx.ingress.kubernetes.io/rewrite-target: /$2</li><li>是否支持变更：支持</li></ul><p>Fixed</p><ul><li>含义：是否需要保持ingress，让其不随pod的删除而删除</li><li>取值：true / false</li><li>是否支持变更：支持</li></ul><p><em>补充说明</em></p><ul><li>支持填写多个annotation，在networkConf中填写多个Annotation以及对应值即可，不区分填写顺序。</li><li>支持填写多个路径。路径、路径类型、端口按照填写顺序一一对应。当路径数目大于路径类型数目（或端口数目）时，无法找到对应关系的路径按照率先填写的路径类型（或端口）匹配。</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件配置-2">插件配置<a class="hash-link" href="#插件配置-2" title="Direct link to heading">​</a></h4><p>无</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="示例说明-2">示例说明<a class="hash-link" href="#示例说明-2" title="Direct link to heading">​</a></h4><p>GameServerSet中network字段声明如下：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">network</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networkConf</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> IngressClassName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;80&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /game&lt;id</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">(/</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">$)(.</span><span class="token important">*)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">&lt;id</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Host</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test.xxx.cn</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">hangzhou.ali.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PathType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ImplementationSpecific</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TlsHosts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> xxx.xx1.com</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">xxx.xx2.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Annotation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nginx.ingress.kubernetes.io/rewrite-target: /$2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Annotation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nginx.ingress.kubernetes.io/random: xxx&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networkType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Kubernetes</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Ingress</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>则会生成gss replicas对应数目的service与ingress对象。0号游戏服生成的ingress字段如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ingressClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">rules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test.xxx.cn</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">hangzhou.ali.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ing</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">number</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /game0(/</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">$)(.</span><span class="token important">*)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">pathType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ImplementationSpecific</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ing</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">number</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">pathType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ImplementationSpecific</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> xxx.xx1.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> xxx.xx2.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">status</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">loadBalancer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ingress</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 47.xx.xxx.xxx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其他序号的游戏服只有path字段与service name不同，生成的其他参数都相同。</p><p>对应的0号GameServer的networkStatus如下：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">networkStatus</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">createTime</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-04-28T14:00:30Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">currentNetworkState</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">desiredNetworkState</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">externalAddresses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 47.xx.xxx.xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /game0(/</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">$)(.</span><span class="token important">*)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">internalAddresses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10.xxx.x.xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /game0(/</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">$)(.</span><span class="token important">*)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">lastTransitionTime</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-04-28T14:00:30Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networkType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Kubernetes</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Ingress</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="alibabacloud-natgw">AlibabaCloud-NATGW<a class="hash-link" href="#alibabacloud-natgw" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件名称-3">插件名称<a class="hash-link" href="#插件名称-3" title="Direct link to heading">​</a></h4><p><code>AlibabaCloud-NATGW</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cloud-provider-3">Cloud Provider<a class="hash-link" href="#cloud-provider-3" title="Direct link to heading">​</a></h4><p>AlibabaCloud</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件说明-3">插件说明<a class="hash-link" href="#插件说明-3" title="Direct link to heading">​</a></h4><ul><li><p>AlibabaCloud-NATGW 使用阿里云公网网关作为游戏服对外服务的承载实体，外网流量通过DNAT规则转发至对应的游戏服中。</p></li><li><p>是否支持网络隔离：否</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="网络参数-3">网络参数<a class="hash-link" href="#网络参数-3" title="Direct link to heading">​</a></h4><p>Ports</p><ul><li>含义：填写pod需要暴露的端口</li><li>填写格式：port1,port2,port3… 例如：80,8080,8888</li><li>是否支持变更：不支持</li></ul><p>Protocol</p><ul><li>含义：填写服务的网络协议</li><li>填写格式：例如：tcp，默认为tcp</li><li>是否支持变更：不支持</li></ul><p>Fixed</p><ul><li>含义：是否固定访问IP/端口。若是，即使pod删除重建，网络内外映射关系不会改变</li><li>填写格式：false / true</li><li>是否支持变更：不支持</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件配置-3">插件配置<a class="hash-link" href="#插件配置-3" title="Direct link to heading">​</a></h4><p>无</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="示例说明-3">示例说明<a class="hash-link" href="#示例说明-3" title="Direct link to heading">​</a></h4><p>OKG支持阿里云下NAT网关模型，使用NATGW的外部IP与端口暴露服务，流量最终将转发至Pod之中。使用方式如下：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">|</span><span class="token string bash punctuation" style="color:#393A34"> kubectl apply -f -</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: game.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: GameServerSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: gs-natgw</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  replicas: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  updateStrategy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    rollingUpdate:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      podUpdatePolicy: InPlaceIfPossible</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  network:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    networkType: AlibabaCloud-NATGW</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    networkConf:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    - name: Ports</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      #暴露的端口，格式如下 {port1},{port2}...</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      value: &quot;80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    - name: Protocol</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      #使用的协议，默认为TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      value: &quot;tcp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#   - name: Fixed</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#     是否固定映射关系，默认不固定，pod删除后会生成新的外部IP及端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#     value: &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  gameServerTemplate:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        - image: registry.cn-hangzhou.aliyuncs.com/gs-demo/gameserver:network</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          name: gameserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>生成的GameServer中通过networkStatus字段查看游戏服网络信息：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  networkStatus:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    createTime: </span><span class="token string" style="color:#e3116c">&quot;2022-11-23T11:21:34Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    currentNetworkState: Ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    desiredNetworkState: Ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    externalAddresses:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ip: </span><span class="token number" style="color:#36acaa">47.97</span><span class="token plain">.227.137</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: </span><span class="token string" style="color:#e3116c">&quot;80&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: </span><span class="token string" style="color:#e3116c">&quot;512&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    internalAddresses:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ip: </span><span class="token number" style="color:#36acaa">172.16</span><span class="token plain">.0.189</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: </span><span class="token string" style="color:#e3116c">&quot;80&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: </span><span class="token string" style="color:#e3116c">&quot;80&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastTransitionTime: </span><span class="token string" style="color:#e3116c">&quot;2022-11-23T11:21:34Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    networkType: AlibabaCloud-NATGW</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>访问 47.97.227.137:512 即可</p><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="alibabacloud-slb">AlibabaCloud-SLB<a class="hash-link" href="#alibabacloud-slb" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件名称-4">插件名称<a class="hash-link" href="#插件名称-4" title="Direct link to heading">​</a></h4><p><code>AlibabaCloud-SLB</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cloud-provider-4">Cloud Provider<a class="hash-link" href="#cloud-provider-4" title="Direct link to heading">​</a></h4><p>AlibabaCloud</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件说明-4">插件说明<a class="hash-link" href="#插件说明-4" title="Direct link to heading">​</a></h4><ul><li><p>AlibabaCloud-SLB 使用阿里云经典四层负载均衡（SLB，又称CLB）作为对外服务的承载实体，在此模式下，不同游戏服将使用同一SLB的不同端口，此时SLB只做转发，并未均衡流量。</p></li><li><p>是否支持网络隔离：是</p></li></ul><p>相关设计：<a href="https://github.com/openkruise/kruise-game/issues/20" target="_blank" rel="noopener noreferrer">https://github.com/openkruise/kruise-game/issues/20</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="网络参数-4">网络参数<a class="hash-link" href="#网络参数-4" title="Direct link to heading">​</a></h4><p>SlbIds</p><ul><li>含义：填写slb的id。可填写多个。</li><li>填写格式：各个slbId用,分割。例如：lb-9zeo7prq1m25ctpfrw1m7,lb-bp1qz7h50yd3w58h2f8je,...</li><li>是否支持变更：支持。可追加填写SLB实例id。建议不要更换正在被使用的实例id。</li></ul><p>PortProtocols</p><ul><li>含义：pod暴露的端口及协议，支持填写多个端口/协议</li><li>格式：port1/protocol1,port2/protocol2,...（协议需大写）</li><li>是否支持变更：支持</li></ul><p>Fixed</p><ul><li>含义：是否固定访问IP/端口。若是，即使pod删除重建，网络内外映射关系不会改变</li><li>填写格式：false / true</li><li>是否支持变更：支持</li></ul><p>AllowNotReadyContainers</p><ul><li>含义：在容器原地升级时允许不断流的对应容器名称，可填写多个</li><li>格式：{containerName_0},{containerName_1},... 例如：sidecar</li><li>是否支持变更：在原地升级过程中不可变更。</li></ul><p>LBHealthCheckSwitch</p><ul><li>含义：是否开启健康检查</li><li>格式：“on”代表开启，“off”代表关闭。默认为on</li><li>是否支持变更：支持</li></ul><p>LBHealthCheckFlag</p><ul><li>含义：是否开启http类型健康检查</li><li>格式：“on”代表开启，“off”代表关闭。默认为off</li><li>是否支持变更：支持</li></ul><p>LBHealthCheckType</p><ul><li>含义：健康检查协议</li><li>格式：填写 “tcp” 或者 “http”，默认为tcp</li><li>是否支持变更：支持</li></ul><p>LBHealthCheckConnectTimeout</p><ul><li>含义：健康检查响应的最大超时时间。</li><li>格式：单位：秒。取值范围<!-- -->[1, 300]<!-- -->。默认值为“5”</li><li>是否支持变更：支持</li></ul><p>LBHealthyThreshold</p><ul><li>含义：健康检查连续成功多少次后，将服务器的健康检查状态由失败判定为成功。</li><li>格式：取值范围<!-- -->[2, 10]<!-- -->。默认值为“2”</li><li>是否支持变更：支持</li></ul><p>LBUnhealthyThreshold</p><ul><li>含义：健康检查连续失败多少次后，将服务器的健康检查状态由成功判定为失败。</li><li>格式：取值范围<!-- -->[2, 10]<!-- -->。默认值为“2”</li><li>是否支持变更：支持</li></ul><p>LBHealthCheckInterval</p><ul><li>含义：健康检查的时间间隔。</li><li>格式：单位：秒。取值范围<!-- -->[1, 50]<!-- -->。默认值为“10”</li><li>是否支持变更：支持</li></ul><p>LBHealthCheckProtocolPort</p><ul><li>含义：http类型健康检查的协议及端口。</li><li>格式：多个值之间用英文半角逗号（,）分隔。如https:443,http:80</li><li>是否支持变更：支持</li></ul><p>LBHealthCheckUri</p><ul><li>含义：健康检查类型为HTTP时对应的检查路径。</li><li>格式：长度为1~80个字符，只能使用字母、数字、字符。 必须以正斜线（/）开头。</li><li>是否支持变更：支持</li></ul><p>LBHealthCheckDomain</p><ul><li>含义：健康检查类型为HTTP时对应的域名。</li><li>格式：特定域名长度限制1~80个字符，只能使用小写字母、数字、短划线（-）、半角句号（.）。</li><li>是否支持变更：支持</li></ul><p>LBHealthCheckMethod</p><ul><li>含义：健康检查类型为HTTP时对应的方法。</li><li>格式：“GET” 或者 “HEAD”</li><li>是否支持变更：支持</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件配置-4">插件配置<a class="hash-link" href="#插件配置-4" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[alibabacloud]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enable = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[alibabacloud.slb]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#填写slb可使用的空闲端口段，用于为pod分配外部接入端口，范围为200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_port = 700</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">min_port = 500</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="alibabacloud-nlb">AlibabaCloud-NLB<a class="hash-link" href="#alibabacloud-nlb" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件名称-5">插件名称<a class="hash-link" href="#插件名称-5" title="Direct link to heading">​</a></h4><p><code>AlibabaCloud-NLB</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cloud-provider-5">Cloud Provider<a class="hash-link" href="#cloud-provider-5" title="Direct link to heading">​</a></h4><p>AlibabaCloud</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件说明-5">插件说明<a class="hash-link" href="#插件说明-5" title="Direct link to heading">​</a></h4><ul><li><p>AlibabaCloud-NLB 使用阿里云网络型负载均衡作为对外服务的承载实体，在此模式下，不同游戏服将使用同一NLB的不同端口，此时NLB只做转发，并未均衡流量。</p></li><li><p>是否支持网络隔离：是</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="网络参数-5">网络参数<a class="hash-link" href="#网络参数-5" title="Direct link to heading">​</a></h4><p>NlbIds</p><ul><li>含义：填写nlb的id。可填写多个。</li><li>填写格式：各个nlbId用,分割。例如：nlb-ji8l844c0qzii1x6mc,nlb-26jbknebrjlejt5abu,...</li><li>是否支持变更：支持。可追加填写NLB实例id。建议不要更换正在被使用的实例id。</li></ul><p>PortProtocols</p><ul><li>含义：pod暴露的端口及协议，支持填写多个端口/协议</li><li>格式：port1/protocol1,port2/protocol2,...（协议需大写）</li><li>是否支持变更：支持</li></ul><p>Fixed</p><ul><li>含义：是否固定访问IP/端口。若是，即使pod删除重建，网络内外映射关系不会改变</li><li>填写格式：false / true</li><li>是否支持变更：支持</li></ul><p>AllowNotReadyContainers</p><ul><li>含义：在容器原地升级时允许不断流的对应容器名称，可填写多个</li><li>格式：{containerName_0},{containerName_1},... 例如：sidecar</li><li>是否支持变更：在原地升级过程中不可变更。</li></ul><p>LBHealthCheckFlag</p><ul><li>含义：是否开启健康检查</li><li>格式：“on”代表开启，“off”代表关闭。默认为on</li><li>是否支持变更：支持</li></ul><p>LBHealthCheckType</p><ul><li>含义：健康检查协议</li><li>格式：填写 “tcp” 或者 “http”，默认为tcp</li><li>是否支持变更：支持</li></ul><p>LBHealthCheckConnectPort</p><ul><li>含义：健康检查的服务器端口。</li><li>格式：取值范围<!-- -->[0, 65535]<!-- -->。默认值为“0”</li><li>是否支持变更：支持</li></ul><p>LBHealthCheckConnectTimeout</p><ul><li>含义：健康检查响应的最大超时时间。</li><li>格式：单位：秒。取值范围<!-- -->[1, 300]<!-- -->。默认值为“5”</li><li>是否支持变更：支持</li></ul><p>LBHealthyThreshold</p><ul><li>含义：健康检查连续成功多少次后，将服务器的健康检查状态由失败判定为成功。</li><li>格式：取值范围<!-- -->[2, 10]<!-- -->。默认值为“2”</li><li>是否支持变更：支持</li></ul><p>LBUnhealthyThreshold</p><ul><li>含义：健康检查连续失败多少次后，将服务器的健康检查状态由成功判定为失败。</li><li>格式：取值范围<!-- -->[2, 10]<!-- -->。默认值为“2”</li><li>是否支持变更：支持</li></ul><p>LBHealthCheckInterval</p><ul><li>含义：健康检查的时间间隔。</li><li>格式：单位：秒。取值范围<!-- -->[1, 50]<!-- -->。默认值为“10”</li><li>是否支持变更：支持</li></ul><p>LBHealthCheckUri</p><ul><li>含义：健康检查类型为HTTP时对应的检查路径。</li><li>格式：长度为1~80个字符，只能使用字母、数字、字符。 必须以正斜线（/）开头。</li><li>是否支持变更：支持</li></ul><p>LBHealthCheckDomain</p><ul><li>含义：健康检查类型为HTTP时对应的域名。</li><li>格式：特定域名长度限制1~80个字符，只能使用小写字母、数字、短划线（-）、半角句号（.）。</li><li>是否支持变更：支持</li></ul><p>LBHealthCheckMethod</p><ul><li>含义：健康检查类型为HTTP时对应的方法。</li><li>格式：“GET” 或者 “HEAD”</li><li>是否支持变更：支持</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件配置-5">插件配置<a class="hash-link" href="#插件配置-5" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[alibabacloud]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enable = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[alibabacloud.nlb]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#填写nlb可使用的空闲端口段，用于为pod分配外部接入端口，范围为500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_port = 1500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">min_port = 1000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="示例说明-4">示例说明<a class="hash-link" href="#示例说明-4" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF | kubectl apply -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: game.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: GameServerSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: gs-nlb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  updateStrategy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rollingUpdate:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      podUpdatePolicy: InPlaceIfPossible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    networkConf:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: NlbIds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      value: nlb-muyo7fv6z646ygcxxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: PortProtocols</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      value: &quot;80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: Fixed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      value: &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    networkType: AlibabaCloud-NLB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  gameServerTemplate:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - image: registry.cn-hangzhou.aliyuncs.com/gs-demo/gameserver:network</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name: gameserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>生成的GameServer中通过networkStatus字段查看游戏服网络信息：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  networkStatus:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    createTime: &quot;2024-04-28T12:41:56Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    currentNetworkState: Ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    desiredNetworkState: Ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    externalAddresses:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - endPoint: nlb-muyo7fv6z646ygcxxx.cn-xxx.nlb.aliyuncs.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ip: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: &quot;80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: 1047</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    internalAddresses:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ip: 172.16.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: &quot;80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastTransitionTime: &quot;2024-04-28T12:41:56Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    networkType: AlibabaCloud-NLB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>访问 nlb-muyo7fv6z646ygcxxx.cn-xxx.nlb.aliyuncs.com:1047 即可</p><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="alibabacloud-eip">AlibabaCloud-EIP<a class="hash-link" href="#alibabacloud-eip" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件名称-6">插件名称<a class="hash-link" href="#插件名称-6" title="Direct link to heading">​</a></h4><p><code>AlibabaCloud-EIP</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cloud-provider-6">Cloud Provider<a class="hash-link" href="#cloud-provider-6" title="Direct link to heading">​</a></h4><p>AlibabaCloud</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件说明-6">插件说明<a class="hash-link" href="#插件说明-6" title="Direct link to heading">​</a></h4><ul><li>为每个GameServer单独分配EIP</li><li>暴露的公网访问端口与容器中监听的端口一致，通过安全组管理</li><li>需要在ACK集群安装最新版本ack-extend-network-controller组件，详情请见<a href="https://cs.console.aliyun.com/#/next/app-catalog/ack/incubator/ack-extend-network-controller" target="_blank" rel="noopener noreferrer">组件说明页</a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="网络参数-6">网络参数<a class="hash-link" href="#网络参数-6" title="Direct link to heading">​</a></h4><p>ReleaseStrategy</p><ul><li>含义：EIP回收策略。</li><li>填写格式：<ul><li>Follow：默认值，跟随游戏服生命周期。当游戏服被删除时，EIP也将被回收。</li><li>Never：不删除podEIP。当不需要时需要手动删除这个podEIP。(通过kubectl delete podeip {游戏服name} -n {游戏服所在namespace})</li><li>可直接配置过期时间，例如：5m30s，表示Pod删除5.5分钟后删除podEIP。支持Go类型时间表达式。</li></ul></li><li>是否支持变更：否</li></ul><p>PoolId</p><ul><li>含义：EIP地址池ID。可为空，则不使用EIP地址池。</li><li>是否支持变更：否</li></ul><p>ResourceGroupId</p><ul><li>含义：EIP资源组ID。可为空，则使用默认资源组。</li><li>是否支持变更：否</li></ul><p>Bandwidth</p><ul><li>含义：峰值带宽。单位：Mbps。可为空，默认为5</li><li>是否支持变更：否</li></ul><p>BandwidthPackageId</p><ul><li>含义：要绑定已有的共享带宽包ID。可为空，则EIP不绑定共享带宽包。</li><li>是否支持变更：否</li></ul><p>ChargeType</p><ul><li>含义：EIP的计费方式。</li><li>填写格式：<ul><li>PayByTraffic：按使用流量计费。</li><li>PayByBandwidth：按带宽计费，为默认值。</li></ul></li><li>是否支持变更：否</li></ul><p>Description</p><ul><li>含义：对EIP资源的描述。</li><li>是否支持变更：否</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件配置-6">插件配置<a class="hash-link" href="#插件配置-6" title="Direct link to heading">​</a></h4><p>无</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="示例说明-5">示例说明<a class="hash-link" href="#示例说明-5" title="Direct link to heading">​</a></h4><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> game.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> GameServerSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eip</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">rollingUpdate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">podUpdatePolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InPlaceIfPossible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">network</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networkType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AlibabaCloud</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">EIP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networkConf</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ReleaseStrategy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Never</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Bandwidth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ChargeType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PayByTraffic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">gameServerTemplate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>生成的gameserver eip-nginx-0 networkStatus字段如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">networkStatus</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">createTime</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-07-17T10:10:18Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">currentNetworkState</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">desiredNetworkState</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">externalAddresses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 47.98.xxx.xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">internalAddresses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.1.51</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">lastTransitionTime</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-07-17T10:10:18Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networkType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AlibabaCloud</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">EIP</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>生成对应的podeip eip-nginx-0 如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> alibabacloud.com/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PodEIP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">k8s.aliyun.com/eip-controller</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ack</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">extend</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">network</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">creationTimestamp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-07-17T09:58:12Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">finalizers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> podeip</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">controller.alibabacloud.com/finalizer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">generation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eip</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resourceVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;41443319&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">uid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 105a9575</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">998e</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">4e17</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ab91</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">8f2597eeb55f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">allocationID</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eip</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">allocationType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">releaseStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Never</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Auto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">status</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">eipAddress</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 47.98.xxx.xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">internetChargeType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PayByTraffic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">isp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> BGP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">networkInterfaceID</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eni</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">podLastSeen</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-07-17T10:36:02Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">privateIPAddress</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.1.51</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resourceGroupID</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rg</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">status</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InUse</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此外，生成的EIP资源在阿里云控制台中会以{pod namespace}/{pod name}命名，与每一个游戏服一一对应。</p><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="alibabacloud-slb-sharedport">AlibabaCloud-SLB-SharedPort<a class="hash-link" href="#alibabacloud-slb-sharedport" title="Direct link to heading">​</a></h3><p><code>AlibabaCloud-SLB-SharedPort</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cloud-provider-7">Cloud Provider<a class="hash-link" href="#cloud-provider-7" title="Direct link to heading">​</a></h4><p>AlibabaCloud</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件说明-7">插件说明<a class="hash-link" href="#插件说明-7" title="Direct link to heading">​</a></h4><ul><li><p>AlibabaCloud-SLB-SharedPort 使用阿里云经典四层负载均衡（SLB，又称CLB）作为对外服务的承载实体。但与AlibabaCloud-SLB不同，<code>AlibabaCloud-SLB-SharedPort</code> 使用SLB同一端口转发流量，具有负载均衡的特点。
适用于游戏场景下代理（proxy）或网关等无状态网络服务。</p></li><li><p>是否支持网络隔离：是</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="网络参数-7">网络参数<a class="hash-link" href="#网络参数-7" title="Direct link to heading">​</a></h4><p>SlbIds</p><ul><li>含义：填写slb的id，支持填写多例</li><li>填写格式：例如：lb-9zeo7prq1m25ctpfrw1m7</li><li>是否支持变更：支持。</li></ul><p>PortProtocols</p><ul><li>含义：pod暴露的端口及协议，支持填写多个端口/协议</li><li>格式：port1/protocol1,port2/protocol2,...（协议需大写）</li><li>是否支持变更：暂不支持。未来将支持</li></ul><p>AllowNotReadyContainers</p><ul><li>含义：在容器原地升级时允许不断流的对应容器名称，可填写多个</li><li>格式：{containerName_0},{containerName_1},... 例如：sidecar</li><li>是否支持变更：在原地升级过程中不可变更。</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件配置-7">插件配置<a class="hash-link" href="#插件配置-7" title="Direct link to heading">​</a></h4><p>无</p><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="alibabacloud-nlb-sharedport">AlibabaCloud-NLB-SharedPort<a class="hash-link" href="#alibabacloud-nlb-sharedport" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件名称-7">插件名称<a class="hash-link" href="#插件名称-7" title="Direct link to heading">​</a></h4><p><code>AlibabaCloud-NLB-SharedPort</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cloud-provider-8">Cloud Provider<a class="hash-link" href="#cloud-provider-8" title="Direct link to heading">​</a></h4><p>AlibabaCloud</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件说明-8">插件说明<a class="hash-link" href="#插件说明-8" title="Direct link to heading">​</a></h4><ul><li><p>AlibabaCloud-NLB-SharedPort 使用阿里云网络型负载均衡（NLB）作为对外服务的承载实体。其与AlibabaCloud-SLB-SharedPort作用类似。
适用于游戏场景下代理（proxy）或网关等无状态网络服务。</p></li><li><p>是否支持网络隔离：是</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="网络参数-8">网络参数<a class="hash-link" href="#网络参数-8" title="Direct link to heading">​</a></h4><p>SlbIds</p><ul><li>含义：填写nlb的id，暂不支持填写多例</li><li>填写格式：例如：nlb-9zeo7prq1m25ctpfrw1m7</li><li>是否支持变更：暂不支持。</li></ul><p>PortProtocols</p><ul><li>含义：pod暴露的端口及协议，支持填写多个端口/协议</li><li>格式：port1/protocol1,port2/protocol2,...（协议需大写）</li><li>是否支持变更：暂不支持。</li></ul><p>AllowNotReadyContainers</p><ul><li>含义：在容器原地升级时允许不断流的对应容器名称，可填写多个</li><li>格式：{containerName_0},{containerName_1},... 例如：sidecar</li><li>是否支持变更：在原地升级过程中不可变更。</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件配置-8">插件配置<a class="hash-link" href="#插件配置-8" title="Direct link to heading">​</a></h4><p>无</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="示例说明-6">示例说明<a class="hash-link" href="#示例说明-6" title="Direct link to heading">​</a></h4><p>部署一个具有两个容器的GameServerSet，一个容器名为app-2048，另一个为sidecar。
指定网络参数 AllowNotReadyContainers 为 sidecar，则在sidecar原地更新时整个pod依然会提供服务，不会断流。</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> game.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> GameServerSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gss</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">2048</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">nlb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">rollingUpdate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">maxUnavailable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 100%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">podUpdatePolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InPlaceIfPossible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">network</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networkType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AlibabaCloud</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">NLB</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">SharedPort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networkConf</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NlbIds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nlb</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">26jbknebrjlejt5abu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PortProtocols</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 80/TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AllowNotReadyContainers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">gameServerTemplate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> registry.cn</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">beijing.aliyuncs.com/acs/2048</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">v1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2048</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> shared</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/www/html/js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> registry.cn</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">beijing.aliyuncs.com/acs/2048</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sidecar</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">v1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> rsync </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">aP /app/js/* /app/scripts/ </span><span class="token important">&amp;&amp;</span><span class="token plain"> while true; do echo 11;sleep 2; done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> shared</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /app/scripts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> shared</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">emptyDir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>部署成功后，将sidecar镜像更新到v2.0版本，同时观察对应endpoint情况:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get ep -w </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> nlb-26jbknebrjlejt5abu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nlb-26jbknebrjlejt5abu      </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.0.8:80,192.168.0.82:80,192.168.63.228:80    10m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>等待整个更新过程结束，可以发现ep没有任何变化，说明并未进行摘流。</p><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="volcengine-clb">Volcengine-CLB<a class="hash-link" href="#volcengine-clb" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件名称-8">插件名称<a class="hash-link" href="#插件名称-8" title="Direct link to heading">​</a></h4><p><code>Volcengine-CLB</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cloud-provider-9">Cloud Provider<a class="hash-link" href="#cloud-provider-9" title="Direct link to heading">​</a></h4><p>Volcengine</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件说明-9">插件说明<a class="hash-link" href="#插件说明-9" title="Direct link to heading">​</a></h4><ul><li><p>火山引擎容器服务支持在k8s中对CLB复用的机制，不同的svc可以使用同一个CLB的不同端口。由此，Volcengine-CLB network plugin将记录各CLB对应的端口分配情况，对于指定了网络类型为Volcengine-CLB，Volcengine-CLB网络插件将会自动分配一个端口并创建一个service对象，待svc ingress字段的公网IP创建成功后，GameServer的网络处于Ready状态，该过程执行完成。</p></li><li><p>是否支持网络隔离：是</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="网络参数-9">网络参数<a class="hash-link" href="#网络参数-9" title="Direct link to heading">​</a></h4><p>ClbIds</p><ul><li>含义：填写clb的id，可填写多个，需要现在【火山引擎】中创建好clb。</li><li>填写格式：各个clbId用,分割。例如：clb-9zeo7prq1m25ctpfrw1m7,clb-bp1qz7h50yd3w58h2f8je,...</li><li>是否支持变更：是</li></ul><p>PortProtocols</p><ul><li>含义：pod暴露的端口及协议，支持填写多个端口/协议</li><li>格式：port1/protocol1,port2/protocol2,...（协议需大写）</li><li>是否支持变更：支持</li></ul><p>Fixed</p><ul><li>含义：是否固定访问IP/端口。若是，即使pod删除重建，网络内外映射关系不会改变</li><li>填写格式：false / true</li><li>是否支持变更：支持</li></ul><p>AllocateLoadBalancerNodePorts</p><ul><li>含义：生成的service是否分配nodeport, 仅在clb的直通模式（passthrough）下，才能设置为false</li><li>填写格式：true/false</li><li>是否支持变更：是</li></ul><p>AllowNotReadyContainers</p><ul><li>含义：在容器原地升级时允许不断流的对应容器名称，可填写多个</li><li>格式：{containerName_0},{containerName_1},... 例如：sidecar</li><li>是否支持变更：在原地升级过程中不可变更。</li></ul><p>Annotations</p><ul><li>含义：添加在service上的anno，可填写多个</li><li>填写格式：key1:value1,key2:value2...</li><li>是否支持变更：是</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件配置-9">插件配置<a class="hash-link" href="#插件配置-9" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[volcengine]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enable = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[volcengine.clb]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#填写clb可使用的空闲端口段，用于为pod分配外部接入端口，范围最大为200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_port = 700</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">min_port = 500</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="示例说明-7">示例说明<a class="hash-link" href="#示例说明-7" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF | kubectl apply -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: game.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: GameServerSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: gss-2048-clb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  updateStrategy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rollingUpdate:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      podUpdatePolicy: InPlaceIfPossible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    networkType: Volcengine-CLB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    networkConf:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: ClbIds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #Fill in Volcengine Cloud LoadBalancer Id here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value: clb-xxxxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: PortProtocols</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #Fill in the exposed ports and their corresponding protocols here. </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #If there are multiple ports, the format is as follows: {port1}/{protocol1},{port2}/{protocol2}...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #If the protocol is not filled in, the default is TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value: 80/TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: AllocateLoadBalancerNodePorts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Whether the generated service is assigned nodeport.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value: &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: Fixed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #Fill in here whether a fixed IP is required [optional] ; Default is false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value: &quot;false&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: Annotations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #Fill in the anno related to clb on the service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #The format is as follows: {key1}:{value1},{key2}:{value2}...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value: &quot;key1:value1,key2:value2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  gameServerTemplate:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - image: cr-helm2-cn-beijing.cr.volces.com/kruise/2048:v1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name: app-2048</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - name: shared-dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              mountPath: /var/www/html/js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - image: cr-helm2-cn-beijing.cr.volces.com/kruise/2048-sidecar:v1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name: sidecar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - -c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - rsync -aP /app/js/* /app/scripts/ &amp;&amp; while true; do echo 11;sleep 2; done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - name: shared-dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              mountPath: /app/scripts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: shared-dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          emptyDir: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>检查GameServer中的网络状态:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">networkStatus:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    createTime: &quot;2024-01-19T08:19:49Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    currentNetworkState: Ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    desiredNetworkState: Ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    externalAddresses:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ip: xxx.xxx.xx.xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: &quot;80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: 6611</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    internalAddresses:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ip: 172.16.200.60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: &quot;80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastTransitionTime: &quot;2024-01-19T08:19:49Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    networkType: Volcengine-CLB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="amazonwebservices-nlb">AmazonWebServices-NLB<a class="hash-link" href="#amazonwebservices-nlb" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件名称-9">插件名称<a class="hash-link" href="#插件名称-9" title="Direct link to heading">​</a></h4><p><code>AmazonWebServices-NLB</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cloud-provider-10">Cloud Provider<a class="hash-link" href="#cloud-provider-10" title="Direct link to heading">​</a></h4><p>AmazonWebServices</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件说明-10">插件说明<a class="hash-link" href="#插件说明-10" title="Direct link to heading">​</a></h4><ul><li><p>对于在AWS EKS集群中使用OKG的游戏业务，通过网络负载均衡将流量直接路由到Pod端口是实现高性能实时服务发现的基础。利用NLB进行动态端口映射，简化了转发链路，规避了Kubernetes kube-proxy负载均衡带来的性能损耗。这些特性对于处理副本战斗类型的游戏服务器尤为关键。对于指定了网络类型为AmazonWebServices-NLB的GameServerSet，AmazonWebServices-NLB网络插件将会调度一个NLB，自动分配端口，创建侦听器和目标组，并通过TargetGroupBinding CRD将目标组与Kubernetes服务进行关联。如果集群配置了VPC-CNI，那么此时流量将自动转发到Pod的IP地址；否则将通过ClusterIP转发。观察到GameServer的网络处于Ready状态时，该过程即执行成功。</p></li><li><p>是否支持网络隔离：否</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="前提准备">前提准备<a class="hash-link" href="#前提准备" title="Direct link to heading">​</a></h4><p>由于AWS的设计有所区别，要实现NLB端口与Pod端口映射，需要创建三类CRD资源：Listener/TargetGroup/TargetGroupBinding</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="部署elbv2-controller">部署elbv2-controller：<a class="hash-link" href="#部署elbv2-controller" title="Direct link to heading">​</a></h5><p>Listener/TargetGroup的CRD定义及控制器：<a href="https://github.com/aws-controllers-k8s/elbv2-controller" target="_blank" rel="noopener noreferrer">https://github.com/aws-controllers-k8s/elbv2-controller</a> ，该项目联动了k8s资源与AWS云资源，chart下载：<a href="https://gallery.ecr.aws/aws-controllers-k8s/elbv2-chart" target="_blank" rel="noopener noreferrer">https://gallery.ecr.aws/aws-controllers-k8s/elbv2-chart</a> ，value.yaml示例：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">serviceAccount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">eks.amazonaws.com/role-arn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;arn:aws:iam::xxxxxxxxx:role/test&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">aws</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">region</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;us-east-1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">endpoint_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://elasticloadbalancing.us-east-1.amazonaws.com&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>部署该项目最关键的在于授权k8s ServiceAccount访问NLB SDK，推荐通过IAM角色的方式：</p><h6 class="anchor anchorWithStickyNavbar_LWe7" id="步骤-1为-eks-集群启用-oidc-提供者">步骤 1：为 EKS 集群启用 OIDC 提供者<a class="hash-link" href="#步骤-1为-eks-集群启用-oidc-提供者" title="Direct link to heading">​</a></h6><ol><li>登录到 AWS 管理控制台。</li><li>导航到 EKS 控制台：<a href="https://console.aws.amazon.com/eks/" target="_blank" rel="noopener noreferrer">https://console.aws.amazon.com/eks/</a></li><li>选择您的集群。</li><li>在集群详细信息页面上，确保 OIDC 提供者已启用。获取 EKS 集群的 OIDC 提供者 URL。在集群详细信息页面的 “Configuration” 部分，找到 “OpenID Connect provider URL”。</li></ol><h6 class="anchor anchorWithStickyNavbar_LWe7" id="步骤-2配置-iam-角色信任策略">步骤 2：配置 IAM 角色信任策略<a class="hash-link" href="#步骤-2配置-iam-角色信任策略" title="Direct link to heading">​</a></h6><ol><li>在 IAM 控制台中，创建一个新的身份提供商，并选择 “OpenID Connect”</li></ol><ul><li>提供商URL填写EKS 集群的 OIDC 提供者 URL</li><li>受众填写：<code>sts.amazonaws.com</code></li></ul><ol start="2"><li>在 IAM 控制台中，创建一个新的 IAM 角色，并选择 “Custom trust policy”。</li></ol><ul><li>使用以下信任策略，允许 EKS 使用这个角色：<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;Version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2012-10-17&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;Statement&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;Effect&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Allow&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;Principal&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Federated&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;arn:aws:iam::&lt;AWS_ACCOUNT_ID&gt;:oidc-provider/oidc.eks.&lt;REGION&gt;.amazonaws.com/id/&lt;OIDC_ID&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;Action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sts:AssumeRoleWithWebIdentity&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;Condition&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;StringEquals&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;oidc.eks.&lt;REGION&gt;.amazonaws.com/id/&lt;OIDC_ID&gt;:sub&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;system:serviceaccount:&lt;NAMESPACE&gt;:ack-elbv2-controller&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;oidc.eks.&lt;REGION&gt;.amazonaws.com/id/&lt;OIDC_ID&gt;:aud&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sts.amazonaws.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>将 <code>&lt;AWS_ACCOUNT_ID&gt;</code>、<code>&lt;REGION&gt;</code>、<code>&lt;OIDC_ID&gt;</code>、<code>&lt;NAMESPACE&gt;</code> 和 <code>&lt;SERVICE_ACCOUNT_NAME&gt;</code> 替换为您的实际值。</li><li>添加权限 <code>ElasticLoadBalancingFullAccess</code></li></ul><h5 class="anchor anchorWithStickyNavbar_LWe7" id="部署aws-load-balancer-controller">部署AWS Load Balancer Controller：<a class="hash-link" href="#部署aws-load-balancer-controller" title="Direct link to heading">​</a></h5><p>TargetGroupBinding的CRD及控制器：<a href="https://github.com/kubernetes-sigs/aws-load-balancer-controller/" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes-sigs/aws-load-balancer-controller/</a></p><p>官方部署文档：<a href="https://docs.aws.amazon.com/eks/latest/userguide/lbc-helm.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/eks/latest/userguide/lbc-helm.html</a> 其本质也是通过授权k8s ServiceAccount一个IAM角色的方式。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="网络参数-10">网络参数<a class="hash-link" href="#网络参数-10" title="Direct link to heading">​</a></h4><p>NlbARNs</p><ul><li>含义：填写nlb的arn，可填写多个，需要现在【AWS】中创建好nlb。</li><li>填写格式：各个nlbARN用,分割。例如：arn:aws:elasticloadbalancing:us-east-1:888888888888:loadbalancer/net/aaa/3b332e6841f23870,arn:aws:elasticloadbalancing:us-east-1:000000000000:loadbalancer/net/bbb/5fe74944d794d27e</li><li>是否支持变更：是</li></ul><p>NlbVPCId</p><ul><li>含义：填写nlb所在的vpcid，创建AWS目标组需要。</li><li>填写格式：字符串。例如：vpc-0bbc9f9f0ffexxxxx</li><li>是否支持变更：是</li></ul><p>NlbHealthCheck</p><ul><li>含义：填写nlb目标组的健康检查参数，可不填使用默认值。</li><li>填写格式：各个配置用,分割。例如：&quot;healthCheckEnabled:true,healthCheckIntervalSeconds:30,healthCheckPath:/health,healthCheckPort:8081,healthCheckProtocol:HTTP,healthCheckTimeoutSeconds:10,healthyThresholdCount:5,unhealthyThresholdCount:2&quot;</li><li>是否支持变更：是</li><li>参数解释：<ul><li><strong>healthCheckEnabled</strong>：指示是否启用了健康检查。如果目标类型是lambda，默认情况下健康检查是禁用的，但可以启用。如果目标类型是instance、ip或alb，健康检查总是启用的，且不能禁用。</li><li><strong>healthCheckIntervalSeconds</strong>：每个目标之间健康检查的时间间隔（以秒为单位）。 取值范围为5-300秒。如果目标组协议是TCP、TLS、UDP、TCP_UDP、HTTP或HTTPS，默认值为30秒。 如果目标组协议是GENEVE，默认值为10秒。如果目标类型是lambda，默认值为35秒。</li><li><strong>healthCheckPath</strong>：<!-- -->[HTTP/HTTPS健康检查]<!-- --> 目标健康检查的路径。 <!-- -->[HTTP1或HTTP2协议版本]<!-- --> ping路径。默认值为/。  <!-- -->[GRPC协议版本]<!-- --> 自定义健康检查方法的路径，格式为/package.service/method。默认值为/Amazon Web Services.ALB/healthcheck。</li><li><strong>healthCheckPort</strong>：负载均衡器在对目标执行健康检查时使用的端口。 如果协议是HTTP、HTTPS、TCP、TLS、UDP或TCP_UDP，默认值为traffic-port，这是每个目标接收负载均衡器流量的端口。 如果协议是GENEVE，默认值为端口80。</li><li><strong>healthCheckProtocol</strong>：负载均衡器在对目标执行健康检查时使用的协议。 对于应用负载均衡器，默认协议是HTTP。对于网络负载均衡器和网关负载均衡器，默认协议是TCP。 如果目标组协议是HTTP或HTTPS，则不支持TCP协议进行健康检查。GENEVE、TLS、UDP和TCP_UDP协议不支持健康检查。</li><li><strong>healthCheckTimeoutSeconds</strong>：在目标没有响应的情况下，认为健康检查失败的时间（以秒为单位）。取值范围为2-120秒。对于HTTP协议的目标组，默认值为6秒。对于TCP、TLS或HTTPS协议的目标组，默认值为10秒。对于GENEVE协议的目标组，默认值为5秒。如果目标类型是lambda，默认值为30秒。</li><li><strong>healthyThresholdCount</strong>：在将目标标记为健康之前所需的连续健康检查成功次数。取值范围为2-10。如果目标组协议是TCP、TCP_UDP、UDP、TLS、HTTP或HTTPS，默认值为5。 对于GENEVE协议的目标组，默认值为5。如果目标类型是lambda，默认值为5。</li><li><strong>unhealthyThresholdCount</strong>：指定在将目标标记为不健康之前所需的连续健康检查失败次数。取值范围为2-10。如果目标组的协议是TCP、TCP_UDP、UDP、TLS、HTTP或HTTPS，默认值为2。如果目标组的协议是GENEVE，默认值为2。如果目标类型是lambda，默认值为5。</li></ul></li></ul><p>PortProtocols</p><ul><li>含义：pod暴露的端口及协议，支持填写多个端口/协议</li><li>填写格式：port1/protocol1,port2/protocol2,...（协议需大写）</li><li>是否支持变更：是</li></ul><p>Fixed</p><ul><li>含义：是否固定访问端口。若是，即使pod删除重建，网络内外映射关系不会改变</li><li>填写格式：false / true</li><li>是否支持变更：是</li></ul><p>AllowNotReadyContainers</p><ul><li>含义：在容器原地升级时允许不断流的对应容器名称，可填写多个</li><li>填写格式：{containerName_0},{containerName_1},... 例如：sidecar</li><li>是否支持变更：在原地升级过程中不可变更</li></ul><p>Annotations</p><ul><li>含义：添加在service上的anno，可填写多个</li><li>填写格式：key1:value1,key2:value2...</li><li>是否支持变更：是</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="插件配置-10">插件配置<a class="hash-link" href="#插件配置-10" title="Direct link to heading">​</a></h4><div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[aws]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enable = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[aws.nlb]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 填写nlb可使用的空闲端口段，用于为pod分配外部接入端口，范围最大为50(闭区间)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 50限制来自AWS对侦听器数量的限制，参考：https://docs.aws.amazon.com/elasticloadbalancing/latest/network/load-balancer-limits.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_port = 32050</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">min_port = 32001</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="示例说明-8">示例说明<a class="hash-link" href="#示例说明-8" title="Direct link to heading">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">|</span><span class="token string bash punctuation" style="color:#393A34"> kubectl apply -f -</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: game.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: GameServerSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: gs-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  replicas: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  updateStrategy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    rollingUpdate:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      podUpdatePolicy: InPlaceIfPossible</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  network:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    networkType: AmazonWebServices-NLB</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    networkConf:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    - name: NlbARNs</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      value: &quot;arn:aws:elasticloadbalancing:us-east-1:xxxxxxxxxxxx:loadbalancer/net/okg-test/yyyyyyyyyyyyyyyy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    - name: NlbVPCId</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      value: &quot;vpc-0bbc9f9f0ffexxxxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    - name: PortProtocols</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      value: &quot;80/TCP&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    - name: NlbHealthCheck</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      value: &quot;healthCheckIntervalSeconds:15&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  gameServerTemplate:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        - image: registry.cn-hangzhou.aliyuncs.com/gs-demo/gameserver:network</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          name: gameserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>检查GameServer中的网络状态：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">networkStatus:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    createTime: &quot;2024-05-30T03:34:14Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    currentNetworkState: Ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    desiredNetworkState: Ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    externalAddresses:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - endPoint: okg-test-yyyyyyyyyyyyyyyy.elb.us-east-1.amazonaws.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ip: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: &quot;80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: 32034</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    internalAddresses:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ip: 10.10.7.154</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: &quot;80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastTransitionTime: &quot;2024-05-30T03:34:14Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    networkType: AmazonWebServices-NLB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="网络隔离">网络隔离<a class="hash-link" href="#网络隔离" title="Direct link to heading">​</a></h2><p>考虑以下场景，如：</p><ul><li>游戏服发生重大异常，需要避免玩家连入</li><li>版本更新前，切断玩家网络连接</li><li>其他临时有关服的需求，待运维处理后再次开服</li></ul><p>相对直接将游戏服Pod删除的方式，在接入层进行网络隔离是更简便、轻量的操作，可以保留Pod与GameServer元数据信息，无需重建，提高再开服效率。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用方法">使用方法<a class="hash-link" href="#使用方法" title="Direct link to heading">​</a></h3><p>GameServer.Spec 具有 NetworkDisabled 字段。 GameServerSet部署生成的GameServers，其默认的 NetworkDisabled 为 false，意味着游戏服部署时都不会设置网络隔离。</p><p>当游戏服具有网络隔离的需求时，可以通过 手动(kubectl/K8s API) / 自定义服务质量 的方式设置 GameServer.Spec.NetworkDisabled 为 true，则开始进行网络隔离；置为false时，再恢复网络。</p><p>需要注意的是，网络隔离功能由各个网络插件提供，需要用户在使用网络插件的时候查阅对应插件是否支持网络隔离功能。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="获取网络信息">获取网络信息<a class="hash-link" href="#获取网络信息" title="Direct link to heading">​</a></h2><p>GameServer Network Status可以通过两种方式获取</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="k8s-api">k8s API<a class="hash-link" href="#k8s-api" title="Direct link to heading">​</a></h3><p>调用K8s API，获取GameServer对象。该方式适用于中心组件，通常在匹配服务获取游戏服网络信息，用于路由选择等。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="downwardapi">DownwardAPI<a class="hash-link" href="#downwardapi" title="Direct link to heading">​</a></h3><p>通过DownwardAPI，将网络信息下沉至业务容器中，供游戏服业务容器使用</p><p>该方法的示例如下:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> game.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> GameServerSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">slb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">rollingUpdate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">podUpdatePolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InPlaceIfPossible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">network</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networkType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AlibabaCloud</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">SLB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networkConf</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SlbIds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;xxx&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PortProtocols</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;xxx&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Fixed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">gameServerTemplate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> registry.cn</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">hangzhou.aliyuncs.com/gs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo/gameserver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">network</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gameserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> podinfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/podinfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> podinfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">downwardAPI</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">items</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;network&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">fieldRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token key atrule" style="color:#00a4db">fieldPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> metadata.annotations</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;game.kruise.io/network-status&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>字段说明:</p><ul><li>在对应container字段中声明 volumeMounts，定义访问路径，此例中为 /etc/podinfo</li><li>在 gameServerTemplate.spec 里声明downwardAPI，文件名设置为 “network“，并指定使用 “game.kruise.io/network-status” 该annotation。注意annotation的key要使用单引号&#x27;&#x27;，双引号pod将创建失败。</li></ul><p>业务pod及容器创建成功后，在对应的/etc/podinfo路径下存在 network 文件，其中记录了序列化后的网络信息，该信息可通过json解码成对应structure，在程序获取相应字段使用。解码的sample如下（golang版本）</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;encoding/json&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/openkruise/kruise-game/apis/v1alpha1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;os&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getNetwork</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    network</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ReadFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/etc/podinfo/network&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    networkStatus </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">v1alpha1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">NetworkStatus</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    err </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Unmarshal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">network</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> networkStatus</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 访问networkStatus各个字段</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="faq">FAQ<a class="hash-link" href="#faq" title="Direct link to heading">​</a></h2><p>Q: 如何更改网络插件配置?</p><p>A: 可以通过编辑kruise-game-system命名空间下的configmap对默认参数进行更改。更改后重建kruise-game-manager，使配置生效。建议集群游戏服已使用OKG网络插件的情况下不轻易更改相应配置，应提前做好合理的网络规划。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vbeJ"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-08-23T00:14:49.000Z">2024/8/23</time></b> by <b>ChrisLiu</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/kruisegame/user-manuals/service-qualities"><div class="pagination-nav__sublabel">上一篇</div><div class="pagination-nav__label">自定义服务质量</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/kruisegame/user-manuals/lifecycle"><div class="pagination-nav__sublabel">下一篇</div><div class="pagination-nav__label">自定义生命周期管理</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#功能概述" class="table-of-contents__link toc-highlight">功能概述</a></li><li><a href="#网络插件附录" class="table-of-contents__link toc-highlight">网络插件附录</a><ul><li><a href="#kubernetes-hostport" class="table-of-contents__link toc-highlight">Kubernetes-HostPort</a></li><li><a href="#kubernetes-nodeport" class="table-of-contents__link toc-highlight">Kubernetes-NodePort</a></li><li><a href="#kubernetes-ingress" class="table-of-contents__link toc-highlight">Kubernetes-Ingress</a></li><li><a href="#alibabacloud-natgw" class="table-of-contents__link toc-highlight">AlibabaCloud-NATGW</a></li><li><a href="#alibabacloud-slb" class="table-of-contents__link toc-highlight">AlibabaCloud-SLB</a></li><li><a href="#alibabacloud-nlb" class="table-of-contents__link toc-highlight">AlibabaCloud-NLB</a></li><li><a href="#alibabacloud-eip" class="table-of-contents__link toc-highlight">AlibabaCloud-EIP</a></li><li><a href="#alibabacloud-slb-sharedport" class="table-of-contents__link toc-highlight">AlibabaCloud-SLB-SharedPort</a></li><li><a href="#alibabacloud-nlb-sharedport" class="table-of-contents__link toc-highlight">AlibabaCloud-NLB-SharedPort</a></li><li><a href="#volcengine-clb" class="table-of-contents__link toc-highlight">Volcengine-CLB</a></li><li><a href="#amazonwebservices-nlb" class="table-of-contents__link toc-highlight">AmazonWebServices-NLB</a></li></ul></li><li><a href="#网络隔离" class="table-of-contents__link toc-highlight">网络隔离</a><ul><li><a href="#使用方法" class="table-of-contents__link toc-highlight">使用方法</a></li></ul></li><li><a href="#获取网络信息" class="table-of-contents__link toc-highlight">获取网络信息</a><ul><li><a href="#k8s-api" class="table-of-contents__link toc-highlight">k8s API</a></li><li><a href="#downwardapi" class="table-of-contents__link toc-highlight">DownwardAPI</a></li></ul></li><li><a href="#faq" class="table-of-contents__link toc-highlight">FAQ</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh/docs/installation">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://kubernetes.slack.com/channels/openkruise" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kubernetes Slack ( #openkruise channel )<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/zh/kruisegame/user-manuals/">DingTalk (GroupID: 23330762 )</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/kruisegame/user-manuals/">WeChat (User: openkruise )</a></li><li class="footer__item"><a href="https://shimo.im/docs/gXqmeQOYBehZ4vqo" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bi-week Meeting (APAC, Chinese)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/openkruise/kruise" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/openkruise/community/blob/master/community-membership.md" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community Membership<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <br>
        <strong>© 2024 The OpenKruise Authors. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/"> Trademark Usage</a> page.</strong></div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.3d7ecf66.js"></script>
<script src="/zh/assets/js/main.81bdb029.js"></script>
</body>
</html>