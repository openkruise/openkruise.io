<!doctype html>
<html class="docs-version-v0.10.0" lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="OpenKruise Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="OpenKruise Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="OpenKruise" href="/zh/opensearch.xml"><title data-react-helmet="true">SidecarSet | OpenKruise</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://openkruise.io/zh/docs/user-manuals/sidecarset"><meta data-react-helmet="true" name="docsearch:language" content="zh"><meta data-react-helmet="true" name="docsearch:version" content="v0.10.0"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-v0.10.0"><meta data-react-helmet="true" property="og:title" content="SidecarSet | OpenKruise"><meta data-react-helmet="true" name="description" content="è¿™ä¸ªæ§åˆ¶å™¨æ”¯æŒé€šè¿‡ admission webhook æ¥è‡ªåŠ¨ä¸ºé›†ç¾¤ä¸­åˆ›å»ºçš„ç¬¦åˆæ¡ä»¶çš„ Pod æ³¨å…¥ sidecar å®¹å™¨ã€‚"><meta data-react-helmet="true" property="og:description" content="è¿™ä¸ªæ§åˆ¶å™¨æ”¯æŒé€šè¿‡ admission webhook æ¥è‡ªåŠ¨ä¸ºé›†ç¾¤ä¸­åˆ›å»ºçš„ç¬¦åˆæ¡ä»¶çš„ Pod æ³¨å…¥ sidecar å®¹å™¨ã€‚"><link data-react-helmet="true" rel="shortcut icon" href="/zh/img/openkruise.ico"><link data-react-helmet="true" rel="canonical" href="https://openkruise.io/zh/docs/user-manuals/sidecarset"><link data-react-helmet="true" rel="alternate" href="https://openkruise.io/docs/user-manuals/sidecarset" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://openkruise.io/zh/docs/user-manuals/sidecarset" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://openkruise.io/docs/user-manuals/sidecarset" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/zh/assets/css/styles.8a3b6be6.css">
<link rel="preload" href="/zh/assets/js/runtime~main.5f3e2d1b.js" as="script">
<link rel="preload" href="/zh/assets/js/main.eced9e91.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" role="banner"><div class="announcementBarPlaceholder_2m9F"></div><div class="announcementBarContent_3EUC">â­ï¸ If you like OpenKruise, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/openkruise/kruise">GitHub</a>! â­ï¸</div><button type="button" class="clean-btn close announcementBarClose_38nx" aria-label="Close"><svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"></path></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><img src="/zh/img/openkruise.ico" alt="OpenKruise" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/zh/img/openkruise.ico" alt="OpenKruise" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">OpenKruise</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh/docs/">æ–‡æ¡£</a><a class="navbar__item navbar__link" href="/zh/blog">åšå®¢</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/zh/docs/">v0.10.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/docs/next/user-manuals/sidecarset">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zh/docs/user-manuals/sidecarset">v0.10.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_3vod"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>ç®€ä½“ä¸­æ–‡</span></span></a><ul class="dropdown__menu"><li><a href="/docs/user-manuals/sidecarset" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/zh/docs/user-manuals/sidecarset" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">ç®€ä½“ä¸­æ–‡</a></li></ul></div><a href="https://github.com/openkruise/kruise" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#">å¿«é€Ÿå¼€å§‹</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/">OpenKruise ç®€ä»‹</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/installation">å®‰è£…</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#">æ ¸å¿ƒæ¦‚å¿µ</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/core-concepts/architecture">ç³»ç»Ÿæ¶æ„</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">ç”¨æˆ·æ‰‹å†Œ</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">é€šç”¨å·¥ä½œè´Ÿè½½</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">ä»»åŠ¡å·¥ä½œè´Ÿè½½</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Sidecarå®¹å™¨ç®¡ç†</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/docs/user-manuals/sidecarset">SidecarSet</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">å¤šåŒºåŸŸç®¡ç†</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">å¢å¼ºè¿ç»´èƒ½åŠ›</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">åº”ç”¨å®‰å…¨é˜²æŠ¤</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Best Practices</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">å¼€å‘è€…æ‰‹å†Œ</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/zh/docs/faq">FAQ</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><span class="theme-doc-version-badge badge badge--secondary">Version: v0.10.0</span><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>SidecarSet</h1></header><p>è¿™ä¸ªæ§åˆ¶å™¨æ”¯æŒé€šè¿‡ admission webhook æ¥è‡ªåŠ¨ä¸ºé›†ç¾¤ä¸­åˆ›å»ºçš„ç¬¦åˆæ¡ä»¶çš„ Pod æ³¨å…¥ sidecar å®¹å™¨ã€‚
è¿™ä¸ªæ³¨å…¥è¿‡ç¨‹å’Œ <a href="https://istio.io/docs/setup/kubernetes/additional-setup/sidecar-injection/" target="_blank" rel="noopener noreferrer">istio</a>
çš„è‡ªåŠ¨æ³¨å…¥æ–¹å¼å¾ˆç±»ä¼¼ã€‚
é™¤äº†åœ¨ Pod åˆ›å»ºæ—¶å€™æ³¨å…¥å¤–ï¼ŒSidecarSet è¿˜æä¾›äº†ä¸ºè¿è¡Œæ—¶ Pod åŸåœ°å‡çº§å…¶ä¸­å·²ç»æ³¨å…¥çš„ sidecar å®¹å™¨é•œåƒçš„èƒ½åŠ›ã€‚</p><p>ç®€å•æ¥è¯´ï¼ŒSidecarSet å°† sidecar å®¹å™¨çš„å®šä¹‰å’Œç”Ÿå‘½å‘¨æœŸä¸ä¸šåŠ¡å®¹å™¨è§£è€¦ã€‚
å®ƒä¸»è¦ç”¨äºç®¡ç†æ— çŠ¶æ€çš„ sidecar å®¹å™¨ï¼Œæ¯”å¦‚ç›‘æ§ã€æ—¥å¿—ç­‰ agentã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="èŒƒä¾‹"></a>èŒƒä¾‹<a class="hash-link" href="#èŒƒä¾‹" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="åˆ›å»º-sidecarset"></a>åˆ›å»º SidecarSet<a class="hash-link" href="#åˆ›å»º-sidecarset" title="Direct link to heading">#</a></h3><p>å¦‚ä¸‹çš„ sidecarset.yaml å®šä¹‰äº†ä¸€ä¸ª SidecarSetï¼Œå…¶ä¸­åŒ…æ‹¬äº†ä¸€ä¸ªåä¸º sidecar1 çš„ sidecar å®¹å™¨ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># sidecarset.yaml</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SidecarSet</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sidecarset</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RollingUpdate</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxUnavailable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecar1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> centos</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">6.7</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sleep&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;999d&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># do nothing at all</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> log</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/log</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># this field will be merged into pod.spec.volumes</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> log</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">emptyDir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>åˆ›å»ºè¿™ä¸ª YAML:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f sidecarset.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="åˆ›å»º-pod"></a>åˆ›å»º Pod<a class="hash-link" href="#åˆ›å»º-pod" title="Direct link to heading">#</a></h3><p>å®šä¹‰ä¸€ä¸ªåŒ¹é… SidecarSet selector çš„ Podï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx </span><span class="token comment" style="color:#999988;font-style:italic"># matches the SidecarSet&#x27;s selector</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pod</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">1.15.1</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>åˆ›å»ºè¿™ä¸ª Podï¼Œä½ ä¼šå‘ç°å…¶ä¸­è¢«æ³¨å…¥äº† sidecar1 å®¹å™¨ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pod</span></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME       READY   STATUS    RESTARTS   AGE</span></span><span class="token-line" style="color:#393A34"><span class="token plain">test-pod   </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">/2     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          118s</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>æ­¤æ—¶ï¼ŒSidecarSet status è¢«æ›´æ–°ä¸ºï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get sidecarset test-sidecarset -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> -A4 status</span></span><span class="token-line" style="color:#393A34"><span class="token plain">status:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  matchedPods: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  observedGeneration: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  readyPods: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  updatedPods: </span><span class="token number" style="color:#36acaa">1</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="æ›´æ–°sidecar-container-image"></a>æ›´æ–°sidecar container Image<a class="hash-link" href="#æ›´æ–°sidecar-container-image" title="Direct link to heading">#</a></h3><p>æ›´æ–°sidecarSetä¸­sidecar containerçš„image=centos:7</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl edit sidecarsets test-sidecarset</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># sidecarset.yaml</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps.kruise.io/v1alpha1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: SidecarSet</span></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: test-sidecarset</span></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  containers:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: sidecar1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      image: centos:7</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>æ­¤æ—¶ï¼Œå‘ç°podä¸­çš„sidecarå®¹å™¨å·²ç»è¢«æ›´æ–°ä¸ºäº†centos:7ï¼Œå¹¶ä¸”podä»¥åŠå…¶å®ƒçš„å®¹å™¨æ²¡æœ‰é‡å¯ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods </span><span class="token operator" style="color:#393A34">|</span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> test-pod</span></span><span class="token-line" style="color:#393A34"><span class="token plain">test-pod                            </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">/2     Running   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">          7m34s</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods test-pod -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;image: centos&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    image: centos:7</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl describe pods test-pod</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Events:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Type    Reason     Age                 From               Message</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ----    ------     ----                ----               -------</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Killing    5m47s               kubelet            Container sidecar1 definition changed, will be restarted</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Pulling    5m17s               kubelet            Pulling image </span><span class="token string" style="color:#e3116c">&quot;centos:7&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Created    5m5s </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x2 over 12m</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  kubelet            Created container sidecar1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Started    5m5s </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x2 over 12m</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  kubelet            Started container sidecar1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Pulled     5m5s                kubelet            Successfully pulled image </span><span class="token string" style="color:#e3116c">&quot;centos:7&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="sidecarsetåŠŸèƒ½è¯´æ˜"></a>SidecarSetåŠŸèƒ½è¯´æ˜<a class="hash-link" href="#sidecarsetåŠŸèƒ½è¯´æ˜" title="Direct link to heading">#</a></h2><p>ä¸€ä¸ªç®€å•çš„ SidecarSet yaml æ–‡ä»¶å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SidecarSet</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecarset</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sample</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">alpine</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">initContainers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> init</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">container</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> busybox</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/bin/sh&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sleep 5 &amp;&amp; echo &#x27;init container success&#x27;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RollingUpdate</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ns</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>spec.selector é€šè¿‡labelçš„æ–¹å¼é€‰æ‹©éœ€è¦æ³¨å…¥ã€æ›´æ–°çš„podï¼Œæ”¯æŒmatchLabelsã€MatchExpressionsä¸¤ç§æ–¹å¼ï¼Œè¯¦æƒ…è¯·å‚è€ƒï¼š<a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/</a></li><li>spec.containers å®šä¹‰éœ€è¦æ³¨å…¥ã€æ›´æ–°çš„pod.spec.containerså®¹å™¨ï¼Œæ”¯æŒå®Œæ•´çš„k8s containerå­—æ®µï¼Œè¯¦æƒ…è¯·å‚è€ƒï¼š<a href="https://kubernetes.io/docs/concepts/containers/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/concepts/containers/</a></li><li>spec.initContainers å®šä¹‰éœ€è¦æ³¨å…¥çš„pod.spec.initContainerså®¹å™¨ï¼Œæ”¯æŒå®Œæ•´çš„k8s initContainerå­—æ®µï¼Œè¯¦æƒ…è¯·å‚è€ƒï¼š<a href="https://kubernetes.io/docs/concepts/workloads/pods/init-containers/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/concepts/workloads/pods/init-containers/</a><ul><li>æ³¨å…¥initContainerså®¹å™¨é»˜è®¤åŸºäºcontainer nameå‡çº§æ’åº</li><li>initContainersåªæ”¯æŒæ³¨å…¥ï¼Œä¸æ”¯æŒpodåŸåœ°å‡çº§</li></ul></li><li>spec.updateStrategy sidecarSetæ›´æ–°ç­–ç•¥ï¼Œtypeè¡¨æ˜å‡çº§æ–¹å¼ï¼š<ul><li>NotUpdate ä¸æ›´æ–°ï¼Œæ­¤æ¨¡å¼ä¸‹åªä¼šåŒ…å«æ³¨å…¥èƒ½åŠ›</li><li>RollingUpdate æ³¨å…¥+æ»šåŠ¨æ›´æ–°ï¼ŒåŒ…å«äº†ä¸°å¯Œçš„æ»šåŠ¨æ›´æ–°ç­–ç•¥ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»</li></ul></li><li>spec.namespace sidecarseté»˜è®¤åœ¨k8sæ•´ä¸ªé›†ç¾¤èŒƒå›´å†…ç”Ÿæ•ˆï¼Œå³å¯¹æ‰€æœ‰çš„å‘½åç©ºé—´ç”Ÿæ•ˆï¼ˆé™¤äº†kube-system, kube-publicï¼‰ï¼Œå½“è®¾ç½®è¯¥å­—æ®µæ—¶ï¼Œåªå¯¹è¯¥namespaceçš„podç”Ÿæ•ˆ</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="sidecar-containeræ³¨å…¥"></a>sidecar containeræ³¨å…¥<a class="hash-link" href="#sidecar-containeræ³¨å…¥" title="Direct link to heading">#</a></h3><p>sidecar çš„æ³¨å…¥åªä¼šå‘ç”Ÿåœ¨ Pod åˆ›å»ºé˜¶æ®µï¼Œå¹¶ä¸”åªæœ‰ Pod spec ä¼šè¢«æ›´æ–°ï¼Œä¸ä¼šå½±å“ Pod æ‰€å±çš„ workload template æ¨¡æ¿ã€‚
spec.containersé™¤äº†é»˜è®¤çš„k8s containerå­—æ®µï¼Œè¿˜æ‰©å±•äº†å¦‚ä¸‹ä¸€äº›å­—æ®µï¼Œæ¥æ–¹ä¾¿æ³¨å…¥ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SidecarSet</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecarset</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sample</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># default K8s Container fields</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">alpine</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /nginx/conf</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx.conf</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># extended sidecar container fields</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">podInjectPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> BeforeAppContainer</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">shareVolumePolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> disabled </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> enabled</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">transferEnv</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">sourceContainerName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> main</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">envName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PROXY_IP    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx.conf</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">hostPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /data/nginx/conf</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>podInjectPolicy å®šä¹‰containeræ³¨å…¥åˆ°pod.spec.containersä¸­çš„ä½ç½®<ul><li>BeforeAppContainer(é»˜è®¤) æ³¨å…¥åˆ°podåŸcontainersçš„å‰é¢</li><li>AfterAppContainer æ³¨å…¥åˆ°podåŸcontainersçš„åé¢</li></ul></li><li>æ•°æ®å·å…±äº«<ul><li>å…±äº«æŒ‡å®šå·ï¼šé€šè¿‡ spec.volumes æ¥å®šä¹‰ sidecar è‡ªèº«éœ€è¦çš„ volumeï¼Œè¯¦æƒ…è¯·å‚è€ƒï¼š<a href="https://kubernetes.io/docs/concepts/storage/volumes/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/concepts/storage/volumes/</a></li><li>å…±äº«æ‰€æœ‰å·ï¼šé€šè¿‡ spec.containers[i].shareVolumePolicy.type = enabled | disabled æ¥æ§åˆ¶æ˜¯å¦æŒ‚è½½podåº”ç”¨å®¹å™¨çš„å·ï¼Œå¸¸ç”¨äºæ—¥å¿—æ”¶é›†ç­‰ sidecarï¼Œé…ç½®ä¸º enabled åä¼šæŠŠåº”ç”¨å®¹å™¨ä¸­æ‰€æœ‰æŒ‚è½½ç‚¹æ³¨å…¥ sidecar åŒä¸€è·¯ç»ä¸‹(sidecarä¸­æœ¬èº«å°±æœ‰å£°æ˜çš„æ•°æ®å·å’ŒæŒ‚è½½ç‚¹é™¤å¤–ï¼‰</li></ul></li><li>ç¯å¢ƒå˜é‡å…±äº«<ul><li>å¯ä»¥é€šè¿‡ spec.containers[i].transferEnv æ¥ä»åˆ«çš„å®¹å™¨è·å–ç¯å¢ƒå˜é‡ï¼Œä¼šæŠŠåä¸º sourceContainerName å®¹å™¨ä¸­åä¸º envName çš„ç¯å¢ƒå˜é‡æ‹·è´åˆ°æœ¬å®¹å™¨</li></ul></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="æ³¨å…¥æš‚åœ"></a>æ³¨å…¥æš‚åœ<a class="hash-link" href="#æ³¨å…¥æš‚åœ" title="Direct link to heading">#</a></h4><p><strong>FEATURE STATE:</strong> Kruise v0.10.0</p><p>å¯¹äºå·²ç»åˆ›å»ºçš„ SidecarSetï¼Œå¯é€šè¿‡è®¾ç½® <code>spec.injectionStrategy.paused=true</code> å®ç°sidecar containerçš„æš‚åœæ³¨å…¥ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SidecarSet</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecarset</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">injectionStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paused</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>ä¸Šè¿°æ–¹æ³•åªä½œç”¨äºæ–°åˆ›å»ºçš„ Podï¼Œå¯¹äºå·²æ³¨å…¥ Pod çš„å­˜é‡ sidecar container ä¸äº§ç”Ÿä»»ä½•å½±å“ã€‚</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="imagepullsecrets"></a>imagePullSecrets<a class="hash-link" href="#imagepullsecrets" title="Direct link to heading">#</a></h4><p><strong>FEATURE STATE:</strong> Kruise v0.10.0</p><p>SidecarSet å¯ä»¥é€šè¿‡é…ç½® spec.imagePullSecretsï¼Œæ¥é…åˆ <a href="https://kubernetes.io/zh/docs/concepts/configuration/secret/" target="_blank" rel="noopener noreferrer">Secret</a> æ‹‰å–ç§æœ‰ sidecar é•œåƒã€‚å…¶å®ç°åŸç†ä¸º: å½“sidecaræ³¨å…¥æ—¶ï¼ŒSidecarSet ä¼šå°†å…¶ spec.imagePullSecrets æ³¨å…¥åˆ°<a href="https://kubernetes.io/zh/docs/tasks/configure-pod-container/pull-image-private-registry/" target="_blank" rel="noopener noreferrer"> Pod çš„ spec.imagePullSecrets</a>ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SidecarSet</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecarset</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">imagePullSecrets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œ<strong>å¯¹äºéœ€è¦æ‹‰å–ç§æœ‰ sidecar é•œåƒçš„ Podï¼Œç”¨æˆ·å¿…éœ€ç¡®ä¿è¿™äº› Pod æ‰€åœ¨çš„å‘½åç©ºé—´ä¸­å·²å­˜åœ¨å¯¹åº”çš„ Secret</strong>ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ‹‰å–ç§æœ‰é•œåƒå¤±è´¥ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="sidecaræ›´æ–°ç­–ç•¥"></a>sidecaræ›´æ–°ç­–ç•¥<a class="hash-link" href="#sidecaræ›´æ–°ç­–ç•¥" title="Direct link to heading">#</a></h3><p>SidecarSetä¸ä»…æ”¯æŒsidecarå®¹å™¨çš„åŸåœ°å‡çº§ï¼Œè€Œä¸”æä¾›äº†éå¸¸ä¸°å¯Œçš„å‡çº§ã€ç°åº¦ç­–ç•¥ã€‚</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="åˆ†æ‰¹å‘å¸ƒ"></a>åˆ†æ‰¹å‘å¸ƒ<a class="hash-link" href="#åˆ†æ‰¹å‘å¸ƒ" title="Direct link to heading">#</a></h4><p>Partition çš„è¯­ä¹‰æ˜¯ <strong>ä¿ç•™æ—§ç‰ˆæœ¬ Pod çš„æ•°é‡æˆ–ç™¾åˆ†æ¯”</strong>ï¼Œé»˜è®¤ä¸º <code>0</code>ã€‚è¿™é‡Œçš„ <code>partition</code> ä¸è¡¨ç¤ºä»»ä½• <code>order</code> åºå·ã€‚</p><p>å¦‚æœåœ¨å‘å¸ƒè¿‡ç¨‹ä¸­è®¾ç½®äº† <code>partition</code>:</p><ul><li>å¦‚æœæ˜¯æ•°å­—ï¼Œæ§åˆ¶å™¨ä¼šå°† <code>(replicas - partition)</code> æ•°é‡çš„ Pod æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚</li><li>å¦‚æœæ˜¯ç™¾åˆ†æ¯”ï¼Œæ§åˆ¶å™¨ä¼šå°† <code>(replicas * (100% - partition))</code> æ•°é‡çš„ Pod æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SidecarSet</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecarset</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RollingUpdate</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">partition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">90</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>å‡è®¾è¯¥SidecarSetå…³è”çš„podæ•°é‡æ˜¯100ä¸ªï¼Œåˆ™æœ¬æ¬¡å‡çº§åªä¼šå‡çº§10ä¸ªï¼Œä¿ç•™90ä¸ªã€‚</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="æœ€å¤§ä¸å¯ç”¨æ•°é‡"></a>æœ€å¤§ä¸å¯ç”¨æ•°é‡<a class="hash-link" href="#æœ€å¤§ä¸å¯ç”¨æ•°é‡" title="Direct link to heading">#</a></h4><p>MaxUnavailable æ˜¯å‘å¸ƒè¿‡ç¨‹ä¸­ä¿è¯çš„ï¼ŒåŒä¸€æ—¶é—´ä¸‹æœ€å¤§ä¸å¯ç”¨çš„ Pod æ•°é‡ï¼Œé»˜è®¤å€¼ä¸º 1ã€‚ç”¨æˆ·å¯ä»¥å°†å…¶è®¾ç½®ä¸ºç»å¯¹å€¼æˆ–ç™¾åˆ†æ¯”ï¼ˆç™¾åˆ†æ¯”ä¼šè¢«æ§åˆ¶å™¨æŒ‰ç…§selected podåšåŸºæ•°æ¥è®¡ç®—å‡ºä¸€ä¸ªèƒŒåçš„ç»å¯¹å€¼ï¼‰ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SidecarSet</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecarset</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RollingUpdate</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxUnavailable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 20%</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>æ³¨æ„ï¼ŒmaxUnavailable å’Œ partition ä¸¤ä¸ªå€¼æ˜¯æ²¡æœ‰å¿…ç„¶å…³è”ã€‚ä¸¾ä¾‹ï¼š</p><ul><li>å½“ {matched pod}=100,partition=50,maxUnavailable=10ï¼Œæ§åˆ¶å™¨ä¼šå‘å¸ƒ 50 ä¸ª Pod åˆ°æ–°ç‰ˆæœ¬ï¼Œä½†æ˜¯å‘å¸ƒçª—å£ä¸º 10ï¼Œå³åŒä¸€æ—¶é—´åªä¼šå‘å¸ƒ 10 ä¸ª Podï¼Œæ¯å‘å¸ƒå¥½ä¸€ä¸ª Pod æ‰ä¼šå†æ‰¾ä¸€ä¸ªå‘å¸ƒï¼Œç›´åˆ° 50 ä¸ªå‘å¸ƒå®Œæˆã€‚</li><li>å½“ {matched pod}=100,partition=80,maxUnavailable=30ï¼Œæ§åˆ¶å™¨ä¼šå‘å¸ƒ 20 ä¸ª Pod åˆ°æ–°ç‰ˆæœ¬ï¼Œå› ä¸ºæ»¡è¶³ maxUnavailable æ•°é‡ï¼Œæ‰€ä»¥è¿™ 20 ä¸ª Pod ä¼šåŒæ—¶å‘å¸ƒã€‚</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="æ›´æ–°æš‚åœ"></a>æ›´æ–°æš‚åœ<a class="hash-link" href="#æ›´æ–°æš‚åœ" title="Direct link to heading">#</a></h4><p>ç”¨æˆ·å¯ä»¥é€šè¿‡è®¾ç½® paused ä¸º true æš‚åœå‘å¸ƒï¼Œæ­¤æ—¶å¯¹äºæ–°åˆ›å»ºçš„ã€æ‰©å®¹çš„podä¾æ—§ä¼šå®ç°æ³¨å…¥èƒ½åŠ›ï¼Œå·²ç»æ›´æ–°çš„podä¼šä¿æŒæ›´æ–°åçš„ç‰ˆæœ¬ä¸åŠ¨ï¼Œè¿˜æ²¡æœ‰æ›´æ–°çš„podä¼šæš‚åœæ›´æ–°ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SidecarSet</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecarset</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RollingUpdate</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paused</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="é‡‘ä¸é›€å‘å¸ƒ"></a>é‡‘ä¸é›€å‘å¸ƒ<a class="hash-link" href="#é‡‘ä¸é›€å‘å¸ƒ" title="Direct link to heading">#</a></h4><p>å¯¹äºæœ‰é‡‘ä¸é›€å‘å¸ƒéœ€æ±‚çš„ä¸šåŠ¡ï¼Œå¯ä»¥é€šè¿‡strategy.selectoræ¥å®ç°ã€‚æ–¹å¼ï¼šå¯¹äºéœ€è¦ç‡å…ˆé‡‘ä¸é›€ç°åº¦çš„podæ‰“ä¸Šå›ºå®šçš„labels[canary.release] = trueï¼Œå†é€šè¿‡strategy.selector.matchLabelsæ¥é€‰ä¸­è¯¥pod</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SidecarSet</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecarset</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RollingUpdate</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">canary.release</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="å‘å¸ƒé¡ºåºæ§åˆ¶"></a>å‘å¸ƒé¡ºåºæ§åˆ¶<a class="hash-link" href="#å‘å¸ƒé¡ºåºæ§åˆ¶" title="Direct link to heading">#</a></h3><ul><li>é»˜è®¤å¯¹å‡çº§çš„podæ’åºï¼Œä¿è¯å¤šæ¬¡å‡çº§çš„é¡ºåºä¸€è‡´</li><li>é»˜è®¤é€‰æ‹©ä¼˜å…ˆé¡ºåºæ˜¯ï¼ˆè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰ï¼š unscheduled &lt; scheduled, pending &lt; unknown &lt; running, not-ready &lt; ready, newer pods &lt; older pods</li><li>scatteræ‰“æ•£æ’åº</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="scatteræ‰“æ•£é¡ºåº"></a>scatteræ‰“æ•£é¡ºåº<a class="hash-link" href="#scatteræ‰“æ•£é¡ºåº" title="Direct link to heading">#</a></h4><p>æ‰“æ•£ç­–ç•¥å…è®¸ç”¨æˆ·å®šä¹‰å°†ç¬¦åˆæŸäº›æ ‡ç­¾çš„ Pod æ‰“æ•£åˆ°æ•´ä¸ªå‘å¸ƒè¿‡ç¨‹ä¸­ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ª SidecarSetæ‰€ç®¡ç†çš„podä¸º10ï¼Œå¦‚æœä¸‹é¢æœ‰ 3 ä¸ª Pod å¸¦æœ‰ foo=bar æ ‡ç­¾ï¼Œä¸”ç”¨æˆ·åœ¨æ‰“æ•£ç­–ç•¥ä¸­è®¾ç½®äº†è¿™ä¸ªæ ‡ç­¾ï¼Œé‚£ä¹ˆè¿™ 3 ä¸ª Pod ä¼šè¢«æ”¾åœ¨ç¬¬ 1ã€6ã€10 ä¸ªä½ç½®å‘å¸ƒã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SidecarSet</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecarset</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RollingUpdate</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">scatterStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> foo</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bar</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>æ³¨æ„ï¼šå¦‚æœä½¿ç”¨ scatter ç­–ç•¥ï¼Œå»ºè®®åªè®¾ç½®ä¸€å¯¹ key-value åšæ‰“æ•£ï¼Œä¼šæ¯”è¾ƒå¥½ç†è§£ã€‚</strong></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="sidecarçƒ­å‡çº§ç‰¹æ€§"></a>Sidecarçƒ­å‡çº§ç‰¹æ€§<a class="hash-link" href="#sidecarçƒ­å‡çº§ç‰¹æ€§" title="Direct link to heading">#</a></h3><p><strong>FEATURE STATE:</strong> Kruise v0.9.0</p><p>SidecarSetåŸåœ°å‡çº§ä¼šå…ˆåœæ­¢æ—§ç‰ˆæœ¬çš„å®¹å™¨ï¼Œç„¶ååˆ›å»ºæ–°ç‰ˆæœ¬çš„å®¹å™¨ã€‚è¿™ç§æ–¹å¼æ›´åŠ é€‚åˆä¸å½±å“PodæœåŠ¡å¯ç”¨æ€§çš„sidecarå®¹å™¨ï¼Œæ¯”å¦‚è¯´ï¼šæ—¥å¿—æ”¶é›†Agentã€‚</p><p>ä½†æ˜¯å¯¹äºå¾ˆå¤šä»£ç†æˆ–è¿è¡Œæ—¶çš„sidecarå®¹å™¨ï¼Œä¾‹å¦‚Istio Envoyï¼Œè¿™ç§å‡çº§æ–¹æ³•å°±æœ‰é—®é¢˜äº†ã€‚Envoyä½œä¸ºPodä¸­çš„ä¸€ä¸ªä»£ç†å®¹å™¨ï¼Œä»£ç†äº†æ‰€æœ‰çš„æµé‡ï¼Œå¦‚æœç›´æ¥é‡å¯ï¼ŒPodæœåŠ¡çš„å¯ç”¨æ€§ä¼šå—åˆ°å½±å“ã€‚å¦‚æœéœ€è¦å•ç‹¬å‡çº§envoy sidecarï¼Œå°±éœ€è¦å¤æ‚çš„graceç»ˆæ­¢å’Œåè°ƒæœºåˆ¶ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸ºè¿™ç§sidecarå®¹å™¨çš„å‡çº§æä¾›äº†ä¸€ç§æ–°çš„è§£å†³æ–¹æ¡ˆã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SidecarSet</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hotupgrade</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sidecarset</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hotupgrade</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sidecar</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> openkruise/hotupgrade</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sample</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">sidecarv1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Always</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">lifecycle</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">postStart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">exec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /bin/sh</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /migrate.sh</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">upgradeStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">upgradeType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> HotUpgrade</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">hotUpgradeEmptyImage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> openkruise/hotupgrade</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sample</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">empty</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>upgradeType: HotUpgradeä»£è¡¨è¯¥sidecarå®¹å™¨çš„ç±»å‹æ˜¯hot upgradeï¼Œå°†æ‰§è¡Œçƒ­å‡çº§æ–¹æ¡ˆ</li><li>hotUpgradeEmptyImage: å½“çƒ­å‡çº§sidecarå®¹å™¨æ—¶ï¼Œä¸šåŠ¡å¿…é¡»è¦æä¾›ä¸€ä¸ªemptyå®¹å™¨ç”¨äºçƒ­å‡çº§è¿‡ç¨‹ä¸­çš„å®¹å™¨åˆ‡æ¢ã€‚emptyå®¹å™¨åŒsidecarå®¹å™¨å…·æœ‰ç›¸åŒçš„é…ç½®ï¼ˆé™¤äº†é•œåƒåœ°å€ï¼‰ï¼Œä¾‹å¦‚ï¼šcommand, lifecycle, probeç­‰ï¼Œä½†æ˜¯å®ƒä¸åšä»»ä½•å·¥ä½œã€‚</li><li>lifecycle.postStart: çŠ¶æ€è¿ç§»ï¼Œè¯¥è¿‡ç¨‹å®Œæˆçƒ­å‡çº§è¿‡ç¨‹ä¸­çš„çŠ¶æ€è¿ç§»ï¼Œè¯¥è„šæœ¬éœ€è¦ç”±ä¸šåŠ¡æ ¹æ®è‡ªèº«çš„ç‰¹ç‚¹è‡ªè¡Œå®ç°ï¼Œä¾‹å¦‚ï¼šnginxçƒ­å‡çº§éœ€è¦å®ŒæˆListen FDå…±äº«ä»¥åŠæµé‡æ’æ°´ï¼ˆreloadï¼‰</li></ul><p>çƒ­å‡çº§ç‰¹æ€§æ€»å…±åŒ…å«ä»¥ä¸‹ä¸¤ä¸ªè¿‡ç¨‹ï¼š</p><ol><li>Podåˆ›å»ºæ—¶ï¼Œæ³¨å…¥çƒ­å‡çº§å®¹å™¨</li><li>åŸåœ°å‡çº§æ—¶ï¼Œå®Œæˆçƒ­å‡çº§æµç¨‹</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="æ³¨å…¥çƒ­å‡çº§å®¹å™¨"></a>æ³¨å…¥çƒ­å‡çº§å®¹å™¨<a class="hash-link" href="#æ³¨å…¥çƒ­å‡çº§å®¹å™¨" title="Direct link to heading">#</a></h4><p>Podåˆ›å»ºæ—¶ï¼ŒSidecarSet Webhookå°†ä¼šæ³¨å…¥ä¸¤ä¸ªå®¹å™¨ï¼š</p><ol><li>{sidecarContainer.name}-1: å¦‚ä¸‹å›¾æ‰€ç¤º envoy-1ï¼Œè¿™ä¸ªå®¹å™¨ä»£è¡¨æ­£åœ¨å®é™…å·¥ä½œçš„sidecarå®¹å™¨ï¼Œä¾‹å¦‚ï¼šenvoy:1.16.0</li><li>{sidecarContainer.name}-2: å¦‚ä¸‹å›¾æ‰€ç¤º envoy-2ï¼Œè¿™ä¸ªå®¹å™¨æ˜¯ä¸šåŠ¡é…ç½®çš„hotUpgradeEmptyImageå®¹å™¨ï¼Œä¾‹å¦‚ï¼šempty:1.0ï¼Œç”¨äºåé¢çš„çƒ­å‡çº§æœºåˆ¶</li></ol><p><img alt="sidecarset hotupgrade_injection" src="/zh/assets/images/sidecarset_hotupgrade_injection-bc68babcd84165fd3561dd2d4f5f8d9d.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="çƒ­å‡çº§æµç¨‹"></a>çƒ­å‡çº§æµç¨‹<a class="hash-link" href="#çƒ­å‡çº§æµç¨‹" title="Direct link to heading">#</a></h4><p>çƒ­å‡çº§æµç¨‹ä¸»è¦åˆ†ä¸ºä¸€ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š</p><ol><li>Upgrade: å°†emptyå®¹å™¨å‡çº§ä¸ºå½“å‰æœ€æ–°çš„sidecarå®¹å™¨ï¼Œä¾‹å¦‚ï¼šenvoy-2.Image = envoy:1.17.0</li><li>Migration: lifecycle.postStartå®Œæˆçƒ­å‡çº§æµç¨‹ä¸­çš„çŠ¶æ€è¿ç§»ï¼Œå½“è¿ç§»å®Œæˆåé€€å‡º</li><li>Reset: çŠ¶æ€è¿ç§»å®Œæˆåï¼Œçƒ­å‡çº§æµç¨‹å°†è®¾ç½®envoy-1å®¹å™¨ä¸ºemptyé•œåƒï¼Œä¾‹å¦‚ï¼šenvoy-1.Image = empty:1.0</li></ol><p>ä¸Šè¿°ä¸‰ä¸ªæ­¥éª¤å®Œæˆäº†çƒ­å‡çº§ä¸­çš„å…¨éƒ¨æµç¨‹ï¼Œå½“å¯¹Podæ‰§è¡Œå¤šæ¬¡çƒ­å‡çº§æ—¶ï¼Œå°†é‡å¤æ€§çš„æ‰§è¡Œä¸Šè¿°ä¸‰ä¸ªæ­¥éª¤ã€‚</p><p><img alt="sidecarset hotupgrade" src="/zh/assets/images/sidecarset_hotupgrade-8f7325ba1f999667c60bea6d6aec32f9.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="migration-demo"></a>Migration Demo<a class="hash-link" href="#migration-demo" title="Direct link to heading">#</a></h4><p>SidecarSetçƒ­å‡çº§æœºåˆ¶ä¸ä»…å®Œæˆäº†meshå®¹å™¨çš„åˆ‡æ¢ï¼Œå¹¶ä¸”æä¾›äº†æ–°è€ç‰ˆæœ¬çš„åè°ƒæœºåˆ¶ï¼ˆPostStartHookï¼‰ï¼Œä½†æ˜¯è‡³æ­¤è¿˜åªæ˜¯ä¸‡é‡Œé•¿å¾çš„ç¬¬ä¸€æ­¥ï¼ŒMeshå®¹å™¨åŒæ—¶è¿˜éœ€è¦æä¾› PostStartHook è„šæœ¬æ¥å®ŒæˆmeshæœåŠ¡è‡ªèº«çš„å¹³æ»‘å‡çº§ï¼ˆä¸Šè¿°Migrationè¿‡ç¨‹ï¼‰ï¼Œå¦‚ï¼šEnvoyçƒ­é‡å¯ã€Mosnæ— æŸé‡å¯ã€‚
ä¸ºäº†æ–¹ä¾¿å¤§å®¶èƒ½æ›´å¥½çš„ç†è§£Migrationè¿‡ç¨‹ï¼Œåœ¨kruiseä»“åº“ä¸‹é¢æä¾›äº†ä¸€ä¸ªåŒ…å«ä»£ç å’Œé•œåƒçš„demoï¼Œä¾›å¤§å®¶å‚è€ƒï¼š<a href="https://github.com/openkruise/samples/tree/master/hotupgrade" target="_blank" rel="noopener noreferrer">Migration Demo</a></p><p>è®¾è®¡æ–‡æ¡£è¯·å‚è€ƒ: <a href="https://github.com/openkruise/kruise/blob/master/docs/proposals/20210305-sidecarset-hotupgrade.md" target="_blank" rel="noopener noreferrer">proposals sidecarset hot upgrade</a></p><p>å½“å‰å·²çŸ¥çš„åˆ©ç”¨SidecarSetçƒ­å‡çº§æœºåˆ¶çš„æ¡ˆä¾‹ï¼š</p><ul><li><a href="https://help.aliyun.com/document_detail/193804.html" target="_blank" rel="noopener noreferrer">ALIYUN ASM</a> å®ç°äº†Service Meshä¸­æ•°æ®é¢çš„æ— æŸå‡çº§</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="sidecarsetçŠ¶æ€è¯´æ˜"></a>SidecarSetçŠ¶æ€è¯´æ˜<a class="hash-link" href="#sidecarsetçŠ¶æ€è¯´æ˜" title="Direct link to heading">#</a></h3><p>é€šè¿‡sidecarsetåŸåœ°å‡çº§sidecarå®¹å™¨æ—¶ï¼Œå¯ä»¥é€šè¿‡SidecarSet.Statusæ¥è§‚å¯Ÿå‡çº§çš„è¿‡ç¨‹</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># kubectl describe sidecarsets sidecarset-example</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">         sidecarset</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">example</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">Kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">         SidecarSet</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">Status</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Matched Pods</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">         </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># The number of PODs injected and managed by the Sidecarset</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Updated Pods</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">         </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># 5 PODs have been updated to the container version in the latest SidecarSet</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Ready Pods</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">           </span><span class="token number" style="color:#36acaa">8</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># Matched Pods pod.status.condition.Ready = true number</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Updated Ready Pods</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># Updated Pods &amp;&amp; Ready Pods number</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/openkruise/openkruise.io/edit/master/docs/user-manuals/sidecarset.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>ç¼–è¾‘æœ¬é¡µ</a></div><div class="col lastUpdated_13-_"><span class="theme-last-updated">Last updated on <b><time datetime="2021-09-24T07:22:49.000Z">2021/9/24</time></b> by <b>FillZpp</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zh/docs/user-manuals/advancedcronjob"><div class="pagination-nav__sublabel">ä¸Šä¸€ç¯‡</div><div class="pagination-nav__label">Â« AdvancedCronJob</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zh/docs/user-manuals/workloadspread"><div class="pagination-nav__sublabel">ä¸‹ä¸€ç¯‡</div><div class="pagination-nav__label">WorkloadSpread Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#èŒƒä¾‹" class="table-of-contents__link">èŒƒä¾‹</a><ul><li><a href="#åˆ›å»º-sidecarset" class="table-of-contents__link">åˆ›å»º SidecarSet</a></li><li><a href="#åˆ›å»º-pod" class="table-of-contents__link">åˆ›å»º Pod</a></li><li><a href="#æ›´æ–°sidecar-container-image" class="table-of-contents__link">æ›´æ–°sidecar container Image</a></li></ul></li><li><a href="#sidecarsetåŠŸèƒ½è¯´æ˜" class="table-of-contents__link">SidecarSetåŠŸèƒ½è¯´æ˜</a><ul><li><a href="#sidecar-containeræ³¨å…¥" class="table-of-contents__link">sidecar containeræ³¨å…¥</a></li><li><a href="#sidecaræ›´æ–°ç­–ç•¥" class="table-of-contents__link">sidecaræ›´æ–°ç­–ç•¥</a></li><li><a href="#å‘å¸ƒé¡ºåºæ§åˆ¶" class="table-of-contents__link">å‘å¸ƒé¡ºåºæ§åˆ¶</a></li><li><a href="#sidecarçƒ­å‡çº§ç‰¹æ€§" class="table-of-contents__link">Sidecarçƒ­å‡çº§ç‰¹æ€§</a></li><li><a href="#sidecarsetçŠ¶æ€è¯´æ˜" class="table-of-contents__link">SidecarSetçŠ¶æ€è¯´æ˜</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh/docs/installation">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://kubernetes.slack.com/channels/openkruise" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Kubernetes Slack ( #openkruise channel )<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.dingtalk.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>DingTalk (Group ID: 23330762 )<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://shimo.im/docs/gXqmeQOYBehZ4vqo" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Bi-week Meeting (APAC, Chinese)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/openkruise/kruise" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/openkruise/community/blob/master/community-membership.md" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Community Membership<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <br>
        <strong>Â© 2021 The OpenKruise Authors. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/"> Trademark Usage</a> page.</strong></div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.5f3e2d1b.js"></script>
<script src="/zh/assets/js/main.eced9e91.js"></script>
</body>
</html>