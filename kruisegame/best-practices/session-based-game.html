<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-kruisegame docs-version-current docs-doc-page docs-doc-id-best-practices/session-based-game" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Best Practice for Session-Based Games(PvP room) | OpenKruise</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://openkruise.io/kruisegame/best-practices/session-based-game"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-kruisegame-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-kruisegame-current"><meta data-rh="true" property="og:title" content="Best Practice for Session-Based Games(PvP room) | OpenKruise"><meta data-rh="true" name="description" content="Session-based games refer to a type of game where players are gathered in a specific game scenario within a limited time frame. In general, a session is equivalent to a match, and after the match ends, the game relationship between players also ends, and the session terminates as well. Therefore, in the industry, session-based games are commonly understood as &quot;room-based games,&quot; where a room hosts the corresponding game session. These types of games often have the following characteristics:"><meta data-rh="true" property="og:description" content="Session-based games refer to a type of game where players are gathered in a specific game scenario within a limited time frame. In general, a session is equivalent to a match, and after the match ends, the game relationship between players also ends, and the session terminates as well. Therefore, in the industry, session-based games are commonly understood as &quot;room-based games,&quot; where a room hosts the corresponding game session. These types of games often have the following characteristics:"><link data-rh="true" rel="icon" href="/img/openkruise.ico"><link data-rh="true" rel="canonical" href="https://openkruise.io/kruisegame/best-practices/session-based-game"><link data-rh="true" rel="alternate" href="https://openkruise.io/kruisegame/best-practices/session-based-game" hreflang="en"><link data-rh="true" rel="alternate" href="https://openkruise.io/zh/kruisegame/best-practices/session-based-game" hreflang="zh"><link data-rh="true" rel="alternate" href="https://openkruise.io/kruisegame/best-practices/session-based-game" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://FKASWWQYOP-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Best Practice for Session-Based Games(PvP room)","item":"https://openkruise.io/kruisegame/best-practices/session-based-game"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="OpenKruise RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="OpenKruise Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="OpenKruise" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.7a881dd0.css">
<script src="/assets/js/runtime~main.3d06ed7a.js" defer="defer"></script>
<script src="/assets/js/main.d68de8cc.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/openkruise.ico"><link rel="preload" as="image" href="/assets/images/session-based-game-arch-152be05029dfe164f5e02f335d05f3ab.png"><link rel="preload" as="image" href="/assets/images/session-based-game-state-1-cd5e0de44beab5eda274fe6bd1673875.png"><link rel="preload" as="image" href="/assets/images/session-based-game-state-2-1818d91ca3bec39a53aae9123c03875f.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">‚≠êÔ∏è If you like OpenKruise, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/openkruise/kruise">GitHub</a>! ‚≠êÔ∏è</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/openkruise.ico" alt="OpenKruise" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/openkruise.ico" alt="OpenKruise" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OpenKruise</b></a><a class="navbar__item navbar__link" href="/docs">Kruise</a><a class="navbar__item navbar__link" href="/rollouts/introduction">Rollouts</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/kruisegame/introduction">Kruise-Game</a><a class="navbar__item navbar__link" href="/kruiseagents/introduction">Kruise-Agents</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/adopters">Adopters</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs">v1.9</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next">v1.10 üöß</a></li><li><a class="dropdown__link" href="/docs">v1.9</a></li><li><a class="dropdown__link" href="/docs/v1.8">v1.8</a></li><li><a class="dropdown__link" href="/docs/v1.7">v1.7</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/kruisegame/best-practices/session-based-game" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/zh/kruisegame/best-practices/session-based-game" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh">ÁÆÄ‰Ωì‰∏≠Êñá</a></li></ul></div><a href="https://github.com/openkruise/kruise" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/kruisegame/introduction"><span title="Getting Started" class="categoryLinkLabel_W154">Getting Started</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/introduction"><span title="Introduction" class="linkLabel_WmDU">Introduction</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/installation"><span title="Installation" class="linkLabel_WmDU">Installation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/design-concept"><span title="Design Concept" class="linkLabel_WmDU">Design Concept</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/kruisegame/user-manuals/deploy-gameservers"><span title="User Manuals" class="categoryLinkLabel_W154">User Manuals</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/user-manuals/deploy-gameservers"><span title="Deploy Gameservers" class="linkLabel_WmDU">Deploy Gameservers</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/user-manuals/gameserver-state"><span title="State &amp; OpsState" class="linkLabel_WmDU">State &amp; OpsState</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/user-manuals/hot-update"><span title="Hot Update" class="linkLabel_WmDU">Hot Update</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/user-manuals/update-strategy"><span title="Update Strategy" class="linkLabel_WmDU">Update Strategy</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/user-manuals/gameservers-scale"><span title="Gameservers Scale" class="linkLabel_WmDU">Gameservers Scale</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/user-manuals/container-startup-sequence-control"><span title="Startup Sequence Control" class="linkLabel_WmDU">Startup Sequence Control</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/user-manuals/service-qualities"><span title="Service Qualities" class="linkLabel_WmDU">Service Qualities</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/user-manuals/network"><span title="Network" class="linkLabel_WmDU">Network</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/user-manuals/lifecycle"><span title="Custom Lifecycle Management" class="linkLabel_WmDU">Custom Lifecycle Management</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/user-manuals/gameserver-monitor"><span title="GameServer Monitor" class="linkLabel_WmDU">GameServer Monitor</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/user-manuals/game-matchmaking"><span title="Game MatchMaking" class="linkLabel_WmDU">Game MatchMaking</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/user-manuals/game-dashboard"><span title="OKG Dashboard" class="linkLabel_WmDU">OKG Dashboard</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/user-manuals/gameserver-scheduler"><span title="GameServer Schedulers" class="linkLabel_WmDU">GameServer Schedulers</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/user-manuals/crd-field-description"><span title="CRD Field Description" class="linkLabel_WmDU">CRD Field Description</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/user-manuals/faq"><span title="FAQ" class="linkLabel_WmDU">FAQ</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/kruisegame/best-practices/session-based-game"><span title="Best Practices" class="categoryLinkLabel_W154">Best Practices</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/kruisegame/best-practices/session-based-game"><span title="Best Practice for Session-Based Games(PvP room)" class="linkLabel_WmDU">Best Practice for Session-Based Games(PvP room)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/best-practices/pve-game"><span title="Best Practices for Traditional PvE Games" class="linkLabel_WmDU">Best Practices for Traditional PvE Games</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/best-practices/shared-mem"><span title="Best Practice for Shard-Memory of GameServers" class="linkLabel_WmDU">Best Practice for Shard-Memory of GameServers</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/best-practices/gameserver-delivery-management"><span title="Best Practices for Agile Delivery and Operations Management of GameServers" class="linkLabel_WmDU">Best Practices for Agile Delivery and Operations Management of GameServers</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/best-practices/workflow"><span title="Best Practices for Game O&amp;M Workflow" class="linkLabel_WmDU">Best Practices for Game O&amp;M Workflow</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/kruisegame/developer-manuals/contribution"><span title="Developer Manuals" class="categoryLinkLabel_W154">Developer Manuals</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/developer-manuals/contribution"><span title="contribution" class="linkLabel_WmDU">contribution</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/developer-manuals/faq"><span title="FAQ" class="linkLabel_WmDU">FAQ</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/developer-manuals/go-client"><span title="Golang Client" class="linkLabel_WmDU">Golang Client</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/developer-manuals/kruise-game-api"><span title="Kruise Game API" class="linkLabel_WmDU">Kruise Game API</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/kruisegame/blog-video/kubecon-shangyou-20230926"><span title="Blog &amp; Video" class="categoryLinkLabel_W154">Blog &amp; Video</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/blog-video/kubecon-shangyou-20230926"><span title="ShangYou&#x27;s Cloud-Native Practice of GameServers based on OpenKruiseGame" class="linkLabel_WmDU">ShangYou&#x27;s Cloud-Native Practice of GameServers based on OpenKruiseGame</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/blog-video/kubecon-chillyroom-20240823"><span title="The Experience of ChillyRoom Developing &amp; Managing Session-Based Game" class="linkLabel_WmDU">The Experience of ChillyRoom Developing &amp; Managing Session-Based Game</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/blog-video/meetup-guangzhou-20231125"><span title="OpenKruiseGame Supports Game Ops &amp; Management to Improve Efficiency" class="linkLabel_WmDU">OpenKruiseGame Supports Game Ops &amp; Management to Improve Efficiency</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/blog-video/lilith-okg"><span title="Lilith Games&#x27; Path to Cloud Native" class="linkLabel_WmDU">Lilith Games&#x27; Path to Cloud Native</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/blog-video/yahaha-okg"><span title="Yahaha&#x27;s Cloud-Native UE5 Game Practice Powered by OpenKruiseGame" class="linkLabel_WmDU">Yahaha&#x27;s Cloud-Native UE5 Game Practice Powered by OpenKruiseGame</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/blog-video/paomu"><span title="&quot;POPUCOM&quot; allows players around the world to enjoy zero-delay adventure" class="linkLabel_WmDU">&quot;POPUCOM&quot; allows players around the world to enjoy zero-delay adventure</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/blog-video/guanying-20231129"><span title="Upgrading Game Cloud-Native Architecture with OpenKrusieGame" class="linkLabel_WmDU">Upgrading Game Cloud-Native Architecture with OpenKrusieGame</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/blog-video/higress"><span title="Best Practice for Gaming Gateway of Higress √ó OpenKruiseGame" class="linkLabel_WmDU">Best Practice for Gaming Gateway of Higress √ó OpenKruiseGame</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/blog-video/api-gateway-okg"><span title="API Gateway x OKGÔºöThe &quot;last mile&quot; of game connection management" class="linkLabel_WmDU">API Gateway x OKGÔºöThe &quot;last mile&quot; of game connection management</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/blog-video/cloud-forward-okg"><span title="Cloud Forward | Cloud Native Game Solution" class="linkLabel_WmDU">Cloud Forward | Cloud Native Game Solution</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/blog-video/ack-one-okg"><span title="Best Practices for Consistent Delivery of Global Game Services in Multiple Regions" class="linkLabel_WmDU">Best Practices for Consistent Delivery of Global Game Services in Multiple Regions</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/blog-video/okg-911"><span title="911 Technology&#x27;s &quot;Detective Conan&quot; game cloud native architecture implementation practice" class="linkLabel_WmDU">911 Technology&#x27;s &quot;Detective Conan&quot; game cloud native architecture implementation practice</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/blog-video/okg-gsshosting"><span title="GssHosting game hosting platform realizes efficient management in multiple regions" class="linkLabel_WmDU">GssHosting game hosting platform realizes efficient management in multiple regions</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/blog-video/okg-360"><span title="Landing of 360 Game Containerization" class="linkLabel_WmDU">Landing of 360 Game Containerization</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kruisegame/blog-video/gameserver-scale"><span title="Cloud Elasticity: Best Practices for Game Server Auto Scaling" class="linkLabel_WmDU">Cloud Elasticity: Best Practices for Game Server Auto Scaling</span></a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Best Practices</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Best Practice for Session-Based Games(PvP room)</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Best Practice for Session-Based Games(PvP room)</h1></header>
<p>Session-based games refer to a type of game where players are gathered in a specific game scenario within a limited time frame. In general, a session is equivalent to a match, and after the match ends, the game relationship between players also ends, and the session terminates as well. Therefore, in the industry, session-based games are commonly understood as &quot;room-based games,&quot; where a room hosts the corresponding game session. These types of games often have the following characteristics:</p>
<ul>
<li class="">Game time is non-continuous, with distinct start and stop time points.</li>
<li class="">Commonly found in MOBA, FPS games with high latency requirements.</li>
<li class="">At least 2 or more players interacting and battling with each other within a session.</li>
<li class="">During peak and off-peak times, there is a significant difference in the number of matches.</li>
<li class="">Based on these characteristics, an ideal cloud-native architecture diagram for session-based games is as follows:</li>
</ul>
<img src="/assets/images/session-based-game-arch-152be05029dfe164f5e02f335d05f3ab.png" style="width:500px">
<p>It should have the following capabilities:</p>
<ul>
<li class="">Provide direct network connectivity by assigning independent public network access addresses for each room, allowing players to connect directly.</li>
<li class="">Provide game matchmaking functionality to find suitable teammates and opponents for players to form a session match and allocate appropriate game rooms.</li>
<li class="">Provide state management functionality to automate the management of the business state and lifecycle of game rooms.</li>
<li class="">Provide elastic scaling capabilities to automatically request and release infrastructure resources based on peak and off-peak business demands to control costs.</li>
<li class="">Efficient game delivery and operational management with a high degree of automation.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="direct-network-connectivity">Direct Network Connectivity<a href="#direct-network-connectivity" class="hash-link" aria-label="Direct link to Direct Network Connectivity" title="Direct link to Direct Network Connectivity" translate="no">‚Äã</a></h2>
<p>Session-based games require direct network connectivity, and there are usually the following considerations:</p>
<ul>
<li class="">Reduce game latency and enhance player gaming experience.</li>
<li class="">Remove unnecessary gateways or proxies to save resource costs and simplify technical architecture.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="choosing-the-openkruisegame-networking-model">Choosing the OpenKruiseGame Networking Model<a href="#choosing-the-openkruisegame-networking-model" class="hash-link" aria-label="Direct link to Choosing the OpenKruiseGame Networking Model" title="Direct link to Choosing the OpenKruiseGame Networking Model" translate="no">‚Äã</a></h3>
<p>In the era of traditional game operations, game server business and infrastructure were tightly coupled. Often, when developing server-side programs, an additional port allocation manager was required to avoid port conflicts between different rooms on the same machine. In an ideal state, after cloud-native transformation, game developers no longer need to worry about port allocation for game rooms. Room servers can be horizontally scaled, so each room server should have its own public network access address. However, the native service load balancing model in Kubernetes cannot meet this requirement.</p>
<p>OpenKruiseGame (OKG) provides various networking models to automate the management of public network addresses (EIP + port) for room servers. From then on, game developers do not need to worry about network configuration of the infrastructure, and game operators only need to provide simple parameters to efficiently deploy and automate the management of room server networks. In the OKG mode, each room server corresponds to a pod. For session-based games, the currently available networking models include Kubernetes-HostPort, AlibabaCloud-NATGW, AlibabaCloud-SLB, and AlibabaCloud-EIP. Each networking model has its own characteristics and is suitable for different scenarios.</p>
<p><strong>Kubernetes-HostPort:</strong></p>
<p>This model uses the host node&#x27;s EIP + port as the public network address. This mode is suitable for scenarios where pods are densely deployed on nodes. When the number of small room servers is high, and each node hosts multiple pods, this mode fully utilizes the bandwidth of the EIP on that node, thus maximizing the cost savings of EIP resources.</p>
<p><strong>AlibabaCloud-SLB:</strong></p>
<p>This model maps different ports of the same SLB to different room servers, allowing each room server to have an independent public network address. This mode has the simplest configuration and requires very few EIPs. However, note that SLB is limited by the maximum number of backend instances. Each SLB can associate a maximum of 200 room servers. When the number of room servers under GameServerSet is about to exceed 200, additional SLB instances need to be added to meet scaling requirements.</p>
<p><strong>AlibabaCloud-NATGW:</strong></p>
<p>This model automates the management of Dnat mapping rules associated with room servers. Users need to install the ack-extend-network-controller component and configure NAT gateway-related parameters. The NATGW model has greater scalability and flexibility compared to the SLB model, but it is also more complex to configure.</p>
<p><strong>AlibabaCloud-EIP:</strong></p>
<p>This model assigns a separate EIP for each room server pod. This mode consumes more EIPs and is suitable for scenarios where game servers already have a port manager. The exposed port range of the container is the same as the accessed port range, and there is no mapping behavior.</p>
<p>For detailed explanations and examples, refer to the OKG Networking Model documentation.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="obtaining-room-server-network-information">Obtaining Room Server Network Information<a href="#obtaining-room-server-network-information" class="hash-link" aria-label="Direct link to Obtaining Room Server Network Information" title="Direct link to Obtaining Room Server Network Information" translate="no">‚Äã</a></h3>
<p>Once the game rooms have their own independent public network access addresses, the remaining question is how to provide this address to the player&#x27;s client. Generally, session-based games have a matching service role, and the matching service commonly perceives the network address of room servers in two ways: 1) Active retrieval; 2) Room server self-registration and reporting.</p>
<p><strong>Active Retrieval</strong></p>
<p>The matching service actively retrieves the available room servers in the current cluster and obtains their corresponding public network addresses. It selects the appropriate room server and returns it to the client. In this case, the matching service needs to call the Kubernetes API to retrieve the NetworkStatus of the GameServer object. For GameServer CRUD operations, you can refer to the e2e test cases in the official Kruise-Game repository.</p>
<p><strong>Registration and Reporting</strong></p>
<p>Alternatively, the room server business can report its network information. In this case, the network information is passed down to the container using the Kubernetes Downward API mechanism and can be accessed by the business logic within the container. Once the business logic obtains the corresponding address, it can be reported. For specific examples, refer to the documentation.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="game-matching">Game Matching<a href="#game-matching" class="hash-link" aria-label="Direct link to Game Matching" title="Direct link to Game Matching" translate="no">‚Äã</a></h2>
<p>The process of game matching in session-based games can be roughly divided into two stages: 1) Players finding teammates/opponents to form a match; 2) Finding a suitable room server for the match and returning the network address to the players.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="implementing-game-matching-service-with-openmatch">Implementing Game Matching Service with OpenMatch<a href="#implementing-game-matching-service-with-openmatch" class="hash-link" aria-label="Direct link to Implementing Game Matching Service with OpenMatch" title="Direct link to Implementing Game Matching Service with OpenMatch" translate="no">‚Äã</a></h3>
<p>In the open-source community, there are game matching frameworks like Open Match, where users only need to implement the matching logic according to the framework&#x27;s standards.
OKG provides the kruise-game-open-match-director component based on Open Match, which mainly helps implement the second stage of the matching process mentioned above - finding a game server for the match and returning the address.
This way, users only need to focus on the matching logic in the first stage. For a guide on developing matching services using Open Match and OKG, you can watch the Cloud-Native Game series courses.
You can also join the Cloud-Native Game community group (DingTalk ID: 44862615) to participate in discussions or ask questions.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="custom-game-matching-service">Custom Game Matching Service<a href="#custom-game-matching-service" class="hash-link" aria-label="Direct link to Custom Game Matching Service" title="Direct link to Custom Game Matching Service" translate="no">‚Äã</a></h3>
<p>Of course, if there is a custom matching framework/system, you can also integrate it with OKG through simple secondary development.
As mentioned in the section on obtaining network information, there are two ways for the matching service to interact with the room servers: actively retrieving the status and network information of the room servers or having the room servers self-register and report.
However, for the second method, it is important to confirm the status of the corresponding room server before assigning the address to the player&#x27;s client. This is because the retrieval and assignment of network addresses are asynchronous, and there may be situations where the room server is not available during the process.
As for the first method, the recommended approach is to use the Kubernetes Informer mechanism to listen to the GameServer objects. When there is a need to assign a room server for a match, you can retrieve the currently available GameServer and return the corresponding network information.
In this case, the retrieval and assignment of network information are synchronous. For the specific implementation, you can refer to the allocator code in kruise-game-open-match-director.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="state-management">State Management<a href="#state-management" class="hash-link" aria-label="Direct link to State Management" title="Direct link to State Management" translate="no">‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="state-type-for-session-based-games">State Type for Session-Based Games<a href="#state-type-for-session-based-games" class="hash-link" aria-label="Direct link to State Type for Session-Based Games" title="Direct link to State Type for Session-Based Games" translate="no">‚Äã</a></h3>
<p>In the previous section on game matchmaking, we mentioned that the matchmaking service needs to retrieve the status of the game server when assigning the server address to each player&#x27;s client to ensure that the assigned server is available. So, how should we define the availability of a game server? According to the design principles of OKG, an available game server should be = Infrastructure Runtime State Ready + Infrastructure Network Ready + Business State Ready.</p>
<p>What does &quot;Business State Ready&quot; mean? This involves the definition of the server state based on the game&#x27;s requirements. We recommend that the game server business state includes at least the following states:</p>
<p>None (No abnormal or special state exists, indicating availability, and this is the default state after the server initialization)
Allocated (Already assigned, indicating that players are currently or about to play the game)
WaitToBeDeleted (About to be deleted, waiting for OKG to recycle the pod)
These three states can be recorded in the GameServer Spec using OpsState. OKG provides two ways to mark the server state:</p>
<ol>
<li class="">Modifying GameServer.Spec.OpsState directly by calling the Kubernetes API (usually after the matchmaking system assigns the game server, it can be marked as Allocated).</li>
<li class="">Exposing and converting the business state in a container to the corresponding GameServer.Spec.OpsState by <a href="https://openkruise.io/zh/kruisegame/user-manuals/service-qualities" target="_blank" rel="noopener noreferrer" class="">Service Quality</a>.</li>
</ol>
<p>The simplest state transition model is shown in the figure:</p>
<ol>
<li class="">The default state after the room server is pulled up is available. At this time, OpsState is <strong>None</strong></li>
<li class="">When matching requirements are generated, the matching service searches for available (Infrastructure Ready &amp; OpsState is None) room servers, and after allocation, sets its OpsState to <strong>Allocated</strong> (set through Kubernetes API, please refer to <a href="https://github.com/CloudNativeGame/kruise-game-open-match-director/blob/main/pkg/allocator.go" target="_blank" rel="noopener noreferrer" class="">kruise-game -allocator code for open-match-director</a>. Not required if using OKG + Open Match Settings, Director has already done the above work)</li>
<li class="">Setting OpsState as <strong>WaitToBeDeleted</strong> when game over by <a href="https://openkruise.io/zh/kruisegame/user-manuals/service-qualities" target="_blank" rel="noopener noreferrer" class="">Service Quality</a>. ËøôÊ†∑ÂØπÂ∫îÁöÑpodÂ∞ÜË¢´OKGËá™Âä®ËøõË°åÂõûÊî∂Âà†Èô§ÔºåÂêéÁª≠ÂºπÊÄß‰º∏Áº©ÈÉ®ÂàÜÂ∞ÜÂ±ïÂºÄ‰ªãÁªç„ÄÇ</li>
</ol>
<img src="/assets/images/session-based-game-state-1-cd5e0de44beab5eda274fe6bd1673875.png" style="width:150px">
<p>Of course, if you want to start and stop pods less frequently, you can also change OpsState to None after the game. The overall state transformation model is shown in the figure:</p>
<ol>
<li class="">Same as above, the default state after the room server is pulled up is available, at this time OpsState is <strong>None</strong></li>
<li class="">Same as above, after assigning the room server, the matching system will set it to <strong>Allocated</strong></li>
<li class="">When the game ends, set OpsState to <strong>None</strong> through <a href="https://openkruise.io/zh/kruisegame/user-manuals/service-qualities" target="_blank" rel="noopener noreferrer" class="">Customized Service Quality</a></li>
<li class="">When the room server status is judged to be None for a long time through the coroutine, the OpsState will be set to ** through <a href="https://openkruise.io/zh/kruisegame/user-manuals/service-qualities" target="_blank" rel="noopener noreferrer" class="">Customized Service Quality</a> WaitToBeDeleted. **</li>
</ol>
<img src="/assets/images/session-based-game-state-2-1818d91ca3bec39a53aae9123c03875f.png" style="width:200px">
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="reveal-the-status-of-room-service-through-service-quality">Reveal the status of room service through service quality<a href="#reveal-the-status-of-room-service-through-service-quality" class="hash-link" aria-label="Direct link to Reveal the status of room service through service quality" title="Direct link to Reveal the status of room service through service quality" translate="no">‚Äã</a></h3>
<p>After completing the room server state flow design, we will find that some states are determined by the room server business, and these states also need to be exposed to the Kubernetes level so that they can be linked to the automatic scaler, matching system, etc. Therefore, a mechanism is needed to mark the business status on the Kubernetes object, that is, GameServer, and this is the <strong>Customized Service Quality</strong> function.</p>
<p>Customized service quality automatically marks the room server status on the GameServer through the results of <strong>executing the detection script</strong> and the <strong>detection result corresponding status</strong> set by the user.</p>
<p>The following is a status detection script named waitToBeDeleted.sh, which detects whether the value of the GS_STATE environment variable in the container is WaitToBeDeleted.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-z</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$GS_STATE</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$GS_STATE</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;WaitToBeDeleted&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$GS_STATE</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><br></span></code></pre></div></div>
<p>The corresponding GameServerSet yaml should be as follows</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  serviceQualities: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: waitToBeDeleted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containerName: battle </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      permanent: </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      exec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        command: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;bash&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;./waitToBeDeleted.sh&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      serviceQualityAction:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - state: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          opsState: WaitToBeDeleted</span><br></span></code></pre></div></div>
<p>Of course, there can be multiple custom service qualities. For example, when the room server needs to reveal its None status, the script named none.sh is as follows:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-z</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$GS_STATE</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$GS_STATE</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;None&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$GS_STATE</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><br></span></code></pre></div></div>
<p>The corresponding GameServerSet yaml should be as follows:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  serviceQualities: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: waitToBeDeleted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containerName: battle </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      permanent: </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      exec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        command: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;bash&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;./waitToBeDeleted.sh&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      serviceQualityAction:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - state: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          opsState: WaitToBeDeleted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: none</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containerName: battle </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      permanent: </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      exec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        command: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;bash&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;./none.sh&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      serviceQualityAction:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - state: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          opsState: None</span><br></span></code></pre></div></div>
<p>So far, we have found that the room service business program only needs to set the corresponding GS_STATE environment variable value at the appropriate time node. for example:</p>
<ul>
<li class="">When the room server has just been launched, set GS_STATE=None;</li>
<li class="">When a player enters the room server, set GS_STATE=Allocated (although it does not need to be exposed to opsState, you can still make state changes to avoid inconsistency between your own state and what is displayed in Kubernetes);</li>
<li class="">When the room server game ends, set GS_STATE=None;</li>
<li class="">When the room server is idle for a long time, set GS_STATE=WaitToBeDeleted.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="elastic-scaling">Elastic scaling<a href="#elastic-scaling" class="hash-link" aria-label="Direct link to Elastic scaling" title="Direct link to Elastic scaling" translate="no">‚Äã</a></h2>
<p>In the previous section, we designed three room server states: None / Allocated / WaitToBeDeleted. In this section, we will perform corresponding elastic scaling configuration based on the above room server status.</p>
<p>The ideal state for elastic scaling of conversational games is that during peak business periods, the number of room servers is sufficient to allow players to access the game in seconds; during low business periods, the number of room servers is reduced to save resource costs. OKG provides an automatic scaler that can sense the status of the room server and automatically adjust the replicas value of GameServerSet to achieve the ideal effect of scaling according to the game business status.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="room-service-is-automatically-reduced">Room service is automatically reduced<a href="#room-service-is-automatically-reduced" class="hash-link" aria-label="Direct link to Room service is automatically reduced" title="Direct link to Room service is automatically reduced" translate="no">‚Äã</a></h3>
<p>In the state management section, we also mentioned that the GameServer whose opsState is WaitToBeDeleted will be automatically recycled by OKG. In this way, as long as the business decides that it will no longer provide services, it can set WaitToBeDeleted through custom service quality. For specific configuration of the scaling strategy, please refer to [<a href="https://openkruise.io/zh/kruisegame/user-manuals/gameservers-scale#Usage" target="_blank" rel="noopener noreferrer" class="">https://openkruise.io/zh/kruisegame/user-manuals/gameservers-scale#Usage</a> Example](<a href="https://openkruise.io/zh/kruisegame/user-manuals" target="_blank" rel="noopener noreferrer" class="">https://openkruise.io/zh/kruisegame/user-manuals</a> /gameservers-scale#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B)</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="room-service-automatically-added">Room service automatically added<a href="#room-service-automatically-added" class="hash-link" aria-label="Direct link to Room service automatically added" title="Direct link to Room service automatically added" translate="no">‚Äã</a></h3>
<p>OKG&#x27;s core strategy for providing automatic expansion is to ensure that there is an available and sufficient number of room servers. This number is equivalent to buffer and is determined by the user. In OKG, this parameter is called <strong>minAvailable</strong>.</p>
<p>When the current number of game servers with opsState of None is less than the set <strong>minAvailable</strong> value, OKG will automatically expand new game servers so that the number of game servers with opsState of None meets the set minimum number.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="resource-automatic-scaling">Resource automatic scaling<a href="#resource-automatic-scaling" class="hash-link" aria-label="Direct link to Resource automatic scaling" title="Direct link to Resource automatic scaling" translate="no">‚Äã</a></h3>
<p>Kubernetes elastic scaling covers two levels, application layer elasticity and resource layer elasticity. Among them, OKG provides the flexibility of the room server application layer and automatically adjusts the number of pods corresponding to the room server. Only adjusting the number of pods cannot save resource costs. The number of nodes needs to be automatically adjusted. This is how Kubernetes cluster-autoscaler achieves resource layer elasticity. The core principle of cluster-autoscaler is:</p>
<ul>
<li class="">When a pod is in the pending state due to insufficient resources, the node is automatically ejected.</li>
<li class="">Automatically recycle nodes when node utilization is too low/nodes are idle.</li>
</ul>
<p>For game scenarios, the best practices for automatic scaling are as follows:</p>
<ul>
<li class="">
<p>Set OKG <strong>minAvailable</strong> size according to node specifications. The startup of the node takes time, so free and available room servers need to be prepared in advance for players to connect. The idle room server essentially advances the triggering time of node horizontal expansion, making up for the time difference in starting the machine. In this way, the node specification and minAvailable are closely related. For example: the node specification used in the cluster is 8 cores and 16G, and the room service pod running on it requires 1 core and 2G resources, so theoretically the node can Run 7 room servers (nodes will have reserved resources, so not 8). In this case, if minAvailable is set to 7 or more, there will always be an &quot;idle&quot; node in the cluster (idle here does not mean no pods, but no players); if it is set to 14 or more, there will always be an &quot;idle&quot; node in the cluster. With two &quot;idle&quot; nodes, this also converts the <strong>room server spare quantity</strong> into the <strong>node spare quantity</strong>. Users can set specific settings according to business scenarios and cost control perspectives.</p>
</li>
<li class="">
<p>Set the cluster autoscaler to automatically recycle nodes only when the nodes are completely idle to ensure normal game operation. Shrinking based on resource thresholds is not friendly to the game. Since the game is a stateful service, there is a great possibility that the resource load on the node is small but the player is still playing the game, and it cannot be easily deleted.</p>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="game-room-hot-update">Game Room Hot-Update<a href="#game-room-hot-update" class="hash-link" aria-label="Direct link to Game Room Hot-Update" title="Direct link to Game Room Hot-Update" translate="no">‚Äã</a></h2>
<p>In order to smoothly upgrade the room server and simplify operation and maintenance operations, there is often a demand: it is hoped that the room server version can be updated with one click without affecting the player&#x27;s gaming experience and without shutting down the server for maintenance. This process is also called hot update of the room server.
The hot update of the room server is different from the in-place update required by traditional PvE games. Due to the short time of a single game, the service logic of the room is often not changed after the game is started. Instead, the newly opened service logic is opened after the one-click update is released. The rooms use the latest version, and the existing room servers do not make any changes; at the same time, the matching system is used to import new players into the new version of the room; and the automatic scaling mechanism is used to make the number of rooms in the old version continue to decrease as the number of people is lost. The number of rooms in the new version continues to increase as the number of people increases, and the version switch is finally completed.
The entire process only requires changing the room server container image, which is automatically updated without stopping the server, greatly reducing the complexity of operation and maintenance.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="existing-game-rooms-will-not-be-updated">Existing game rooms will not be updated<a href="#existing-game-rooms-will-not-be-updated" class="hash-link" aria-label="Direct link to Existing game rooms will not be updated" title="Direct link to Existing game rooms will not be updated" translate="no">‚Äã</a></h3>
<p>When using the GameServerSet workload, you can select the &quot;OnDelete&quot; update type to achieve the effect of not updating the existing room server, but using the new version for the new room server.</p>
<p>For example, if you initially deploy a GameServerSet with 3 replicas, the image tags are all 1.12.2</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> game.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> GameServerSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> minecraft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">updateStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OnDelete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">gameServerTemplate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> registry.cn</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">hangzhou.aliyuncs.com/acs/minecraft</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">1.12.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> minecraft</span><br></span></code></pre></div></div>
<p>At this time, the image is updated and the image tag is changed to 1.12.2-new</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl edit gss minecraft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  gameServerTemplate:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - image: registry.cn-hangzhou.aliyuncs.com/acs/minecraft-demo:1.12.2-new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: minecraft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre></div></div>
<p>It can be seen that the existing GameServers has not been updated, and the image tag is still 1.12.2</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po </span><span class="token parameter variable" style="color:#36acaa">-oyaml</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> minecraft-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: registry.cn-hangzhou.aliyuncs.com/acs/minecraft-demo:1.12.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      image: registry.cn-hangzhou.aliyuncs.com/acs/minecraft-demo:1.12.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      imageID: registry.cn-hangzhou.aliyuncs.com/acs/minecraft-demo@sha256:8aa4177a19b15d7336162c6ca4d833a74c3cb23d85eab2ef2a63f7a2a682b8fb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: registry.cn-hangzhou.aliyuncs.com/acs/minecraft-demo:1.12.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      image: registry.cn-hangzhou.aliyuncs.com/acs/minecraft-demo:1.12.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      imageID: registry.cn-hangzhou.aliyuncs.com/acs/minecraft-demo@sha256:8aa4177a19b15d7336162c6ca4d833a74c3cb23d85eab2ef2a63f7a2a682b8fb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - image: registry.cn-hangzhou.aliyuncs.com/acs/minecraft-demo:1.12.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      image: registry.cn-hangzhou.aliyuncs.com/acs/minecraft-demo:1.12.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      imageID: registry.cn-hangzhou.aliyuncs.com/acs/minecraft-demo@sha256:8aa4177a19b15d7336162c6ca4d833a74c3cb23d85eab2ef2a63f7a2a682b8fb</span><br></span></code></pre></div></div>
<p>At this time, scale GameServerSet and create a new game server minecraft-3, and find that its image tag is 1.12.2-new</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl scale gss minecraft </span><span class="token parameter variable" style="color:#36acaa">--replicas</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gameserverset.game.kruise.io/minecraft scaled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po minecraft-3 </span><span class="token parameter variable" style="color:#36acaa">-oyaml</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> minecraft-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - image: registry.cn-hangzhou.aliyuncs.com/acs/minecraft-demo:1.12.2-new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image: registry.cn-hangzhou.aliyuncs.com/acs/minecraft-demo:1.12.2-new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    imageID: registry.cn-hangzhou.aliyuncs.com/acs/minecraft-demo@sha256:f68fd7d5e6133c511b374a38f7dbc35acedce1d177dd78fba1d62d6264d5cba0</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="linkage-with-matching-system">Linkage with matching system<a href="#linkage-with-matching-system" class="hash-link" aria-label="Direct link to Linkage with matching system" title="Direct link to Linkage with matching system" translate="no">‚Äã</a></h3>
<p>When a new version of the image exists in the GameServerSet, the matching system needs to decide which version of the room server the player will enter.</p>
<p>There are two ways for the matching system to sense the version under the current workload:</p>
<ol>
<li class="">When the room server is started, its own version will be automatically registered and reported, and it will be de-registered and destructed when deleted.</li>
<li class="">When matching, the matching system calls the Kubernetes API to query the version currently suitable for the player.</li>
</ol>
<p>These two methods are similar to the method of obtaining the room server address mentioned above, and they can be implemented in the same way.
If you press method 1, when the room server is started, the access address information will be reported together with the version information; if you press method 2, additional logic will be added to filter the room server version when searching for a suitable room server.</p>
<p>It should be noted that even if the matching system detects the latest version, it does not allow players to enter only the latest version at this time. Since the version update has just been completed, the number of rooms in the new version is not sufficient. There needs to be a transition period for a certain period of time so that players who cannot find the latest version of the room server can still enter the old version of the game.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="complete-smooth-upgrade-through-automatic-scaling">Complete smooth upgrade through automatic scaling<a href="#complete-smooth-upgrade-through-automatic-scaling" class="hash-link" aria-label="Direct link to Complete smooth upgrade through automatic scaling" title="Direct link to Complete smooth upgrade through automatic scaling" translate="no">‚Äã</a></h3>
<p>When the GameServerSet image version has been updated and the matching system can sense the latest version, we hope that there will be more and more room servers in the new version and fewer and fewer room servers in the old version, and this is achieved through automatic scaling.</p>
<p>First of all, at the beginning of the version switch, only the old version of the room server existed under GameServerSet, and the room server of this version existed in the following states: Allocated, WaitToBeDeleted, and None.
If the Allocated room server changes directly to WaitToBeDeleted after the game ends, the old version of None will first change to Allocated and then to WaitToBeDeleted if there is no increase in players, and then the overall number will gradually decrease over time, and The number of new room servers will continue to increase due to the setting of the minAvailable parameter;
However, if the Allocated room server is reused and changed to None after the game is over, there will be a long period of time when the number of players does not increase. Therefore, it is recommended to manually update the GameServerSet image. Increase the number of copies and directly expand the latest version of the room server. The old version of the room server in the None state will enter the WaitToBeDeleted state due to a long wait for no players to enter, and will eventually be deleted.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2026-02-28T07:50:09.000Z" itemprop="dateModified">Feb 28, 2026</time></b> by <b>Divyanshu Choudhury</b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/kruisegame/user-manuals/faq"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">FAQ</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/kruisegame/best-practices/pve-game"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Best Practices for Traditional PvE Games</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#direct-network-connectivity" class="table-of-contents__link toc-highlight">Direct Network Connectivity</a><ul><li><a href="#choosing-the-openkruisegame-networking-model" class="table-of-contents__link toc-highlight">Choosing the OpenKruiseGame Networking Model</a></li><li><a href="#obtaining-room-server-network-information" class="table-of-contents__link toc-highlight">Obtaining Room Server Network Information</a></li></ul></li><li><a href="#game-matching" class="table-of-contents__link toc-highlight">Game Matching</a><ul><li><a href="#implementing-game-matching-service-with-openmatch" class="table-of-contents__link toc-highlight">Implementing Game Matching Service with OpenMatch</a></li><li><a href="#custom-game-matching-service" class="table-of-contents__link toc-highlight">Custom Game Matching Service</a></li></ul></li><li><a href="#state-management" class="table-of-contents__link toc-highlight">State Management</a><ul><li><a href="#state-type-for-session-based-games" class="table-of-contents__link toc-highlight">State Type for Session-Based Games</a></li><li><a href="#reveal-the-status-of-room-service-through-service-quality" class="table-of-contents__link toc-highlight">Reveal the status of room service through service quality</a></li></ul></li><li><a href="#elastic-scaling" class="table-of-contents__link toc-highlight">Elastic scaling</a><ul><li><a href="#room-service-is-automatically-reduced" class="table-of-contents__link toc-highlight">Room service is automatically reduced</a></li><li><a href="#room-service-automatically-added" class="table-of-contents__link toc-highlight">Room service automatically added</a></li><li><a href="#resource-automatic-scaling" class="table-of-contents__link toc-highlight">Resource automatic scaling</a></li></ul></li><li><a href="#game-room-hot-update" class="table-of-contents__link toc-highlight">Game Room Hot-Update</a><ul><li><a href="#existing-game-rooms-will-not-be-updated" class="table-of-contents__link toc-highlight">Existing game rooms will not be updated</a></li><li><a href="#linkage-with-matching-system" class="table-of-contents__link toc-highlight">Linkage with matching system</a></li><li><a href="#complete-smooth-upgrade-through-automatic-scaling" class="table-of-contents__link toc-highlight">Complete smooth upgrade through automatic scaling</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/installation">Getting Started</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://kubernetes.slack.com/channels/openkruise" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kubernetes Slack ( #openkruise channel )<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/kruisegame/best-practices/">DingTalk (GroupID: 23330762 )</a></li><li class="footer__item"><a class="footer__link-item" href="/kruisegame/best-practices/">WeChat (User: openkruise )</a></li><li class="footer__item"><a href="https://shimo.im/docs/gXqmeQOYBehZ4vqo" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bi-week Meeting (APAC, Chinese)<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/openkruise/kruise" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/openkruise/community/blob/master/community-membership.md" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community Membership<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <br>
        <strong>¬© 2026 The OpenKruise Authors. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/"> Trademark Usage</a> page.</strong></div></div></div></footer></div>
</body>
</html>