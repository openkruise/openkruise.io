"use strict";(globalThis.webpackChunkopenkruise_io=globalThis.webpackChunkopenkruise_io||[]).push([[2269],{28453:(e,n,a)=>{a.d(n,{R:()=>s,x:()=>l});var o=a(96540);const t={},i=o.createContext(t);function s(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),o.createElement(i.Provider,{value:n},e.children)}},40922:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>m,frontMatter:()=>s,metadata:()=>o,toc:()=>r});const o=JSON.parse('{"id":"user-manuals/warmpool-management","title":"Warm Pool Management","description":"This document introduces how to create a warm pool through SandboxSet.","source":"@site/kruiseagents/user-manuals/warmpool-management.md","sourceDirName":"user-manuals","slug":"/user-manuals/warmpool-management","permalink":"/kruiseagents/user-manuals/warmpool-management","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"Divyanshu Choudhury","lastUpdatedAt":1772265009000,"frontMatter":{},"sidebar":"kruiseagents","previous":{"title":"Design Concept","permalink":"/kruiseagents/design-concept"},"next":{"title":"Claiming Sandboxes","permalink":"/kruiseagents/user-manuals/sandbox-claim"}}');var t=a(74848),i=a(28453);const s={},l="Warm Pool Management",d={},r=[{value:"Purpose of Warm Pool",id:"purpose-of-warm-pool",level:2},{value:"Creating Warm Pool via <code>SandboxSet</code>",id:"creating-warm-pool-via-sandboxset",level:2},{value:"Warm Sandbox States",id:"warm-sandbox-states",level:2},{value:"Claiming and Replenishing Warm Sandboxes",id:"claiming-and-replenishing-warm-sandboxes",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"warm-pool-management",children:"Warm Pool Management"})}),"\n",(0,t.jsxs)(n.p,{children:["This document introduces how to create a warm pool through ",(0,t.jsx)(n.code,{children:"SandboxSet"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"purpose-of-warm-pool",children:"Purpose of Warm Pool"}),"\n",(0,t.jsxs)(n.p,{children:["A warm pool is a collection of pre-created ",(0,t.jsx)(n.code,{children:"Sandbox"})," replicas. When an Agent needs to acquire a Sandbox, it can quickly\nobtain one directly from the warm pool, significantly improving the Sandbox delivery efficiency."]}),"\n",(0,t.jsxs)(n.h2,{id:"creating-warm-pool-via-sandboxset",children:["Creating Warm Pool via ",(0,t.jsx)(n.code,{children:"SandboxSet"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"SandboxSet"})," is a workload that manages multiple identical ",(0,t.jsx)(n.code,{children:"Sandbox"})," replicas, similar to ",(0,t.jsx)(n.code,{children:"ReplicaSet"})," in K8s that\nmanages multiple ",(0,t.jsx)(n.code,{children:"Pods"}),". Its features include:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Low-latency scaling specially optimized for high-frequency scaling scenarios"}),"\n",(0,t.jsxs)(n.li,{children:["Serving as a Sandbox template (see ",(0,t.jsx)(n.a,{href:"/kruiseagents/user-manuals/sandbox-claim",children:"Sandbox Claim"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["A typical ",(0,t.jsx)(n.code,{children:"SandboxSet"})," looks like this:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: agents.kruise.io/v1alpha1\nkind: SandboxSet\nmetadata:\n  name: demo\n  namespace: default\nspec:\n  # Size of the warm pool, recommended to be slightly larger than estimated request burst\n  replicas: 10\n  # Content to be preserved during sandbox hibernation and wake-up\n  persistentContents:\n    - ip\n  # Sandbox template, consistent with Sandbox CRD\n  template:\n    # Add metadata for the finally created Pod\n    metadata:\n      annotations:\n        foo: bar\n    # Final Pod Spec\n    spec:\n      containers:\n        - name: nginx\n          image: nginx:alpine\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["The short name for ",(0,t.jsx)(n.code,{children:"SandboxSet"})," is ",(0,t.jsx)(n.code,{children:"sbs"}),", and you can operate this resource through commands like ",(0,t.jsx)(n.code,{children:"kubectl get sbs"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"warm-sandbox-states",children:"Warm Sandbox States"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"SandboxSet"})," adopts a simplified state model for its warm ",(0,t.jsx)(n.code,{children:"Sandbox"}),", containing two states:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"creating"}),": The sandbox is being created. It might be that the Pod is being created, or the Pod has been created but the\nsandbox container has not completed startup. These sandboxes cannot be claimed."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"available"}),": The sandbox is ready and can be claimed at any time."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["You can check the number of sandboxes in available state through the ",(0,t.jsx)(n.code,{children:"status.availableReplicas"})," field, or directly view\nit through the ",(0,t.jsx)(n.code,{children:"kubectl get"})," command:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ kubectl get sbs -n default\nNAME   REPLICAS   AVAILABLE   UPDATEREVISION   AGE\ndemo   10         10          78dd8599cf       19m\n"})}),"\n",(0,t.jsx)(n.h2,{id:"claiming-and-replenishing-warm-sandboxes",children:"Claiming and Replenishing Warm Sandboxes"}),"\n",(0,t.jsxs)(n.p,{children:["You can claim an available sandbox from the warm pool in various ways, refer to ",(0,t.jsx)(n.a,{href:"/kruiseagents/user-manuals/sandbox-claim",children:"Sandbox Claim"}),".\nWhen a sandbox is claimed, ",(0,t.jsx)(n.code,{children:"SandboxSet"})," will immediately scale up to replenish the inventory. The replica count of\n",(0,t.jsx)(n.code,{children:"SandboxSet"})," does not include allocated sandboxes. Here is an example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Stage 1: Initial State - Warm Pool Ready                                    \u2502\n\u2502 SandboxSet: replicas=3, availableReplicas=3                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n    SandboxSet "demo"\n    +-------------------------------------+\n    |  +-----------+  +-----------+       |\n    |  | Sandbox-1 |  | Sandbox-2 |       |\n    |  | available |  | available |       |\n    |  +-----------+  +-----------+       |\n    |                                     |\n    |       +-----------+                 |\n    |       | Sandbox-3 |                 |\n    |       | available |                 |\n    |       +-----------+                 |\n    +-------------------------------------+\n\n\n                        |\n                        | Agent claims a Sandbox\n                        v\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Stage 2: Sandbox Claimed - Scale-up Triggered                               \u2502\n\u2502 SandboxSet: replicas=2, availableReplicas=2                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n    SandboxSet "demo"                      Allocated to Agent\n    +---------------------------------+    +------------------+\n    |  +-----------+  +-----------+   |    |  +-------------+ |\n    |  | Sandbox-2 |  | Sandbox-3 |   |    |  | Sandbox-1   | |\n    |  | available |  | available |   |---\x3e|  | (claimed)   | |\n    |  +-----------+  +-----------+   |    |  +-------------+ |\n    |                                 |    +------------------+\n    |  [!] Replicas shortage detected |\n    |      Starting scale-up...       |\n    +---------------------------------+\n\n\n                        |\n                        | SandboxSet auto-scales\n                        v\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Stage 3: Creating New Sandbox - Restoring Replicas                          \u2502\n\u2502 SandboxSet: replicas=3, availableReplicas=2                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n    SandboxSet "demo"                      Allocated to Agent\n    +---------------------------------+    +------------------+\n    |  +-----------+  +-----------+   |    |  +-------------+ |\n    |  | Sandbox-2 |  | Sandbox-3 |   |    |  | Sandbox-1   | |\n    |  | available |  | available |   |    |  | (claimed)   | |\n    |  +-----------+  +-----------+   |    |  +-------------+ |\n    |                                 |    +------------------+\n    |  . . . . . . . .                |\n    |  . Sandbox-4   . [Pod Starting] |\n    |  . creating    .                |\n    |  . . . . . . . .                |\n    +---------------------------------+\n\n\n                        |\n                        | New Sandbox ready\n                        v\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Stage 4: Warm Pool Restored - Back to Initial State                         \u2502\n\u2502 SandboxSet: replicas=3, availableReplicas=3                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n    SandboxSet "demo"                      Allocated to Agent\n    +---------------------------------+    +------------------+\n    |  +-----------+  +-----------+   |    |  +-------------+ |\n    |  | Sandbox-2 |  | Sandbox-3 |   |    |  | Sandbox-1   | |\n    |  | available |  | available |   |    |  | (claimed)   | |\n    |  +-----------+  +-----------+   |    |  +-------------+ |\n    |                                 |    +------------------+\n    |       +-----------+             |\n    |       | Sandbox-4 |  [Ready]    |\n    |       | available |             |\n    |       +-----------+             |\n    |                                 |\n    |  [OK] Pool replenished          |\n    |       Ready for next claim      |\n    +---------------------------------+\n'})})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}}}]);