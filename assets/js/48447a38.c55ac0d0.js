"use strict";(globalThis.webpackChunkopenkruise_io=globalThis.webpackChunkopenkruise_io||[]).push([[9206],{9950:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"best-practices/running-e2b-for-code-interpreter","title":"Running E2B Code Interpreter Sandbox","description":"This example demonstrates how to deploy an E2B code-interpreter sandbox through OpenKruise Agents","source":"@site/kruiseagents/best-practices/running-e2b-for-code-interpreter.md","sourceDirName":"best-practices","slug":"/best-practices/running-e2b-for-code-interpreter","permalink":"/kruiseagents/best-practices/running-e2b-for-code-interpreter","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"Ai Ranthem","lastUpdatedAt":1770373181000,"frontMatter":{},"sidebar":"kruiseagents","previous":{"title":"Claiming Sandboxes","permalink":"/kruiseagents/user-manuals/sandbox-claim"},"next":{"title":"Running E2B Desktop Sandbox","permalink":"/kruiseagents/best-practices/running-e2b-for-desktop"}}');var i=a(74848),s=a(28453);const o={},r="Running E2B Code Interpreter Sandbox",d={},l=[{value:"0. Basic Concepts",id:"0-basic-concepts",level:2},{value:"Sandbox",id:"sandbox",level:3},{value:"SandboxSet",id:"sandboxset",level:3},{value:"sandbox-manager",id:"sandbox-manager",level:3},{value:"agent-runtime",id:"agent-runtime",level:3},{value:"1. Defining Templates",id:"1-defining-templates",level:2},{value:"1.1 Deploying a Pre-warmed template via SandboxSet",id:"11-deploying-a-pre-warmed-template-via-sandboxset",level:3},{value:"1.2 Using Custom Images",id:"12-using-custom-images",level:3},{value:"1.3 Cross-Namespace Template Deployment",id:"13-cross-namespace-template-deployment",level:3},{value:"2. Using Sandboxes via E2B Python SDK",id:"2-using-sandboxes-via-e2b-python-sdk",level:2},{value:"2.1 E2B Standard Capabilities",id:"21-e2b-standard-capabilities",level:3},{value:"2.1.1 Creation and Deletion",id:"211-creation-and-deletion",level:4},{value:"2.1.2 Code Execution",id:"212-code-execution",level:4},{value:"2.1.3 File Operations",id:"213-file-operations",level:4},{value:"2.1.4 Command Execution",id:"214-command-execution",level:4},{value:"2.1.5 Pausing and Resuming",id:"215-pausing-and-resuming",level:4}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"running-e2b-code-interpreter-sandbox",children:"Running E2B Code Interpreter Sandbox"})}),"\n",(0,i.jsxs)(n.p,{children:["This example demonstrates how to deploy an ",(0,i.jsx)(n.a,{href:"https://e2b.dev/",children:"E2B"})," code-interpreter sandbox through OpenKruise Agents\nand invoke it via the E2B SDK."]}),"\n",(0,i.jsx)(n.h2,{id:"0-basic-concepts",children:"0. Basic Concepts"}),"\n",(0,i.jsx)(n.h3,{id:"sandbox",children:"Sandbox"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Sandbox"})," is the core CRD of OpenKruise Agents. It manages the lifecycle of a sandbox instance (such as a Pod) and\nprovides advanced features including Pause, Resume, Checkpoint, Fork, and in-place upgrades."]}),"\n",(0,i.jsx)(n.h3,{id:"sandboxset",children:"SandboxSet"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"SandboxSet"})," is the workload that manages ",(0,i.jsx)(n.code,{children:"Sandbox"}),". Its function is similar to a ",(0,i.jsx)(n.code,{children:"ReplicaSet"})," that manages Pods.\nIt enables sub-second sandbox startup by pre-warming a pool of sandbox instances. Optimized specifically for scaling\nperformance, ",(0,i.jsx)(n.code,{children:"SandboxSet"})," can rapidly replenish sandboxes as they are consumed."]}),"\n",(0,i.jsx)(n.h3,{id:"sandbox-manager",children:"sandbox-manager"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"sandbox-manager"})," is a stateless backend management component that provides a set of E2B protocol-compatible APIs for\nmanaging and operating sandbox instances."]}),"\n",(0,i.jsx)(n.h3,{id:"agent-runtime",children:"agent-runtime"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"agent-runtime"})," is a Sidecar injected into the Sandbox that provides a series of advanced features for the sandbox,\nincluding E2B envd-compatible remote operation interfaces, dynamic CSI mounting, etc."]}),"\n",(0,i.jsx)(n.h2,{id:"1-defining-templates",children:"1. Defining Templates"}),"\n",(0,i.jsxs)(n.p,{children:["OpenKruise Agents provides the E2B protocol-compatible backend management component ",(0,i.jsx)(n.code,{children:"sandbox-manager"}),", allowing users to\ndirectly manage and operate sandboxes through the native E2B SDK. In this example, we will deploy an official E2B\ncode-interpreter template in the K8s cluster."]}),"\n",(0,i.jsx)(n.h3,{id:"11-deploying-a-pre-warmed-template-via-sandboxset",children:"1.1 Deploying a Pre-warmed template via SandboxSet"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"SandboxSet"}),", as the workload managing ",(0,i.jsx)(n.code,{children:"Sandbox"}),", will be automatically recognized as a template by ",(0,i.jsx)(n.code,{children:"sandbox-manager"}),".\nYou can refer\nto ",(0,i.jsx)(n.a,{href:"https://github.com/openkruise/agents/blob/master/examples/code_interpreter/sandboxset.yaml",children:"sandboxset.yaml"})," to\ncreate a ",(0,i.jsx)(n.code,{children:"SandboxSet"})," in K8s to create a template named ",(0,i.jsx)(n.code,{children:"code-interpreter"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"12-using-custom-images",children:"1.2 Using Custom Images"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"agent-runtime"})," provides E2B-compatible interfaces that support its command execution, file operations, code running,\nand other functions. If the official images do not meet your requirements, you can replace them with custom images."]}),"\n",(0,i.jsx)(n.h3,{id:"13-cross-namespace-template-deployment",children:"1.3 Cross-Namespace Template Deployment"}),"\n",(0,i.jsxs)(n.p,{children:["To reduce cluster load during large-scale pre-warming, you can deploy templates across namespaces by creating\nidentically\nnamed ",(0,i.jsx)(n.code,{children:"SandboxSet"})," resources in each target namespace."]}),"\n",(0,i.jsx)(n.h2,{id:"2-using-sandboxes-via-e2b-python-sdk",children:"2. Using Sandboxes via E2B Python SDK"}),"\n",(0,i.jsxs)(n.p,{children:["You can connect the native E2B Python SDK and JavaScript SDK to ",(0,i.jsx)(n.code,{children:"sandbox-manager"})," through the following environment\nvariables. In this section, we will use the Python SDK as an example for introduction."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Domain name and initial API Token should be configured via helm values during installation"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"export E2B_DOMAIN=your.domain\nexport E2B_API_TOKEN=your-token\n"})}),"\n",(0,i.jsx)(n.p,{children:"You can install the E2B code interpreter Python SDK with the following command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"pip install e2b-code-interpreter\n"})}),"\n",(0,i.jsx)(n.h3,{id:"21-e2b-standard-capabilities",children:"2.1 E2B Standard Capabilities"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"sandbox-manager"})," is compatible with E2B's standard capabilities, including management and sandbox instance operations.\nThe following example demonstrates creating sandboxes, executing code, operating files, executing commands, and other\nfunctions through the E2B SDK."]}),"\n",(0,i.jsx)(n.h4,{id:"211-creation-and-deletion",children:"2.1.1 Creation and Deletion"}),"\n",(0,i.jsxs)(n.p,{children:["The following code can quickly allocate a sandbox instance from the pre-warming pool. Upon completion of allocation,\n",(0,i.jsx)(n.code,{children:"SandboxSet"})," will immediately create a new sandbox instance for replenishment."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import os\n\n# Import the E2B SDK\nfrom e2b_code_interpreter import Sandbox\n\n# Create a sandbox using the E2B Python SDK\n# The template name here must match the SandboxSet name\nsbx = Sandbox.create(template="code-interpreter", timeout=300)\nprint(f"sandbox id: {sbx.sandbox_id}")\n\nsbx.kill()\nprint(f"sandbox {sbx.sandbox_id} killed")\n'})}),"\n",(0,i.jsx)(n.h4,{id:"212-code-execution",children:"2.1.2 Code Execution"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'with Sandbox.create(template="code-interpreter", timeout=300) as sbx:\n    sbx.run_code("print(\'hello world\')")\n'})}),"\n",(0,i.jsx)(n.h4,{id:"213-file-operations",children:"2.1.3 File Operations"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'with Sandbox.create(template="code-interpreter", timeout=300) as sbx:\n    with open(os.path.abspath(__file__), "rb") as file:\n        sbx.files.write("/home/user/my-file", file)\n    file_content = sbx.files.read("/home/user/my-file")\n    print(file_content)\n'})}),"\n",(0,i.jsx)(n.h4,{id:"214-command-execution",children:"2.1.4 Command Execution"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"with Sandbox.create(template=\"code-interpreter\", timeout=300) as sbx:\n    result = sbx.commands.run('echo hello; sleep 1; echo world', on_stdout=lambda data: print(data),\n                              on_stderr=lambda data: print(data))\n    print(result)\n"})}),"\n",(0,i.jsx)(n.h4,{id:"215-pausing-and-resuming",children:"2.1.5 Pausing and Resuming"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Note: Currently, memory state preservation during pausing and resuming is only supported on Alibaba Cloud ACS"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'with Sandbox.create(template="code-interpreter", timeout=300) as sbx:\n    # Pause the sandbox\n    sbx.run_code("a = 1")\n    sbx.beta_pause()\n\n    # Resume the sandbox\n    sbx.connect()\n    sbx.run_code("print(a)")\n'})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453:(e,n,a)=>{a.d(n,{R:()=>o,x:()=>r});var t=a(96540);const i={},s=t.createContext(i);function o(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);