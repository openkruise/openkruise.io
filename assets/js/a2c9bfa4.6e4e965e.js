"use strict";(globalThis.webpackChunkopenkruise_io=globalThis.webpackChunkopenkruise_io||[]).push([[8657],{2678:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>c,frontMatter:()=>a,metadata:()=>s,toc:()=>p});const s=JSON.parse('{"id":"best-practices/running-e2b-for-desktop","title":"Running E2B Desktop Sandbox","description":"This example demonstrates how to deploy an E2B desktop sandbox through OpenKruise Agents and invoke","source":"@site/kruiseagents/best-practices/running-e2b-for-desktop.md","sourceDirName":"best-practices","slug":"/best-practices/running-e2b-for-desktop","permalink":"/kruiseagents/best-practices/running-e2b-for-desktop","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"Divyanshu Choudhury","lastUpdatedAt":1772265009000,"frontMatter":{},"sidebar":"kruiseagents","previous":{"title":"Running E2B Code Interpreter Sandbox","permalink":"/kruiseagents/best-practices/running-e2b-for-code-interpreter"},"next":{"title":"Best Practice: Accessing sandbox-manager via E2B Protocol with Self-Signed Certificates","permalink":"/kruiseagents/best-practices/use-self-signed-cert"}}');var o=t(74848),r=t(28453);const a={},i="Running E2B Desktop Sandbox",d={},p=[{value:"1. Defining Templates",id:"1-defining-templates",level:2},{value:"2. Using Sandboxes via E2B Python SDK",id:"2-using-sandboxes-via-e2b-python-sdk",level:2},{value:"2.1 E2B Standard Capabilities",id:"21-e2b-standard-capabilities",level:3},{value:"2.1.1 Streaming Remote Desktop",id:"211-streaming-remote-desktop",level:4},{value:"2.1.2 Controlling Remote Desktop",id:"212-controlling-remote-desktop",level:4},{value:"2.1.3 Other Basics",id:"213-other-basics",level:4},{value:"2.2 OpenKruise Agents Extended Capabilities",id:"22-openkruise-agents-extended-capabilities",level:3},{value:"2.2.1 CDP (Chrome DevTools Protocol) Support",id:"221-cdp-chrome-devtools-protocol-support",level:4}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"running-e2b-desktop-sandbox",children:"Running E2B Desktop Sandbox"})}),"\n",(0,o.jsxs)(n.p,{children:["This example demonstrates how to deploy an ",(0,o.jsx)(n.a,{href:"https://e2b.dev/",children:"E2B"})," desktop sandbox through OpenKruise Agents and invoke\nit via the E2B SDK."]}),"\n",(0,o.jsxs)(n.p,{children:["For basic concepts, please refer to ",(0,o.jsx)(n.a,{href:"../code_interpreter",children:"Running E2B Code Interpreter Sandbox"})]}),"\n",(0,o.jsx)(n.h2,{id:"1-defining-templates",children:"1. Defining Templates"}),"\n",(0,o.jsxs)(n.p,{children:["Similar to the code-interpreter template, we can define a template using the official E2B Desktop image and create a\npre-warming pool via ",(0,o.jsx)(n.code,{children:"SandboxSet"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'apiVersion: agents.kruise.io/v1alpha1\nkind: SandboxSet\nmetadata:\n  annotations:\n    # Enable SandboxManager\'s Envd initialization capability\n    e2b.agents.kruise.io/should-init-envd: "true"\n  name: code-interpreter\n  namespace: default\nspec:\n  # Pre-warming pool size, recommended to be slightly larger than the estimated request burst volume\n  replicas: 100\n  template: # Declare a Pod template\n    spec:\n      initContainers:\n        - name: init # Inject agent-runtime component through native sidecar\n          image: registry-cn-hangzhou.ack.aliyuncs.com/acs/agent-runtime:v0.0.1\n          volumeMounts:\n            - name: agent-runtime-volume\n              mountPath: /mnt/agent-runtime\n          env:\n            - name: AGENT_RUNTIME_WORKSPACE\n              value: /mnt/agent-runtime\n          restartPolicy: Always\n      containers:\n        - name: sandbox\n          image: e2bdev/desktop:latest # Use the official E2B desktop image\n          resources:\n            requests:\n              cpu: 1\n              memory: 1Gi\n            limits:\n              cpu: 1\n              memory: 1Gi\n          env:\n            - name: AGENT_RUNTIME_WORKSPACE\n              value: /mnt/agent-runtime\n          volumeMounts:\n            - name: agent-runtime-volume\n              mountPath: /mnt/agent-runtime\n      volumes:\n        - name: agent-runtime-volume # Define the shared directory between agent-runtime and main container\n          emptyDir: { }\n'})}),"\n",(0,o.jsx)(n.h2,{id:"2-using-sandboxes-via-e2b-python-sdk",children:"2. Using Sandboxes via E2B Python SDK"}),"\n",(0,o.jsx)(n.p,{children:"Specify the E2B backend address:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"export E2B_DOMAIN=your.domain\nexport E2B_API_TOKEN=your-token\n"})}),"\n",(0,o.jsx)(n.p,{children:"You can install the E2B desktop Python SDK with the following command:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"pip install e2b-desktop\n"})}),"\n",(0,o.jsx)(n.h3,{id:"21-e2b-standard-capabilities",children:"2.1 E2B Standard Capabilities"}),"\n",(0,o.jsx)(n.h4,{id:"211-streaming-remote-desktop",children:"2.1.1 Streaming Remote Desktop"}),"\n",(0,o.jsx)(n.p,{children:"With the following code, you can open an interactive remote desktop stream."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'import time\n\nfrom e2b_desktop import Sandbox\n\n# Create a new desktop sandbox\ndesktop = Sandbox.create(template="desktop")\nprint(f"sandboxId: {desktop.sandbox_id}")\n# Note: There can be only one stream at a time\n# You need to stop the current stream before streaming another application\ndesktop.stream.start(\n    # window_id=desktop.get_current_window_id(), # if not provided the whole desktop will be streamed\n    require_auth=True\n)\n\n# Get the stream auth key\nauth_key = desktop.stream.get_auth_key()\n\n# Print the stream URL\nprint(\'Stream URL:\', desktop.stream.get_url(auth_key=auth_key))\ninput("press ENTER to exit")\n\n# Kill the sandbox after the tasks are finished\ndesktop.kill()\n'})}),"\n",(0,o.jsx)(n.h4,{id:"212-controlling-remote-desktop",children:"2.1.2 Controlling Remote Desktop"}),"\n",(0,o.jsx)(n.p,{children:"The following code demonstrates operations such as opening a browser and entering a URL."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"\nfrom e2b_desktop import Sandbox\n\nwith Sandbox.create(template=\"desktop\") as desktop:\n    desktop.launch('google-chrome')\n    desktop.write('https://openkruise.io')\n    desktop.press('enter')\n    input(\"press ENTER to exit\")\n\n"})}),"\n",(0,o.jsx)(n.h4,{id:"213-other-basics",children:"2.1.3 Other Basics"}),"\n",(0,o.jsx)(n.p,{children:"In addition to the above desktop features, basic functions such as command execution, file operations, pause/resume, etc.\nare also supported."}),"\n",(0,o.jsx)(n.h3,{id:"22-openkruise-agents-extended-capabilities",children:"2.2 OpenKruise Agents Extended Capabilities"}),"\n",(0,o.jsx)(n.p,{children:"In addition to E2B standard capabilities, OpenKruise Agents also provides a series of extended functions."}),"\n",(0,o.jsx)(n.h4,{id:"221-cdp-chrome-devtools-protocol-support",children:"2.2.1 CDP (Chrome DevTools Protocol) Support"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"sandbox-manager"})," provides CDP handshake support, enabling the Agent to remotely operate the Chrome browser in the\nsandbox directly through the CDP protocol. This is very useful when using frameworks\nlike ",(0,o.jsx)(n.a,{href:"https://browser-use.com/",children:"browser-use"}),". Below is an example using browser-use that will create an Agent that\noperates a browser."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'import asyncio\nimport os\nimport time\n\nfrom browser_use import Agent, BrowserSession\nfrom browser_use.llm import ChatOpenAI\nfrom e2b_code_interpreter import Sandbox\n\nasync def screenshot(agent: Agent):\n    try:\n        print("Starting screenshot...")\n        page = await agent.browser_session.get_current_page()\n        screenshot_bytes = await page.screenshot(full_page=True, type=\'png\')\n        screenshots_dir = os.path.join(".", "screenshots")\n        os.makedirs(screenshots_dir, exist_ok=True)\n        screenshot_path = os.path.join(screenshots_dir, f"{time.time()}.png")\n        with open(screenshot_path, "wb") as f:\n            f.write(screenshot_bytes)\n        print(f"Screenshot saved to {screenshot_path}")\n    except Exception as e:\n        print(f"Screenshot failed: {e}")\n\nasync def main():\n    # Create E2B sandbox instance\n    sandbox = Sandbox.create(template="browser") # A container with Chrome already running\n    try:\n        # Create Browser-use session\n        browser_session = BrowserSession(cdp_url=f"https://api.{sandbox.sandbox_domain}/browser/{sandbox.sandbox_id}") # Connect to the browser in the remote sandbox using the cdp protocol\n        await browser_session.start()\n        print("Browser-use session created successfully")\n\n        # Create AI Agent\n        agent = Agent(\n            task="""\n            Make a brief introduction to the projects of the OpenKruise family.\n            """,\n            llm=ChatOpenAI(\n                api_key=os.getenv("LLM_API_KEY"),\n                base_url=os.getenv("LLM_BASE_URL"),\n                model="qwen-plus",\n                temperature=1,\n            ),\n            browser_session=browser_session,\n        )\n\n        # Run Agent task\n        print("Starting Agent task execution...")\n        await agent.run(\n            on_step_end=screenshot, # Call screenshot at the end of each step\n        )\n\n        # Close browser session\n        await browser_session.close()\n        print("Task execution completed")\n\n    finally:\n        # Clean up sandbox resources\n        sandbox.kill()\n        print("Sandbox resources cleaned up")\n\nif __name__ == "__main__":\n    asyncio.run(main())\n'})})]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var s=t(96540);const o={},r=s.createContext(o);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);