"use strict";(globalThis.webpackChunkopenkruise_io=globalThis.webpackChunkopenkruise_io||[]).push([[5916],{28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var t=s(96540);const i={},r=t.createContext(i);function o(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(r.Provider,{value:n},e.children)}},57809:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"developer-manuals/contribution","title":"Contributing to OpenKruise Agents","description":"Developing Environment","source":"@site/kruiseagents/developer-manuals/contribution.md","sourceDirName":"developer-manuals","slug":"/developer-manuals/contribution","permalink":"/kruiseagents/developer-manuals/contribution","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"Odysseus Zhang","lastUpdatedAt":1772264893000,"frontMatter":{},"sidebar":"kruiseagents","previous":{"title":"Best Practice: Managing sandbox-manager Self-Signed Certificates with cert-manager","permalink":"/kruiseagents/best-practices/cert-manager"},"next":{"title":"Using OpenKruise Agents Sandbox via E2B SDK","permalink":"/kruiseagents/developer-manuals/e2b-client"}}');var i=s(74848),r=s(28453);const o={},a="Contributing to OpenKruise Agents",l={},d=[{value:"Developing Environment",id:"developing-environment",level:2},{value:"Developing guide",id:"developing-guide",level:2},{value:"Generate code and manifests",id:"generate-code-and-manifests",level:3},{value:"Run tests",id:"run-tests",level:3},{value:"Build images",id:"build-images",level:3},{value:"Deploy to Kubernetes",id:"deploy-to-kubernetes",level:3},{value:"Test OpenKruise Agents via E2B client",id:"test-openkruise-agents-via-e2b-client",level:4},{value:"Proposals",id:"proposals",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"contributing-to-openkruise-agents",children:"Contributing to OpenKruise Agents"})}),"\n",(0,i.jsx)(n.h2,{id:"developing-environment",children:"Developing Environment"}),"\n",(0,i.jsx)(n.p,{children:"As a contributor, if you want to make any contribution to OpenKruise Agents, we should reach an agreement on the\nversion of tools used in the development environment. Here are some dependencies with specific versions:"}),"\n",(0,i.jsx)(n.p,{children:"For agent-sandbox-controller:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Golang : v1.24+"}),"\n",(0,i.jsx)(n.li,{children:"kubernetes: v1.28+"}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["You can use ",(0,i.jsx)(n.code,{children:"go mod vendor"})," to avoid the IDE crashes caused by go mod list failures."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"developing-guide",children:"Developing guide"}),"\n",(0,i.jsx)(n.h3,{id:"generate-code-and-manifests",children:"Generate code and manifests"}),"\n",(0,i.jsx)(n.p,{children:"If the APIs are modified, you have to run the following commands to generate code and manifests."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Generate code and manifests e.g. CRD, RBAC YAML files etc\nmake generate manifests\n"})}),"\n",(0,i.jsx)(n.h3,{id:"run-tests",children:"Run tests"}),"\n",(0,i.jsxs)(n.p,{children:["You can use the command ",(0,i.jsx)(n.code,{children:"make test"})," to run unit tests."]}),"\n",(0,i.jsxs)(n.p,{children:["For JetBrains IDE users, you can find some pre-configured configurations to run tests directly. They are stored\nin ",(0,i.jsx)(n.a,{href:"https://github.com/openkruise/agents/blob/master/.run",children:".run"})]}),"\n",(0,i.jsx)(n.h3,{id:"build-images",children:"Build images"}),"\n",(0,i.jsx)(n.p,{children:"OpenKruise Agents consists of two components:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"agent-sandbox-controller: a k8s operator for agent CRDs, including Sandbox, SandboxSet, etc."}),"\n",(0,i.jsx)(n.li,{children:"sandbox-manager: a server for sandbox management, compatible with E2B API."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["You can use the commands below to build the images with ",(0,i.jsx)(n.a,{href:"https://github.com/openkruise/agents/blob/master/dockerfiles",children:"Dockerfiles"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"make docker-build-controller # build agent-sandbox-controller\nmake docker-build-manager # build sandbox-manager\nmake docker-build-runtime # build agent-runtime\n"})}),"\n",(0,i.jsx)(n.h3,{id:"deploy-to-kubernetes",children:"Deploy to Kubernetes"}),"\n",(0,i.jsxs)(n.p,{children:["It is recommended to deploy OpenKruise Agents to a Kubernetes cluster via kustomize for testing. Any Kubernetes cluster\nshould be ok, but we recommend using ",(0,i.jsx)(n.a,{href:"https://kind.sigs.k8s.io/",children:"kind"})," to create a local cluster."]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Modify the following patch files with your own images.","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/openkruise/agents/blob/master/config/default/image_patch.yaml",children:"agent-sandbox-controller"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/openkruise/agents/blob/master/config/sandbox-manager/image_patch.yaml",children:"sandbox-manager"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Deploy the components","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"make deploy-agent-sandbox-controller\nmake deploy-sandbox-manager\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"test-openkruise-agents-via-e2b-client",children:"Test OpenKruise Agents via E2B client"}),"\n",(0,i.jsx)(n.p,{children:"It is recommended to use the customized e2b protocol with patched client to avoid the complexity of wildcard domain\nresolution and certificates."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Create a ",(0,i.jsx)(n.a,{href:"https://github.com/openkruise/agents/blob/master/examples/code_interpreter/sandboxset.yaml",children:"SandboxSet"})," with name ",(0,i.jsx)(n.code,{children:"code-interpreter"})," as an E2B template"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f examples/code_interpreter/sandboxset.yaml\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Install ",(0,i.jsx)(n.a,{href:"https://e2b.dev",children:"E2B"})," python SDK"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"pip install e2b-code-interpreter\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Port forward the sandbox-manager"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"sudo kubectl port-forward services/sandbox-manager 80:7788 -n sandbox-system\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Create a new terminal, and set the environment variables"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"export E2B_DOMAIN=localhost\nexport E2B_API_KEY=some-api-key # configured in config/sandbox-manager/configuration_patch.yaml\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Patch the client (refer to this document)"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Copy ",(0,i.jsx)(n.a,{href:"https://github.com/openkruise/agents/blob/master/sdk/customized_e2b/kruise_agents/patch_e2b.py",children:"patch_e2b.py"})," to your python project"]}),"\n",(0,i.jsxs)(n.li,{children:["Patch your E2B SDK before using it","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from patch_e2b import patch_e2b\nfrom e2b_code_interpreter import Sandbox\n\npatch_e2b(False)\nwith Sandbox.create(template="code-interpreter") as sbx:\n    sbx.run_code("print(\'hello world\')")\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"proposals",children:"Proposals"}),"\n",(0,i.jsxs)(n.p,{children:["If you are going to contribute a feature with a new API or need significant effort, please submit a proposal\nin ",(0,i.jsx)(n.a,{href:"https://github.com/openkruise/agents/blob/master/docs/proposals",children:"./docs/proposals/"})," first."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);