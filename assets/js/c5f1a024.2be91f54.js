"use strict";(globalThis.webpackChunkopenkruise_io=globalThis.webpackChunkopenkruise_io||[]).push([[4405],{27287:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"developer-manuals/e2b-client","title":"Using OpenKruise Agents Sandbox via E2B SDK","description":"The sandbox-manager component of OpenKruise Agents supports two integration methods: native E2B protocol and private","source":"@site/kruiseagents/developer-manuals/e2b-client.md","sourceDirName":"developer-manuals","slug":"/developer-manuals/e2b-client","permalink":"/kruiseagents/developer-manuals/e2b-client","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"Odysseus Zhang","lastUpdatedAt":1772264893000,"frontMatter":{},"sidebar":"kruiseagents","previous":{"title":"Contributing to OpenKruise Agents","permalink":"/kruiseagents/developer-manuals/contribution"},"next":{"title":"Go Client","permalink":"/kruiseagents/developer-manuals/go-client"}}');var s=i(74848),t=i(28453);const o={},a="Using OpenKruise Agents Sandbox via E2B SDK",l={},d=[{value:"Important Notes on E2B_DOMAIN Environment Variable",id:"important-notes-on-e2b_domain-environment-variable",level:2},{value:"How to Configure E2B_DOMAIN for Server-side (sandbox-manager)",id:"how-to-configure-e2b_domain-for-server-side-sandbox-manager",level:3},{value:"How to Configure E2B_DOMAIN for Client-side (E2B SDK)",id:"how-to-configure-e2b_domain-for-client-side-e2b-sdk",level:3},{value:"Special Scenarios",id:"special-scenarios",level:3},{value:"1. Domain with Port",id:"1-domain-with-port",level:4},{value:"How to install a certificate",id:"how-to-install-a-certificate",level:2},{value:"Recommended sandbox-manager integration methods",id:"recommended-sandbox-manager-integration-methods",level:2},{value:"1. Integration using native protocol",id:"1-integration-using-native-protocol",level:3},{value:"2. Private protocol HTTPS access from outside cluster",id:"2-private-protocol-https-access-from-outside-cluster",level:3},{value:"3. Private protocol in-cluster access",id:"3-private-protocol-in-cluster-access",level:3},{value:"4. Port forward sandbox-manager to local machine",id:"4-port-forward-sandbox-manager-to-local-machine",level:3},{value:"E2B Compatibility",id:"e2b-compatibility",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"using-openkruise-agents-sandbox-via-e2b-sdk",children:"Using OpenKruise Agents Sandbox via E2B SDK"})}),"\n",(0,s.jsx)(n.p,{children:"The sandbox-manager component of OpenKruise Agents supports two integration methods: native E2B protocol and private\nprotocol."}),"\n",(0,s.jsx)(n.p,{children:"Comparison between private protocol and native protocol:"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["Assuming your configured E2B_DOMAIN is ",(0,s.jsx)(n.code,{children:"your.domain.com"})]}),"\n"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Native Protocol"}),(0,s.jsx)(n.th,{children:"Private Protocol"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"api.your.domain.com"}),(0,s.jsx)(n.td,{children:"your.domain.com/kruise/api"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"<port>-<sid>.your.domain.com"}),(0,s.jsx)(n.td,{children:"your.domain.com/kruise/<sid>/<port>"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"important-notes-on-e2b_domain-environment-variable",children:"Important Notes on E2B_DOMAIN Environment Variable"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"VERY IMPORTANT"}),": The ",(0,s.jsx)(n.code,{children:"E2B_DOMAIN"})," environment variable of sandbox-manager must be set to the same as the client.\nYou can edit the deployment with ",(0,s.jsx)(n.code,{children:"kubectl edit deploy -n sandbox-system sandbox-manager"})]}),"\n",(0,s.jsx)(n.h3,{id:"how-to-configure-e2b_domain-for-server-side-sandbox-manager",children:"How to Configure E2B_DOMAIN for Server-side (sandbox-manager)"}),"\n",(0,s.jsxs)(n.p,{children:["You can configure the server-side E2B_DOMAIN by editing the following files before running\n",(0,s.jsx)(n.code,{children:"make deploy-sandbox-manager"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"../../config/sandbox-manager/configuration_patch.yaml",children:"configuration_patch.yaml"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"../../config/sandbox-manager/ingress_patch.yaml",children:"ingress_patch.yaml"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"how-to-configure-e2b_domain-for-client-side-e2b-sdk",children:"How to Configure E2B_DOMAIN for Client-side (E2B SDK)"}),"\n",(0,s.jsx)(n.p,{children:"You can configure the client-side E2B_DOMAIN by setting environment variables"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"export E2B_DOMAIN=your.domain.com\n"})}),"\n",(0,s.jsx)(n.h3,{id:"special-scenarios",children:"Special Scenarios"}),"\n",(0,s.jsx)(n.h4,{id:"1-domain-with-port",children:"1. Domain with Port"}),"\n",(0,s.jsxs)(n.p,{children:["For scenarios where the Ingress gateway does not use default HTTP ports (80 or 443). For example, if the domain is\n",(0,s.jsx)(n.code,{children:"your.domain.com:8080"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Client-side: Set environment variable ",(0,s.jsx)(n.code,{children:"E2B_DOMAIN=your.domain.com:8080"})]}),"\n",(0,s.jsxs)(n.li,{children:["Server-side","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["In ",(0,s.jsx)(n.a,{href:"../../config/sandbox-manager/configuration_patch.yaml",children:"configuration_patch.yaml"}),", ",(0,s.jsx)(n.strong,{children:"keep the port"}),", set E2B\nDomain to\n",(0,s.jsx)(n.code,{children:"your.domain.com:8080"})]}),"\n",(0,s.jsxs)(n.li,{children:["In ",(0,s.jsx)(n.a,{href:"../../config/sandbox-manager/ingress_patch.yaml",children:"ingress_patch.yaml"}),", ",(0,s.jsx)(n.strong,{children:"do not keep the port"}),", replace\n",(0,s.jsx)(n.code,{children:"replace.with.your.domain"})," with ",(0,s.jsx)(n.code,{children:"your.domain.com"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"how-to-install-a-certificate",children:"How to install a certificate"}),"\n",(0,s.jsx)(n.p,{children:"If you need to access sandbox-manager via HTTPS, you need to install a TLS certificate. It is recommended to use a\ntrusted certificate. If you don't have a trusted certificate, you can use a self-signed one, refer to the following\ndocs:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/kruiseagents/best-practices/use-self-signed-cert",children:"use-self-signed-cert.md"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/kruiseagents/best-practices/cert-manager",children:"cert-manager.md"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"You can install your certificate with the following command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# ingress-nginx example, adjust according to your ingress controller\nkubectl create secret tls sandbox-manager-tls \\\n          --cert=fullchain.pem \\\n          --key=privkey.pem -n sandbox-system\n"})}),"\n",(0,s.jsx)(n.h2,{id:"recommended-sandbox-manager-integration-methods",children:"Recommended sandbox-manager integration methods"}),"\n",(0,s.jsx)(n.h3,{id:"1-integration-using-native-protocol",children:"1. Integration using native protocol"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"This is the most standard, native integration method, but also has the highest configuration threshold, generally\nrequiring manual deployment."}),"\n"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Client configuration environment variables:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# The E2B_DOMAIN env of sandbox-manager container should be set to the same\nexport E2B_DOMAIN=your.domain.com\nexport E2B_API_KEY=<your-api-key>\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Resolve wildcard domain ",(0,s.jsx)(n.code,{children:"*.your.domain.com"})," to sandbox-manager ingress endpoint with your DNS provider"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Install wildcard certificate ",(0,s.jsx)(n.code,{children:"*.your.domain.com"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-private-protocol-https-access-from-outside-cluster",children:"2. Private protocol HTTPS access from outside cluster"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"This approach lowers the deployment barrier by replacing wildcard domain with a single domain."}),"\n"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Client configuration environment variables:","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# The E2B_DOMAIN env of sandbox-manager container should be set to the same\nexport E2B_DOMAIN=your.domain.com\nexport E2B_API_KEY=<your-api-key>\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Patch client:","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from kruise_agents.patch_e2b import patch_e2b\npatch_e2b(https=True)\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Resolve single domain ",(0,s.jsx)(n.code,{children:"your.domain.com"})," to sandbox-manager ingress endpoint with your DNS provider"]}),"\n",(0,s.jsxs)(n.li,{children:["Install single domain certificate ",(0,s.jsx)(n.code,{children:"your.domain.com"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-private-protocol-in-cluster-access",children:"3. Private protocol in-cluster access"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"This approach enables rapid automated deployment without requiring domain and certificate configuration. Recommended\nfor E2E testing scenarios only, or after rigorous evaluation."}),"\n"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Ensure client(agent) and sandbox-manager are in the same cluster."}),"\n",(0,s.jsxs)(n.li,{children:["Client configuration environment variables:","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# The E2B_DOMAIN env of sandbox-manager container should be set to the same\nexport E2B_DOMAIN=sandbox-manager.sandbox-system.svc.cluster.local\nexport E2B_API_KEY=<your-api-key>\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Patch client and disable HTTPS:","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from kruise_agents.patch_e2b import patch_e2b\npatch_e2b(https=False)\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"4-port-forward-sandbox-manager-to-local-machine",children:"4. Port forward sandbox-manager to local machine"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Client configuration environment variables:","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# The E2B_DOMAIN env of sandbox-manager container should be set to the same\nexport E2B_DOMAIN=localhost\nexport E2B_API_KEY=<your-api-key>\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Port forward sandbox-manager to local machine:","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"sudo kubectl port-forward services/sandbox-manager 80:7788 -n sandbox-system\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Patch client:","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from kruise_agents.patch_e2b import patch_e2b\npatch_e2b(https=False)\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"e2b-compatibility",children:"E2B Compatibility"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"API Category"}),(0,s.jsx)(n.th,{children:"API"}),(0,s.jsx)(n.th,{children:"Compatibility Level"}),(0,s.jsx)(n.th,{children:"Notes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Lifecycle Management"}),(0,s.jsx)(n.td,{children:"create"}),(0,s.jsx)(n.td,{children:"Partially Compatible"}),(0,s.jsx)(n.td,{children:"Network access control implementation pending"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"get_info"}),(0,s.jsx)(n.td,{children:"Fully Compatible"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"list"}),(0,s.jsx)(n.td,{children:"Fully Compatible"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"kill"}),(0,s.jsx)(n.td,{children:"Fully Compatible"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"pause"}),(0,s.jsx)(n.td,{children:"Fully Compatible"}),(0,s.jsx)(n.td,{children:"Due to container ecosystem efficiency considerations, current pause implementation is asynchronous"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"connect"}),(0,s.jsx)(n.td,{children:"Fully Compatible"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Code Execution"}),(0,s.jsx)(n.td,{children:"run_code"}),(0,s.jsx)(n.td,{children:"Fully Compatible"}),(0,s.jsx)(n.td,{children:"Requires e2b-code-interpreter running in main container"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Command Execution"}),(0,s.jsx)(n.td,{children:"commands.run"}),(0,s.jsx)(n.td,{children:"Fully Compatible"}),(0,s.jsx)(n.td,{children:"Requires runtime injection of envd component"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"File System"}),(0,s.jsx)(n.td,{children:"read/write"}),(0,s.jsx)(n.td,{children:"Fully Compatible"}),(0,s.jsx)(n.td,{children:"Requires runtime injection of envd component"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"upload_url/download_url"}),(0,s.jsx)(n.td,{children:"Not Supported"}),(0,s.jsx)(n.td,{children:"Upload/download via pre-signed URL implementation pending"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Lifecycle Events"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://api.e2b.app/events/sandboxes/%7Bsbx.sandbox_id%7D",children:"https://api.e2b.app/events/sandboxes/{sbx.sandbox_id}"})}),(0,s.jsx)(n.td,{children:"Not Supported"}),(0,s.jsx)(n.td,{children:"Lifecycle events implementation pending"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Template Management"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"Not Supported"}),(0,s.jsx)(n.td,{children:"Template management implementation pending, recommend using container images as alternative"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>a});var r=i(96540);const s={},t=r.createContext(s);function o(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);